{
  "raw_text": "\nContents\nForeword\t6\n1\tScope\t7\n2\tReferences\t7\n3\tDefinitions and abbreviations\t8\n3.1\tDefinitions\t8\n3.2\tAbbreviations\t9\n4\tArchitecture model and concepts\t10\n4.1\tGeneral concept\t10\n4.2\tArchitectural reference model\t10\n4.2.1\tPC5 and Uu based V2X architecture reference model\t10\n4.2.1.1\tNon-roaming 5G System architecture for V2X communication over PC5 and Uu reference points\t10\n4.2.1.2\tRoaming 5G System architecture for V2X communication over PC5 and Uu reference points\t11\n4.2.1.3\tInter-PLMN 5G System architecture for V2X communication over PC5 reference point\t12\n4.2.2\tAF-based service parameter provisioning for V2X communications\t12\n4.2.3\tReference points\t12\n4.2.4\tService-based interfaces\t13\n4.3\tArchitecture reference model for interworking with EPS V2X\t13\n4.4\tFunctional entities\t14\n4.4.1\tUE\t14\n4.4.2\tPCF\t15\n4.4.3\tV2X Application Server\t15\n4.4.4\tAMF\t15\n4.4.5\tUDM\t15\n4.4.6\tUDR\t16\n4.4.7\tNRF\t16\n5\tHigh level functionality and features\t16\n5.1\tAuthorization and Provisioning for V2X communications\t16\n5.1.1\tGeneral\t16\n5.1.2\tAuthorization and Provisioning for V2X communications over PC5 reference point\t17\n5.1.2.1\tPolicy/Parameter provisioning\t17\n5.1.2.2\tPrinciples for applying parameters for V2X communications over PC5 reference point\t18\n5.1.3\tAuthorization and provisioning for V2X communications over Uu reference point\t19\n5.1.3.1\tPolicy/Parameter provisioning\t19\n5.2\tV2X communication\t20\n5.2.1\tV2X communication over PC5 reference point\t20\n5.2.1.1\tGeneral\t20\n5.2.1.2\tBroadcast mode communication over PC5 reference point\t21\n5.2.1.3\tGroupcast mode communication over PC5 reference point\t21\n5.2.1.4\tUnicast mode communication over PC5 reference point\t21\n5.2.1.5\tIP address allocation\t23\n5.2.2\tV2X communication over Uu reference point\t23\n5.2.2.1\tV2X communication via unicast\t23\n5.2.3\tV2X communication over PC5 or Uu reference point\t24\n5.2.3.1\tGeneral\t24\n5.3\tV2X Application Server discovery\t24\n5.3.1\tGeneral\t24\n5.3.2\tMultiple V2X Application Server and Localized V2X Application Server discovery and routing\t25\n5.4\tQoS handling for V2X communication\t25\n5.4.1\tQoS handling for V2X communication over PC5 reference point\t25\n5.4.1.1\tQoS model\t25\n5.4.1.1.1\tGeneral overview\t25\n5.4.1.1.2\tDeriving PC5 QoS parameters and assigning PFI for PC5 QoS Flow\t27\n5.4.1.1.3\tHandling of PC5 QoS Flows based on PC5 QoS Rules\t27\n5.4.1.1.4\tPC5 Packet Filter Set\t29\n5.4.1.2\tQoS handling for broadcast mode V2X communication over PC5 reference point\t29\n5.4.1.3\tQoS handling for groupcast mode V2X communication over PC5 reference point\t30\n5.4.1.4\tQoS handling for unicast mode V2X communication over PC5 reference point\t30\n5.4.2\tPC5 QoS parameters\t30\n5.4.2.1\tPQI\t30\n5.4.2.2\tPC5 Flow Bit Rates\t30\n5.4.2.3\tPC5 Link Aggregated Bit Rates\t31\n5.4.2.4\tRange\t31\n5.4.2.5\tDefault Values\t31\n5.4.3\tPC5 QoS characteristics\t31\n5.4.3.1\tGeneral\t31\n5.4.3.2\tResource Type\t31\n5.4.3.3\tPriority Level\t32\n5.4.3.4\tPacket Delay Budget\t32\n5.4.3.5\tPacket Error Rate\t32\n5.4.3.6\tAveraging Window\t32\n5.4.3.7\tMaximum Data Burst Volume\t32\n5.4.4\tStandardized PQI to QoS characteristics mapping\t32\n5.4.5\tQoS handling for V2X communication over Uu reference point\t33\n5.4.5.1\tGeneral\t33\n5.4.5.2\tNotification on QoS Sustainability Analytics to the V2X Application Server\t34\n5.4.5.2.1\tGeneral\t34\n5.4.5.2.2\tFunctional description\t34\n5.4.5.3\tQoS Change based on Extended NG-RAN Notification to support Alternative Service Requirements\t34\n5.5\tSubscription to V2X services\t35\n5.6\tIdentifiers\t35\n5.6.1\tIdentifiers for V2X communication over PC5 reference point\t35\n5.6.1.1\tGeneral\t35\n5.6.1.2\tIdentifiers for broadcast mode V2X communication over PC5 reference point\t36\n5.6.1.3\tIdentifiers for groupcast mode V2X communication over PC5 reference point\t36\n5.6.1.4\tIdentifiers for unicast mode V2X communication over PC5 reference point\t36\n5.7\tSupport for V2X communication for UEs in limited service state\t36\n5.8\tInterworking between EPS V2X and 5GS V2X\t37\n5.8.1\tV2X Policy and parameter provisioning\t37\n5.8.2\tPC5 Operation\t37\n5.8.3\tMobility between EPS and 5GS over Uu\t37\n6\tFunctional description and information flows\t37\n6.1\tControl and user plane stacks\t37\n6.1.1\tUser plane for NR PC5 reference point supporting V2X services\t37\n6.1.2\tControl plane for NR PC5 reference point supporting V2X services\t38\n6.2\tProcedures for Service Authorization and Provisioning to UE\t39\n6.2.1\tGeneral\t39\n6.2.2\tPCF based Service Authorization and Provisioning to UE\t39\n6.2.3\tPCF discovery\t39\n6.2.4\tProcedure for UE triggered V2X Policy provisioning\t40\n6.2.5\tAF-based service parameter provisioning for V2X communications over control plane\t40\n6.3\tProcedures for V2X communication over PC5 reference point\t40\n6.3.1\tBroadcast mode V2X communication over PC5 reference point\t40\n6.3.2\tGroupcast mode V2X communication over PC5 reference point\t41\n6.3.3\tUnicast mode V2X communication over PC5 reference point\t42\n6.3.3.1\tLayer-2 link establishment over PC5 reference point\t42\n6.3.3.2\tLink identifier update for a unicast link\t46\n6.3.3.3\tLayer-2 link release over PC5 reference point\t47\n6.3.3.4\tLayer-2 link modification for a unicast link\t47\n6.3.3.5\tLayer-2 link maintenance over PC5 reference point\t48\n6.4\tProcedures for V2X communication over Uu reference point\t49\n6.4.1\tProcedure for notification on QoS Sustainability Analytics to the V2X Application Server\t49\n6.5\tProcedures for Service Authorization to NG-RAN for V2X communications over PC5 reference point\t51\n6.5.1\tGeneral\t51\n6.5.2\tRegistration procedure\t51\n6.5.3\tService Request procedure\t51\n6.5.4\tN2 Handover procedure\t52\n6.5.5\tXn Handover procedure\t52\n6.5.6\tSubscriber Data Update Notification to AMF\t52\n6.5.7\tDelivery of PC5 QoS parameters to NG-RAN\t52\n6.5.8\tPC5 Capability for V2X indication and V2X related information per PC5 RAT\t53\nAnnex A (informative): Application Function influence based edge computing for V2X services\t54\nAnnex B (informative): Road Side Unit (RSU) implementation options\t55\nAnnex C (informative): Change history\t56\n\n\nForeword\nThis Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).\nThe contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:\nVersion x.y.z\nwhere:\nx\tthe first digit:\n1\tpresented to TSG for information;\n2\tpresented to TSG for approval;\n3\tor greater indicates TSG approved document under change control.\ny\tthe second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.\nz\tthe third digit is incremented when editorial only changes have been incorporated in the document.\n1\tScope\nThe present document specifies architecture enhancements to the 5G System to facilitate vehicular communications for Vehicle-to-Everything (V2X) services, over the following reference points, based on service requirements defined in TS 22.185 [2] and TS 22.186 [3]:\n-\tPC5 reference point: NR PC5 RAT, LTE PC5 RAT.\n-\tUu reference point: NR, E-UTRA.\nThis specification also covers interworking with EPS.\n2\tReferences\nThe following documents contain provisions which, through reference in this text, constitute provisions of the present document.\n-\tReferences are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.\n-\tFor a specific reference, subsequent revisions do not apply.\n-\tFor a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.\n[1]\t3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".\n[2]\t3GPP TS 22.185: \"Service requirements for V2X services; Stage 1\".\n[3]\t3GPP TS 22.186: \"Enhancement of 3GPP support for V2X scenarios; Stage 1\".\n[4]\tISO 17419:2018: \"Intelligent transport systems - Cooperative systems - Globally unique identification\".\n[5]\tIEEE Std 1609.12-2016: \"IEEE Standard for Wireless Access in Vehicular Environments (WAVE) - Identifier Allocations\".\n[6]\t3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".\n[7]\t3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".\n[8]\t3GPP TS 23.285: \"Architecture enhancements for V2X services\".\n[9]\t3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall description; Stage 2\".\n[10]\t3GPP TS 36.304: \"Evolved Universal Terrestrial Radio Access (E-UTRA); User Equipment (UE) procedures in idle mode\".\n[11]\t3GPP TS 38.300: \"NR; NR and NG-RAN Overall Description; Stage 2\".\n[12]\t3GPP TS 38.304: \"NR; User Equipment (UE) procedures in Idle mode and RRC Inactive state\".\n[13]\t3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile Station (MS) in idle mode\".\n[14]\t3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA); Radio Resource Control (RRC); Protocol specification\".\n[15]\t3GPP TS 38.331: \"NR; Radio Resource Control (RRC); protocol specification\".\n[16]\t3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G System; Stage 2\".\n[17]\t3GPP TS 23.303: \"Proximity-based Services (ProSe); Stage 2\".\n[18]\tIEEE Std 1609.3-2010: \"IEEE Standard for Wireless Access in Vehicular Environments (WAVE) - Networking Services\".\n[19]\tISO 29281-1:2013: \"Intelligent Transport Systems - Communications access for land mobiles (CALM) - Non-IP networking - Part 1: Fast networking & transport layer protocol (FNTP)\".\n[20]\t3GPP TS 23.288: \"Architecture enhancements for 5G System (5GS) to support network data analytics services\".\n[21]\tIETF RFC 4862: \"IPv6 Stateless Address Autoconfiguration\".\n[22]\t3GPP TS 38.413: \"NG-RAN; NG Application Protocol (NGAP)\".\n[23]\t3GPP TS 38.423: \"NG-RAN; Xn Application Protocol (XnAP)\".\n[24]\t3GPP TS 24.587: \"Vehicle-to-Everything (V2X) services in 5G System (5GS); Stage 3\".\n[25]\t3GPP TS 37.340: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and NR; Multi-connectivity; Stage 2\".\n[26]\t3GPP TS 33.536: \"Security aspects of 3GPP support for advanced Vehicle-to-Everything (V2X) services\".\n[27]\tCCSA YD/T 3707-2020: \"Technical requirements of network layer of LTE-based vehicular communication\".\n3\tDefinitions and abbreviations\n3.1\tDefinitions\nFor the purposes of the present document, the terms and definitions given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].\nApplication Layer connection-less group: An application layer group without group formation in the V2X application layer, e.g., sensor sharing.\nApplication Layer ID: An identifier identifying an entity, e.g. a vehicle, a pedestrian, an RSU within the context of a specific V2X application. The format of this identifier is outside the scope of 3GPP.\nNOTE 1:\tThe Application Layer ID could be e.g. Station ID or Vehicle ID defined by other SDOs e.g. ETSI, Society of Automotive Engineers (SAE), etc.\nNOTE 2:\tThe usage of Application Layer ID, e.g. one Application Layer ID is associated with one V2X application, one Application Layer ID is associated with more than one V2X applications, or one Application Layer ID is used for all V2X applications in the UE, is up to application layer implementation.\nApplication Layer managed group: An application layer group with group formation and management in the V2X application layer, e.g., platooning, cooperative adaptive cruise control.\nGroupcast mode communication: It refers to V2X communication over PC5 reference point within a group of UEs where any UE in the group can act as transmitting UE and the rest act as receiving UEs. See also TS 38.300 [11] for more information. The \"group\" here refers to Application Layer managed group or Application Layer connection-less group.\nMember ID: An identifier uniquely identifying a member in the Application Layer managed group and that is managed by the V2X application layer.\nMode of communication: Mode of communication to be used by the UE over PC5 reference point i.e. broadcast mode (LTE PC5 and NR PC5), groupcast mode (NR PC5) or unicast mode (NR PC5).\nTx Profile: The transmission format (i.e. which 3GPP Release) to be used by the UE over a given PC5 RAT, see TS 36.300 [9] and TS 38.300 [11].\nV2X application: An application using one or more V2X services e.g. an active safety application in a vehicle, using V2X services such as emergency warning and vehicle to vehicle safety and awareness. A V2X application may operate towards a V2X Application Server.\nV2X communication: A communication to support Vehicle-to-Everything (V2X) services leveraging Uu and / or PC5 reference points. V2X services are realized by various types of V2X applications, i.e. Vehicle-to-Vehicle (V2V), Vehicle-to-Pedestrian (V2P), Vehicle-to-Infrastructure (V2I) and Vehicle-to-Network (V2N).\nV2X message: A dedicated messaging type of V2X service, for example ITS messages.\nV2X service: A data service, offered to V2X applications and optionally V2X Application Servers. A V2X service belongs to one V2X service type. It may include message or other data delivery, as defined in TS 22.185 [2] and TS 22.186 [3]. A V2X service can be associated with one or more V2X applications, and a V2X application can be associated with one or more V2X services.\nV2X service type: A type of V2X service, which is identified by e.g. ITS-AID (ITS Application Identifier), PSID (Provider Service Identifier) or AID (Application Identifier).\nFor the purposes of the present document, the following terms and definitions given in ISO 17419:2018 [4] apply:\nIntelligent Transport Systems\nITS Application Identifier\nFor the purposes of the present document, the following term and definition given in IEEE Std 1609.12-2016 [5] apply:\nProvider Service Identifier\nFor the purposes of the present document, the following term and definition given in CCSA YD/T 3707-2020 [27] applies:\nApplication Identifier\n3.2\tAbbreviations\nFor the purposes of the present document, the abbreviations given in TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [1].\nAF\tApplication Function\nAID\tApplication Identifier\nAS layer\tAccess Stratum layer\nITS\tIntelligent Transport Systems\nITS-AID\tITS Application Identifier\nPFI\tPC5 QoS Flow Identifier\nPQI\tPC5 5QI\nPSID\tProvider Service Identifier\nRSU\tRoad Side Unit\nV2I\tVehicle-to-Infrastructure\nV2N\tVehicle-to-Network\nV2P\tVehicle-to-Pedestrian\nV2V\tVehicle-to-Vehicle\nV2X\tVehicle-to-Everything\n\n4\tArchitecture model and concepts\n4.1\tGeneral concept\nThere are two modes of operation for V2X communication, namely V2X communication over PC5 reference point and V2X communication over Uu reference point. These two operation modes may be used by a UE independently for transmission and reception.\nV2X communications over PC5 reference point are supported by LTE and/or NR.\nV2X communications over Uu reference point are supported by E-UTRA connected to 5GC and/or NR connected to 5GC. In this release, V2X communication over Uu reference point is only unicast.\nAn RSU is not an architectural entity, but an implementation option. This is achieved by collocating a V2X application logic/server with some entities of the 3GPP system, as shown in examples in Annex B.\n4.2\tArchitectural reference model\n4.2.1\tPC5 and Uu based V2X architecture reference model\n4.2.1.1\tNon-roaming 5G System architecture for V2X communication over PC5 and Uu reference points\nFigure 4.2.1.1-1 shows the high level view of the non-roaming 5G System architecture for V2X communication over PC5 and Uu reference points.\n\nFigure 4.2.1.1-1: Non-roaming 5G System architecture for V2X communication over PC5 and Uu reference points\n4.2.1.2\tRoaming 5G System architecture for V2X communication over PC5 and Uu reference points\nFigure 4.2.1.2-1 and Figure 4.2.1.2-2 show the high level view of the roaming 5G System architectures for V2X communication over PC5 and Uu reference points. In these figures, UE A uses a subscription of HPLMN.\n\nFigure 4.2.1.2-1: Roaming 5G System architecture for V2X communication over PC5 and Uu reference points - Local breakout scenario\n\nFigure 4.2.1.2-2: Roaming 5G System architecture for V2X communication over PC5 and Uu reference points - Home routed scenario\n4.2.1.3\tInter-PLMN 5G System architecture for V2X communication over PC5 reference point\nIn the case of inter-PLMN V2X communication over PC5 reference point, the PC5 parameters need to be configured in a consistent way among the UEs within a certain region. The architecture for the Inter-PLMN PC5 case is similar to the one defined in clause 4.2.1.1.\n4.2.2\tAF-based service parameter provisioning for V2X communications\nThe 5G System provides NEF services to enable communication between NFs in the PLMN and V2X Application Server. Figure 4.2.2-1 shows the high level view of AF-based service parameter provisioning for V2X communications. The V2X Application Server may provide V2X service parameters to the PLMN via NEF. The NEF stores the V2X service parameters in the UDR.\n\nFigure 4.2.2-1: 5G System architecture for AF-based service parameter provisioning for V2X communications\n4.2.3\tReference points\nV1:\tThe reference point between the V2X applications in the UE and in the V2X Application Server. This reference point is out of scope of this specification.\nV5:\tThe reference point between the V2X applications in the UEs. This reference point is not specified in this release of the specification.\nPC5:\tThe reference point between the UEs, and it includes the LTE based PC5 and/or NR based PC5.\nN1:\tIn addition to the relevant functions defined in TS 23.501 [6] for N1, in the case of V2X Service it is also used to convey the V2X policy and parameters (including service authorization) from AMF to UE and to convey the UE's V2X Capability and PC5 Capability for V2X information from UE to AMF.\nN2:\tIn addition to the relevant functions defined in TS 23.501 [6] for N2, in the case of V2X Service it is also used to convey the V2X policy and parameters (including service authorization) from AMF to NG-RAN.\nUu:\tThe reference point between the UE and the NG-RAN.\n4.2.4\tService-based interfaces\nNudm:\tIn addition to the relevant services defined in TS 23.501 [6] for Nudm, in the case of V2X Service, services provided by UDM are used to get V2X Service related subscription information to AMF during Initial registration procedure or UE Configuration Update (UCU) procedure to inform AMF subscription information has changed.\nNpcf:\tIn addition to the relevant services defined in TS 23.501 [6] for Npcf, in the case of V2X Service, services provided by H-PCF are used to provide V2X Service related parameters to V-PCF for UE and NG-RAN in the roaming case.\nNudr:\tIn addition to the relevant services defined in TS 23.501 [6] for Nudr, in the case of V2X Service, services provided by UDR are used to notify the PCF and the UDM of the update of the V2X Service related information.\nNnef:\tIn addition to the relevant services defined in TS 23.501 [6] for Nnef, in the case of V2X Service, services provided by NEF are used by the V2X Application Server to update V2X Service related information of 5GC.\nNamf:\tIn addition to the relevant services defined in TS 23.501 [6] for Namf, in the case of V2X Service, services provided by AMF are consumed by PCF to provide the V2X Service related parameters for the UE and the NG-RAN to AMF, and to enable the AMF create or update UE context related to V2X service.\nNnrf:\tIn addition to the relevant services defined in TS 23.501 [6] for Nnrf, in the case of V2X Service, services provided by NRF are used to discover the PCF that supports V2X.\n4.3\tArchitecture reference model for interworking with EPS V2X\nThe interworking between 5GS V2X and EPS V2X does not require any new interface between 5GS V2X and EPS V2X architectures and does not impact existing network function entities in EPC and 5GC. Figure 4.3-1 shows one of the architecture reference models.\n\nLegend:\n-\tThe functions and reference points for EPS V2X are defined in TS 23.285 [8].\n\nFigure 4.3-1: Architecture for interworking with EPS V2X, Local breakout roaming\n4.4\tFunctional entities\n4.4.1\tUE\nIn addition to the functions defined in TS 23.501 [6], the UE may support the following functions:\n-\tReport the V2X Capability and PC5 Capability for V2X to 5GC over N1 reference point.\n-\tIndicate V2X Policy Provisioning Request in UE Policy Container for UE triggered V2X Policy provisioning.\n-\tReceive the V2X parameters from 5GC over N1 reference point.\n-\tProcedures for V2X communication over PC5 reference point.\n-\tConfiguration of parameters for V2X communication (e.g., destination Layer-2 IDs, radio resource parameters, V2X Application Server address information, mapping between V2X service types and V2X frequencies, see clause 5.1). These parameters can be pre-configured in the UE, or, if in coverage, provisioned or updated by signalling over the N1 reference point from the PCF in the HPLMN or over V1 reference point from the V2X Application Server.\n4.4.2\tPCF\nIn addition to the functions defined in TS 23.501 [6], the PCF includes the function to provision the UE and AMF with necessary parameters in order to use V2X communication:\n-\tMay determine the V2X Policy/Parameter for specific PC5 RAT to provision to the UE based on the received UE's PC5 Capability for V2X.\n-\tDetermines whether to provision V2X Policy/parameters for V2X communication over PC5 reference point and/or V2X communication over Uu reference point to the UE.\n-\tProvision the UEs with authorization and policy parameters for V2X communication over PC5 reference point.\n-\tProvision the UEs with policy parameters for V2X communication over Uu reference point.\n-\tProvision the AMF with PC5 QoS parameters as defined in clause 5.4.2 used by NG-RAN.\n-\tRetrieve V2X parameters from UDR.\n4.4.3\tV2X Application Server\nThe V2X Application Server (V2X AS) includes AF functionality, and may support at least the following capabilities:\nFor V2X services handling,\n-\tReceive uplink data from the UE over unicast.\n-\tSend downlink data to the UE over unicast.\n-\tRequest QoS Sustainability Analytics for potential QoS changes in a geographic area from NWDAF via NEF.\nFor V2X service parameters provisioning,\n-\tProvision the 5GC with parameters for V2X communications over PC5 and Uu reference points.\n-\tProvision the UE with parameters for V2X communications over PC5 reference point and/or Uu reference point.\nNOTE:\tThe V2X Application Servers for V2X services handling and V2X service parameter provisioning can be the same or different.\n4.4.4\tAMF\nIn addition to the functions defined in TS 23.501 [6], the AMF performs the following functions:\n-\tObtain from UDM the subscription information related to V2X and store them as part of the UE context data.\n-\tSelect a PCF supporting V2X Policy/Parameter provisioning and report the PC5 Capability for V2X to the selected PCF.\n-\tObtain from PCF the PC5 QoS information related to V2X and store it as part of the UE context data.\n-\tProvision the NG-RAN with indication about the UE authorization status about V2X communication over PC5 reference point.\n-\tProvision the NG-RAN with PC5 QoS parameters related to V2X communication.\n4.4.5\tUDM\nIn addition to the functions defined in TS 23.501 [6], the UDM performs the following functions:\n-\tSubscription management for V2X communication over PC5 reference point.\n4.4.6\tUDR\nIn addition to the functions defined in TS 23.501 [6], the UDR performs the following functions:\n-\tStores V2X service parameters.\n4.4.7\tNRF\nIn addition to the functions defined in TS 23.501 [6], the NRF performs the following functions:\n-\tPCF discovery by considering V2X capability.\n5\tHigh level functionality and features\n5.1\tAuthorization and Provisioning for V2X communications\n5.1.1\tGeneral\nIn 5GS, the parameters for V2X communications over PC5 and Uu reference points may be made available to the UE in following ways:\n-\tpre-configured in the ME; or\n-\tconfigured in the UICC; or\n-\tpreconfigured in the ME and configured in the UICC; or\n-\tprovided/updated by the V2X Application Server via PCF and/or V1 reference point; or\n-\tprovided/updated by the PCF to the UE.\nIf the same parameters described in clauses 5.1.2.1 and 5.1.3.1 are provided by different sources, the UE shall consider them in the following priority order:\n-\tprovided/updated by the PCF;\n-\tprovided/updated by the V2X Application Server via V1 reference point;\n-\tconfigured in the UICC;\n-\tpre-configured in the ME.\nThe parameters provided/updated by the V2X Application Server via V1 reference point may need to be complemented with configuration data from other sources listed above.\nThe basic principles of service authorization and provisioning for V2X communication over PC5 reference point and provisioning for V2X communication over Uu reference point are:\n-\tThe UE may be authorized to use V2X communication over PC5 reference point on a per PLMN basis by the PCF in the HPLMN.\n-\tThe PCF in the HPLMN merges authorization information from home and other PLMNs and provides the UE with the final authorization information.\n-\tThe PCF in the VPLMN or HPLMN may revoke the authorization (via H-PCF when roaming) at any time by using the UE Configuration Update procedure for transparent UE Policy delivery procedure defined in clause 4.2.4.3 of TS 23.502 [7].\n-\tThe provisioning to UE for V2X communication over PC5 and Uu reference points is controlled by the PCF and may be triggered by UE. The PCF includes the V2X Policy/parameters for V2X communications over PC5 reference point as specified in clause 5.1.2.1 and/or the V2X Policy/parameters for V2X communications over Uu reference point as specified in clause 5.1.3.1 into a Policy Section identified by a Policy Section Identifier (PSI) as specified in clause 6.1.2.2.2 of TS 23.503 [16].\n5.1.2\tAuthorization and Provisioning for V2X communications over PC5 reference point\n5.1.2.1\tPolicy/Parameter provisioning\nThe following sets of information for V2X communications over PC5 reference point is provisioned to the UE:\n1)\tAuthorization policy:\n-\tWhen the UE is \"served by E-UTRA\" or \"served by NR\":\n-\tPLMNs in which the UE is authorized to perform V2X communications over PC5 reference point when \"served by E-UTRA\" or \"served by NR\".\n\tFor each above PLMN:\n-\tRAT(s) over which the UE is authorized to perform V2X communications over PC5 reference point.\n-\tWhen the UE is \"not served by E-UTRA\" and \"not served by NR\":\n-\tIndicates whether the UE is authorized to perform V2X communications over PC5 reference point when \"not served by E-UTRA\" and \"not served by NR\".\n-\tRAT(s) over which the UE is authorized to perform V2X communications over PC5 reference point.\nNOTE 1:\tIn this specification, {When the UE is \"served by E-UTRA\" or \"served by NR\"} and {When the UE is \"not served by E-UTRA\" and \"not served by NR\"} are relevant to V2X communications over PC5 reference point.\n2)\tRadio parameters when the UE is \"not served by E-UTRA\" and \"not served by NR\":\n-\tIncludes the radio parameters per PC5 RAT (i.e. LTE PC5, NR PC5) with Geographical Area(s) and an indication of whether they are \"operator managed\" or \"non-operator managed\". These radio parameters (e.g., frequency bands) are defined in TS 36.331 [14] and TS 38.331 [15]. The UE uses the radio parameters to perform V2X communications over PC5 reference point when \"not served by E-UTRA\" and \"not served by NR\" only if the UE can reliably locate itself in the corresponding Geographical Area. Otherwise, the UE is not authorized to transmit.\nNOTE 2:\tWhether a frequency band is \"operator managed\" or \"non-operator managed\" in a given Geographical Area is defined by local regulations.\n3)\tPolicy/parameters for PC5 RAT selection and for PC5 Tx Profile selection:\n-\tThe mapping of V2X service types to PC5 RAT(s) (e.g. LTE PC5, NR PC5 or both), and to the corresponding Tx Profiles (see TS 36.300 [9] and TS 38.300 [11] for further information).\n4)\tPolicy/parameters related to privacy:\n-\tThe list of V2X service types, with Geographical Area(s) that require privacy support.\n-\tA privacy timer value indicating the duration after which the UE shall change each source Layer-2 ID self-assigned by the UE when privacy is required.\n5)\tPolicy/parameters when LTE PC5 is selected:\n\tSame as specified in TS 23.285 [8] clause 4.4.1.1.2 item 3) Policy/parameters except for the mapping of V2X service types to Tx Profiles and the list of V2X services with Geographical Area(s) that require privacy support.\n6)\tPolicy/parameters when NR PC5 is selected:\n-\tThe mapping of V2X service types to V2X frequencies with Geographical Area(s).\n-\tThe mapping of V2X service types to the default mode of communication (i.e. broadcast mode, groupcast mode or unicast mode).\n-\tThe mapping of V2X service types to Destination Layer-2 ID(s) for broadcast.\n-\tThe mapping of V2X service types to Destination Layer-2 ID(s) for groupcast mode communication.\n-\tThe mapping of V2X service types to default Destination Layer-2 ID(s) for initial signalling to establish unicast connection.\nNOTE 3:\tThe same default Destination Layer-2 ID for unicast initial signalling can be mapped to more than one V2X service types. In the case where different V2X services are mapped to distinct default Destination Layer-2 IDs, when the UE intends to establish a single unicast link that can be used for more than one V2X service types, the UE can select any of the default Destination Layer-2 IDs to use for the initial signalling.\n-\tThe mapping of V2X service types to PC5 QoS parameters defined in clause 5.4.2 (i.e. PQI and conditionally other parameters such as MFBR/GFBR, etc.).\n-\tAS layer configurations (see TS 38.331 [15]), e.g. the mapping of PC5 QoS profile(s) to radio bearer(s), when the UE is \"not served by E-UTRA\" and \"not served by NR\".\n-\tThe PC5 QoS profile contains PC5 QoS parameters described in clause 5.4.2, and value for the QoS characteristics regarding Priority Level, Averaging Window, Maximum Data Burst Volume if default value is not used as defined in Table 5.4.4-1.\n7)\tValidity timer indicating the expiration time of the V2X Policy/Parameter.\nThe above parameter sets from bullet 2) to 6) may be configured in the UE through the V1 reference point by the V2X Application Server.\n5.1.2.2\tPrinciples for applying parameters for V2X communications over PC5 reference point\nFor V2X communication over PC5 reference point, the operator may pre-configure the UEs with the required provisioning parameters for V2X communication, without the need for the UEs to connect to the 5GC to get this initial configuration. The following apply:\n-\tThe provisioning parameters for V2X communications over PC5 reference point may be configured in the UICC, in the ME, or in both the UICC and the ME.\n-\tThe ME provisioning parameters shall not be erased when a USIM is deselected or replaced.\n-\tIf both the UICC and the ME contain the same set of overlapping provisioning parameters, the set of parameters from the UICC shall take precedence.\n-\tThe provisioning parameters from the PCF or V2X Application Server via V1 reference point shall take precedence over the pre-configured parameters in the ME and UICC as defined in clause 5.1.1.\n-\tThe UE shall use radio resources for V2X communications over PC5 reference point as follows:\n-\tWhile a UE has a serving cell and is camped on a cell and the UE intends to use for V2X service the radio resources (i.e. carrier frequency) operated by this cell, then the UE shall use the radio resource description indicated by this cell the UE is camped on and ignore any radio resource description of the same radio resource provisioned in the ME or the UICC. If the cell does not provide radio resources for V2X service, the UE shall not perform V2X message transmission and reception on radio resources operated by this cell.\n-\tIf the UE intends to use \"operator-managed\" radio resources (i.e. carrier frequency) for V2X service that are not operated by the UE's serving cell, as specified in clause 5.1.2.1, or if the UE is out of coverage, the UE shall search for a cell in any PLMN that is operating the provisioned radio resources (i.e. carrier frequency) as defined in TS 36.300 [9] and TS 36.304 [10] (if LTE based PC5 is selected for the V2X communication) or as defined in TS 38.300 [11] and TS 38.304 [12] (if NR based PC5 is selected for the V2X communication), and:\n-\tIf the UE finds such a cell in the registered PLMN or a PLMN equivalent to the registered PLMN, and authorization for V2X communications over PC5 reference point to this PLMN is confirmed, the UE shall use the radio resource description indicated by that cell. If that cell does not provide radio resources for V2X service, the UE shall not perform V2X message transmission and reception on those radio resources.\n-\tIf the UE finds such a cell but not in the registered PLMN or a PLMN equivalent to the registered PLMN, and that cell belongs to a PLMN authorized for V2X communications over PC5 reference point and provides radio resources for V2X service then the UE shall perform PLMN selection triggered by V2X communications over PC5 reference point as defined in TS 23.122 [13]. If the UE has an ongoing emergency session via IMS, it shall not trigger any PLMN selection due to V2X communication over PC5 reference point.\n-\tIf the UE finds such cell but not in a PLMN authorized for V2X communications over PC5 reference point the UE shall not use V2X communications over PC5 reference point.\n-\tIf the UE does not find any such cell in any PLMN, then the UE shall consider itself \"not served by NR or E-UTRA\" and use radio resources provisioned in the ME or the UICC. If no such provision exists in the ME or the UICC or the provision does not authorize V2X communications over PC5 reference point, then the UE is not authorized to transmit.\n-\tIf the UE intends to use \"non-operator-managed\" radio resources (i.e. carrier frequency) for V2X service, according to TS 36.331 [14] or TS 38.331 [15] and as specified in clause 5.1.2.1, then the UE shall perform V2X communication over PC5 using resource provisioned in the ME or the UICC. If no such provision exists in the ME or the UICC or the provision does not authorize V2X communications over PC5 reference point, then the UE is not authorized to transmit.\n-\tThe UE provisioning shall support setting Geographical Areas.\nNOTE 1:\tIt is possible for a UE to use other radio resources for V2X service based on the Geographical Area instead of those operated by the serving NG-RAN cell, when provisioned in the UE, even if the UE's serving cell offers normal service and the SIBs for NR sidelink communication or V2X sidelink communication defined in TS 38.331 [15] indicates that the service (V2X communication) is available. This is to cover the scenario when e.g. the radio resources used for V2X communications over PC5 reference point are not owned by the serving network of the UE.\nNOTE 2:\tWhen cross-carrier operation is supported, according to TS 36.331 [14] or TS 38.331 [15], a UE can be instructed by its serving cell to perform V2X communication over a different carrier frequency. The UE is still considered as \"served by NR or E-UTRA\" in this case.\nNOTE 3:\tThe scenario that a cell is detected and the cell does not provide support for V2X communications over PC5 reference point when the UE attempts to use a carrier frequency configured for V2X communications over PC5 reference point, is considered a configuration error. Therefore, the UE does not transmit on that frequency to avoid interference to the network.\n-\tThe V2X communications over PC5 reference point is only specified for E-UTRA and NR.\nNOTE 4:\tIt is out of scope of the present specification to define how the UE can locate itself in a specific Geographical Area. When the UE is in coverage of a 3GPP RAT, it can for example, use information derived from the serving PLMN. When the UE is not in coverage of a 3GPP RAT, it can use other techniques, e.g. Global Navigation Satellite System (GNSS). User provided location is not a valid input.\n5.1.3\tAuthorization and provisioning for V2X communications over Uu reference point\n5.1.3.1\tPolicy/Parameter provisioning\nThe following set of information may be provisioned to the UE for V2X communications over Uu reference point:\n1)\tMapping of the V2X service types to:\n-\tPDU Session Type (i.e. IP type or Unstructured type);\n-\tTransport layer protocol (i.e. UDP or TCP, only applicable for IP PDU Session type);\n-\tSSC Mode;\n-\tS-NSSAI(s);\n-\tDNN(s).\nNOTE:\tAbove listed information elements are optional and used by UE as UE Local Configuration specified in TS 23.503 [16].\n2)\tValidity timer indicating the expiration time of the V2X Policy/Parameter.\nThe following sets of information may be provisioned to the UE and is applicable for V2X communications over both LTE-Uu and Uu reference points:\n1)\tMapping of the V2X service types to V2X Application Server address information (consisting of IP address/FQDN and transport layer port#) for unicast.\n2)\tList of FQDNs or IP addresses of the V2X Application Servers, associated with served geographical area information and list of PLMNs that the configuration applies to.\n5.2\tV2X communication\n5.2.1\tV2X communication over PC5 reference point\n5.2.1.1\tGeneral\nFor V2X communication, two types of PC5 reference points exist: the LTE based PC5 reference point as defined in TS 23.285 [8], and the NR based PC5 reference point as defined in clause 4.2.3. A UE may use either type of PC5 or both for V2X communication depending on the services the UE supports. The V2X communication over PC5 reference point supports roaming and inter-PLMN operations. V2X communication over PC5 reference point is supported when UE is \"served by NR or E-UTRA\" or when the UE is \"not served by NR or E-UTRA\".\nA UE is authorized to transmit and receive V2X messages when it has valid authorization and configuration as specified in clause 5.1.2.\nThe V2X communication over PC5 reference point has the following characteristics:\n-\tV2X communication over LTE based PC5 reference point is connectionless, i.e. broadcast mode at Access Stratum (AS) layer, and there is no signalling over PC5 for connection establishment.\n-\tV2X communication over NR based PC5 reference point supports broadcast mode, groupcast mode, and unicast mode at AS layer. If V2X application layer of the UE indicates the mode of communication to V2X layer, the V2X layer shall set the mode of communication based on the request of the V2X application layer; otherwise, the V2X layer sets the mode of communication based on the mapping information for a V2X service type defined in clause 5.1.2.1. The V2X layer indicates the mode of communication for the V2X service type to the AS layer. Signalling over control plane over PC5 reference point for unicast mode communication management is supported.\n-\tV2X services communication support between UEs over PC5 user plane.\n-\tBoth IP based and non-IP based V2X services communication are supported over PC5 reference point.\n-\tFor IP based V2X services communication, only IPv6 is used. IPv4 is not supported.\n-\tV2X messages are exchanged between UEs over PC5 user plane.\n-\tBoth IP based and non-IP based V2X messages are supported over PC5 reference point.\n-\tFor IP based V2X messages, only IPv6 is used. IPv4 is not supported.\nThe identifiers used in the V2X communication over PC5 reference point are described in clause 5.6.1. UE decides on the type of PC5 reference point and Tx Profile to use for the transmission of a particular packet based on the configuration described in clause 5.1.2. When the LTE based PC5 reference point is selected, the QoS handling corresponding procedures are defined in TS 23.285 [8]. When NR based PC5 reference point is selected, the QoS handling and procedures are defined in clauses 5.4.1 and 6.3.\nIf the UE has an ongoing emergency session via IMS, the ongoing emergency session via IMS shall be prioritized over V2X communication over PC5 reference point.\nNOTE:\tThe emergency session via IMS setup is based on appropriate regional/national regulatory requirements and operator policies as defined in TS 23.501 [6].\nThe security for V2X communication over PC5 reference point is provided with mechanisms defined in TS 33.536 [26]. For broadcast and groupcast mode communication, security is supported in the V2X application layer schemes developed in other SDOs.\n5.2.1.2\tBroadcast mode communication over PC5 reference point\nBroadcast mode of communication is supported over both LTE based PC5 reference point and NR based PC5 reference point. Therefore, when broadcast mode is selected for transmission over PC5 reference point, PC5 RAT selection needs to be performed based on configuration described in clause 5.1.2. Based on configuration described in clause 5.1.2 and the availability of the corresponding PC5 RAT(s) for the specific V2X service type, the V2X layer in the UE determines PC5 RAT(s) and passes the packet to the applicable PC5 AS (Access Stratum) layer(s) with the appropriate PC5 QoS parameters as defined in clause 5.4.1.1.1\nFor LTE based PC5 reference point, broadcast mode is the only supported communication mode, and the operation details are defined in TS 23.285 [8].\nFor NR based PC5 reference point, the broadcast mode also supports enhanced QoS handling as defined in clause 5.4.1.\n5.2.1.3\tGroupcast mode communication over PC5 reference point\nGroupcast mode communication is only supported over NR based PC5 reference point and applies to all types of groups, i.e. Application Layer connection-less group and Application Layer managed group.\nFor Application Layer managed group, the following applies:\n-\tIf the V2X application layer provides a group size and a member ID, the V2X layer passes them to the AS layer for groupcast control, as defined in TS 38.300 [11].\nNOTE:\tIt is assumed that the V2X application layer provides accurate and up-to-date information on the group size and the member ID.\nQoS handling for groupcast mode communication is defined in clause 5.4.1.\n5.2.1.4\tUnicast mode communication over PC5 reference point\nUnicast mode of communication is only supported over NR based PC5 reference point. Figure 5.2.1.4-1 illustrates an example of PC5 unicast links.\n\nFigure 5.2.1.4-1: Example of PC5 Unicast Links\nThe following principles apply when the V2X communication is carried over PC5 unicast link:\n-\tA PC5 unicast link between two UEs allows V2X communication between one or more pairs of peer V2X services in these UEs. All V2X services in the UE using the same PC5 unicast link use the same Application Layer ID.\nNOTE 1:\tAn Application Layer ID can change in time as described in clauses 5.6.1.1 and 6.3.3.2, due to privacy. This does not cause a re-establishment of a PC5 unicast link. The UE triggers a Link Identifier Update procedure as specified in clause 6.3.3.2.\n-\tOne PC5 unicast link supports one or more V2X service types) if these V2X service types are at least associated with the pair of peer Application Layer IDs for this PC5 unicast link. For example, as illustrated in Figure 5.2.1.4-1, UE A and UE B have two PC5 unicast links, one between peer Application Layer ID 1/UE A and Application Layer ID 2/UE B and one between peer Application Layer ID 3/UE A and Application Layer ID 4/UE B.\nNOTE 2:\tA source UE is not required to know whether different target Application Layer IDs over different PC5 unicast links belong to the same target UE.\n-\tA PC5 unicast link supports V2X communication using a single network layer protocol e.g. IP or non-IP.\n-\tA PC5 unicast link supports per-flow QoS model as specified in clause 5.4.1.\n-\tIf multiple V2X service types use a PC5 unicast link, one PC5 QoS Flow identified by PFI may be associated with more than one V2X service types.\nWhen the Application layer in the UE initiates data transfer for a V2X service type which requires unicast mode of communication over PC5 reference point:\n-\tthe UE shall reuse an existing PC5 unicast link if the pair of peer Application Layer IDs and the network layer protocol of this PC5 unicast link are identical to those required by the application layer in the UE for this V2X service, and modify the existing PC5 unicast link to add this V2X service type as specified in clause 6.3.3.4; otherwise\n-\tthe UE shall trigger the establishment of a new PC5 unicast link as specified in clause 6.3.3.1.\nAfter successful PC5 unicast link establishment, UE A and UE B use the same pair of Layer-2 IDs for subsequent PC5-S signalling message exchange and V2X service data transmission as specified in clause 5.6.1.4. The V2X layer of the transmitting UE indicates to the AS layer whether a transmission is for a PC5-S signalling message (i.e. Direct Communication Request/Accept, Link Identifier Update Request/Response/Ack, Disconnect Request/Response, Link Modification Request/Accept, Keep-alive/Ack) or V2X service data.\nFor every PC5 unicast link, a UE self-assigns a distinct PC5 Link Identifier that uniquely identifies the PC5 unicast link in the UE for the lifetime of the PC5 unicast link. Each PC5 unicast link is associated with a Unicast Link Profile which includes:\n-\tApplication Layer ID and Layer-2 ID of UE A; and\n-\tApplication Layer ID and Layer-2 ID of UE B; and\n-\tnetwork layer protocol used on the PC5 unicast link; and\n-\tthe information about PC5 QoS Flow(s). For each PC5 QoS Flow, the PC5 QoS Context and the PC5 QoS Rule(s) as defined in clause 5.4.1.1.3.\nFor privacy reason, the Application Layer IDs and Layer-2 IDs may change as described in clauses 5.6.1.1 and 6.3.3.2 during the lifetime of the PC5 unicast link and, if so, shall be updated in the Unicast Link Profile accordingly. The UE uses PC5 Link Identifier to indicate the PC5 unicast link to V2X Application layer, therefore V2X Application layer identifies the corresponding PC5 unicast link even if there are more than one unicast link associated with one V2X service type (e.g. the UE establishes multiple unicast links with multiple UEs for a same V2X service type).\nThe Unicast Link Profile shall be updated accordingly after a Layer-2 link modification for an established PC5 unicast link as specified in clause 6.3.3.4 or Layer-2 link identifier update as specified in clause 6.3.3.2.\nUpon receiving an indication from the AS layer that the PC5-RRC connection was released due to RLF, the V2X layer in the UE locally releases the PC5 unicast link associated with this PC5-RRC connection. The AS layer uses PC5 Link Identifier to indicate to the V2X layer the PC5 unicast link whose PC5-RRC connection was released.\nWhen the PC5 unicast link has been released as specified in clause 6.3.3.3, the V2X layer of each UE for the PC5 unicast link informs the AS layer that the PC5 unicast link has been released. The V2X layer uses PC5 Link Identifier to indicate the released unicast link.\n5.2.1.5\tIP address allocation\nFor unicast mode of V2X communication over PC5 reference point, the following mechanism for IP address/prefix allocation may be used:\na)\tIPv6 Stateless Address auto configuration specified in RFC 4862 [21] for assignment of IPv6 prefix, with one of the two UEs acting as IPv6 default router.\nNOTE 1:\tWhich UE acts as an IPv6 default router is negotiated during secure layer-2 link establishment by exchanging the IP Address Configuration as described in clause 6.3.3.1.\nb)\tIPv6 link-local addresses as defined in RFC 4862 [21] are formed by UEs locally. The IPv6 link-local addresses are exchanged during the establishment of a secure layer-2 link over PC5 reference point as described in clause 6.3.3.1. The UEs shall disable duplicate address detection after the layer-2 link is established.\nFor broadcast and groupcast modes of V2X communication over PC5 reference point, the following source IP address management applies:\n-\tThe UE configures a link local IPv6 address to be used as the source IP address, as defined in clause 4.5.3 of TS 23.303 [17]. The UE may use this IP address for V2X communication over PC5 reference point without sending Neighbour Solicitation and Neighbour Advertisement message for Duplicate Address Detection.\nNOTE 2:\tThe destination IP address management for broadcast and groupcast modes of V2X communication over PC5 reference point is left to UE implementation.\n5.2.2\tV2X communication over Uu reference point\n5.2.2.1\tV2X communication via unicast\nThe V2X communication via unicast over the Uu reference point supports non-roaming and roaming operations.\nFor transport of V2X messages over Uu reference point:\n-\tthe mechanisms defined in TS 23.501 [6] and TS 23.502 [7] can be used to establish the suitable PDU Sessions, and V2X messages are routed towards V2X Application Server or towards UEs with existing unicast routing.\n5.2.3\tV2X communication over PC5 or Uu reference point\n5.2.3.1\tGeneral\nV2X communication over PC5 reference point may use different protocols and formats than V2X communication over Uu reference point.\nFor a V2X service type that can use PC5 reference points or Uu reference point for the transmission of the same V2X messages, the following additional consideration apply for transport of V2X messages over Uu reference point:\n-\tfor transport of non-IP based V2X messages from the application:\n-\tIP encapsulation (i.e. IP PDU Session type) or Unstructured PDU Session type is used.\n-\tThe UE determines which method between IP encapsulation and Unstructured PDU Session type is used for non-IP based V2X messages based on the UE configuration as described in clause 5.1.3.1. If no such configuration is available, UE can use the method based on the UE implementation.\n-\twhen IP PDU Session type is used for transport of IP based or non-IP based V2X messages:\n-\tV2X messages are transported over UDP or TCP:\n-\tfor non-IP based V2X messages from the application, UE may learn from V2X Application Server or UE may be configured explicitly about a transport layer protocol needs to be used or no restriction imposed by configuration.\n-\tfor IP based V2X messages from the application, UE uses the transport layer protocol set by the upper layer.\n-\tthe UE sends a V2X message to a V2X Application Server address. The destined V2X Application Server address is derived from the PSID or the ITS-AID and the UE configuration as described in clause 5.1.3.1, and the V2X Application Server receives the V2X message in a UDP/IP packet or a TCP/IP packet on a V2X Application Server address.\n-\twhen Unstructured PDU Session type is used for transport of non-IP based V2X messages:\n-\tV2X messages are transported to the V2X Application Server as defined in clause 5.6.10.3 of TS 23.501 [6].\nLatency reduction for V2X message transfer via unicast may be achieved by using various mechanisms, including via e.g., edge computing defined in TS 23.501 [6], in clause 5.6.7 \"Application Function influence on traffic routing\" and clause 5.13 \"Support for Edge Computing\", where the V2X Application Server acts as an Application Function.\n5.3\tV2X Application Server discovery\n5.3.1\tGeneral\nA UE needs to discover the V2X Application Server(s), when V2X communication over Uu operation mode is used. The V2X Application Server address information may be configured on the UE or provisioned over N1 reference point, as specified in clause 5.1.3.1.\nWhen the configuration contains the FQDN(s), the UE shall perform DNS to resolve the address(es) of the V2X Application Server. The UE may use the configured V2X Application Server information only in the designated geographical area. When the UE changes serving PLMN or crosses configured geographic areas, it should perform address resolution again.\nNOTE:\tWhen the V2X Application Server is notified by SMF indicating the DNAI change, as specified in clause 5.6.7 of TS 23.501 [6], the application layer can trigger the UE to perform DNS to resolve the address(es) of the V2X Application Server.\n5.3.2\tMultiple V2X Application Server and Localized V2X Application Server discovery and routing\nMultiple V2X Application Servers may be involved in the V2X communication, each providing particular V2X services and/or serving a particular geographical region. Therefore, the V2X Application Server address information as specified in clause 5.1.3.1 can contain multiple servers' information. When multiple V2X Application Servers are configured, the application layer will choose the proper V2X Application Server to use.\nWhen localized V2X Application Servers are deployed, Anycast may be used to conceal the server change from the UE. In this case, a FQDN is configured for a large region, e.g. the entire PLMN, and the UE only needs to resolve it once to an Anycast address. The UPF is responsible for routing the traffic to the appropriate local V2X Application Servers based on Anycast address.\n5.4\tQoS handling for V2X communication\n5.4.1\tQoS handling for V2X communication over PC5 reference point\n5.4.1.1\tQoS model\n5.4.1.1.1\tGeneral overview\nFor LTE based PC5, the QoS handling is defined in TS 23.285 [8], based on ProSe Per-Packet Priority (PPPP) and ProSe Per-Packet Reliability (PPPR).\nFor NR based PC5, a QoS model similar to that defined in TS 23.501 [6] for Uu reference point is used, i.e. based on 5QIs, with additional parameter of Range as described in clauses 5.4.2, 5.4.3 and 5.4.4. For the V2X communication over NR based PC5 reference point, a PC5 QoS Flow is associated with a PC5 QoS Rule and the PC5 QoS parameters as defined in clause 5.4.2. A set of standardized PC5 5QIs (PQI) are defined in clause 5.4.4. The UE may be configured with a set of default PC5 QoS parameters to use for the V2X service types, as defined in clause 5.1.2.1. For NR based unicast, groupcast and broadcast mode communication over PC5, Per-flow QoS model for PC5 QoS management shall be applied. Figure 5.4.1.1.1-1 illustrates an example mapping of Per-flow QoS model for NR PC5. Details of PC5 QoS Rules and PFI related operations are described in clauses 5.4.1.1.2 and 5.4.1.1.3.\n\nFigure 5.4.1.1.1-1: Per-Flow PC5 QoS Model for NR PC5\nThe following principles apply when the V2X communication is carried over PC5 reference point:\n-\tApplication layer may set the V2X Application Requirements for the V2X communication, using either TS 23.285 [8] defined PPPP and PPPR model or the PQI and Range model as described in clause 5.4.4. Depending on the type of PC5 reference point, i.e. LTE based or NR based, selected for the transmission, the UE may map the application layer provided V2X Application Requirements to the suitable QoS parameters to be passed to the lower layer. The mapping between the two QoS models is defined in clause 5.4.2. For V2X communication over NR based PC5, different V2X packets may require different QoS treatments. In that case, the V2X packets shall be sent from the V2X layer to the Access Stratum layer within PC5 QoS Flows identified by different PFIs.\n-\tWhen groupcast mode of V2X communication over NR based PC5 is used, a Range parameter is associated with the QoS parameters for the V2X communication. The Range may be provided by V2X application layer or use a default value mapped from the V2X service type based on configuration as defined in clause 5.1.2.1. The Range indicates the minimum distance that the QoS parameters need to be fulfilled. The Range parameter is passed to AS layer together with the QoS parameters for dynamic control.\n-\tNR based PC5 supports three communication modes, i.e. broadcast, groupcast, and unicast. The QoS handling of these different modes are described in clauses 5.4.1.2 to 5.4.1.4.\n-\tThe UE may handle traffic using broadcast, groupcast, and unicast mode communication by taking all their priorities, e.g. indicated by PQIs, into account as described in clause 5.4.3.3.\n-\tFor broadcast and groupcast modes of V2X communication over NR based PC5, standardized PQI values are applied by the UE, as there is no signalling over PC5 reference point for these cases.\n-\tWhen network scheduled operation mode is used, the UE-PC5-AMBR for NR based PC5 applies to all types of communication modes, and is used by NG-RAN for capping the UE's NR based PC5 transmission in the resources management. The UE-PC5-AMBR shall be set to the sum of the aggregate maximum bit rate of all types of communication (i.e. unicast, groupcast and broadcast modes) over PC5 reference point.\n5.4.1.1.2\tDeriving PC5 QoS parameters and assigning PFI for PC5 QoS Flow\nThe following description applies to for both network scheduled operation mode and UE autonomous resources selection mode.\nWhen a service data packet or request from the V2X application layer is received, the UE determines if there is any existing PC5 QoS Flow matching the service data packet or request, i.e. based on the PC5 QoS Rules for the existing PC5 QoS Flow(s).\nIf there is no PC5 QoS Flow matching the service data packet or request, the UE derives PC5 QoS parameters defined in clause 5.4.2 as below:\n-\tIf the application layer provides the V2X Application Requirements for the V2X service type (e.g. priority requirement, reliability requirement, delay requirement, range requirement), the V2X layer determines the PC5 QoS parameters based on the V2X Application Requirements;\n-\tOtherwise, the V2X layer determines the PC5 QoS parameters based on the mapping of the V2X service type to PC5 QoS parameters defined in clause 5.1.2.1.\nNOTE 1:\tDetails of V2X Application Requirements for the V2X service type is up to implementation and out of scope of this specification.\nAfter deriving the PC5 QoS parameters, the UE performs the following:\n-\tIf there is no existing PC5 QoS Flow that fulfils the derived PC5 QoS parameters:\n-\tThe UE creates a new PC5 QoS Flow for the derived PC5 QoS parameters; and\n-\tThe UE then assigns a PFI and derives PC5 QoS Rule for this PC5 QoS Flow.\n-\tOtherwise, the UE updates the PC5 Packet Filter Set in the PC5 QoS Rule for such PC5 QoS Flow.\nNOTE 2:\tIt is expected that the application layer is capable of differentiating traffic from different V2X services that is transported within the same PC5 QoS Flow.\nFor V2X communication over NR PC5 reference point, the PC5 QoS Flow is the finest granularity of QoS differentiation in the same destination identified by Destination Layer-2 ID. User Plane traffic with the same PFI receives the same traffic forwarding treatment (e.g. scheduling, admission threshold). The PFI is unique within a same destination.\n5.4.1.1.3\tHandling of PC5 QoS Flows based on PC5 QoS Rules\nFor each communication mode (e.g. broadcast, groupcast, unicast), the UE maintains the PC5 QoS Context and PC5 QoS Rule(s) for each PC5 QoS Flow identified by a PC5 QoS Flow Identifier (PFI) per destination identified by Destination Layer-2 ID.\nThe following information is maintained in the V2X layer of the UE:\n-\tA PC5 QoS Context includes the following information:\n-\tPFI;\n-\tPC5 QoS parameters (i.e. PQI and conditionally other parameters such as MFBR/GFBR, Range, etc.) as defined in clause 5.4.2; and\n-\tthe V2X service type(s).\n-\tOne or more PC5 QoS Rule(s). Each PC5 QoS Rule contains the following information:\n-\tPFI;\n-\ta PC5 Packet Filter Set as defined in clause 5.4.1.1.4; and\n-\ta precedence value. The precedence value determines the order in which the PC5 QoS Rules are evaluated. The PC5 QoS Rule with lower precedence value is evaluated before those with the higher precedence values.\nNOTE:\tHow to set the precedence value is up to UE implementation.\nWhen the UE assigns a new PFI for V2X service type, the UE stores it with the corresponding PC5 QoS Context and PC5 QoS Rule(s) for the destination. When the UE releases the PFI, the UE removes the corresponding PC5 QoS Context and PC5 QoS Rule(s) for the destination. For unicast, the Unicast Link Profile defined in clause 5.2.1.4 contains additional information mapped from PFI for unicast operation.\nThe V2X layer provides information for PC5 QoS operations per destination (e.g. identified by Destination Layer-2 ID) to AS layer for Per-flow QoS model operations as below:\n1)\tTo add a new PC5 QoS Flow or to modify any existing PC5 QoS Flow, the V2X layer provides the following information for the PC5 QoS Flow to AS layer.\n-\tthe PFI;\n-\tthe corresponding PC5 QoS parameters; and\n-\tsource/destination Layer-2 IDs for broadcast and groupcast mode communication, or the PC5 Link Identifier for unicast.\n2)\tTo remove any existing PC5 QoS Flow, the V2X layer provides the following information for the PC5 QoS Flow to AS layer.\n-\tthe PFI; and\n-\tsource/destination Layer-2 IDs for broadcast and groupcast mode communication, or the PC5 Link Identifier for unicast.\nIn addition, the V2X layer also provides the communication mode (e.g. broadcast, groupcast, unicast), radio frequencies, Tx Profile to the AS layer for the PC5 operation. The radio frequencies and Tx Profile are determined based on the V2X service type. The V2X layer ensures that V2X service types associated with different radio frequencies are classified into distinct PC5 QoS Flows.\nFigure 5.4.1.1.3-1 illustrated an example of the classification and marking of user plane traffic using the PC5 QoS Rules, and the mapping of PC5 QoS Flows to radio resources at access stratum layer.\n\nFigure 5.4.1.1.3-1: Handling of PC5 QoS Flows based on PC5 QoS Rules\nAs illustrated in Figure 5.4.1.1.3-1, for a given pair of source and destination Layer-2 IDs, there can be multiple radio bearers, each corresponding to a different PC5 QoS level. The AS layer can determine the mapping of multiple PC5 QoS Flows to the same radio bearer based on the information provided. For broadcast and groupcast mode communication, the L2 link goes to all UEs in proximity identified by the destination Layer-2 ID.\n5.4.1.1.4\tPC5 Packet Filter Set\nPC5 Packet Filter Set supports two types of packet filters, i.e. the V2X IP Packet Filter Set and the V2X Packet Filter Set. A PC5 QoS Rule contains either the V2X IP Packet Filter Set or the V2X Packet Filter Set.\nThe V2X IP Packet Filter Set has the same format as the IP Packet Filter Set defined in TS 23.501 [6] clause 5.7.6.2.\nThe V2X Packet Filter Set shall support Packet Filters based on at least any combination of:\n-\tV2X service type;\n-\tSource/Destination Layer-2 ID;\n-\tApplication Layer ID (e.g. Station ID).\n5.4.1.2\tQoS handling for broadcast mode V2X communication over PC5 reference point\nWhen PC5 broadcast is used for the transmission of V2X service data, the following principles are followed for both network scheduled operation mode and UE autonomous resources selection mode:\n-\tPC5 QoS parameters defined in clause 5.4.2 are applied.\n-\tThe V2X layer determines the PC5 QoS parameters based on the V2X Application Requirements (if available) or the mapping of the V2X service type to PC5 QoS parameters, as defined in clause 5.4.1.1.2.\n-\tThe V2X layer assigns a PC5 QoS Flow Identifier (PFI) and derives the PC5 QoS Rule for the PC5 QoS Flow, and associates the PC5 QoS parameters to the PFI.\n-\tThe V2X layer provides the PFI and the associated PC5 QoS parameters to AS layer for Per-flow QoS model operations.\n-\tThe V2X layer determines the PFI based on the PC5 QoS Rule for the V2X service data from the V2X application layer, and passes the V2X service data along with PFI to the AS layer for transmission.\nWhen the autonomous resources selection mode is used, following additional principle applies:\n-\tThe UE can use the PC5 QoS parameters for PC5 QoS handling.\nWhen the network scheduled operation mode for NR PC5 is used, the following additional principles apply:\n-\tThe UE provides PC5 QoS information (related to PC5 QoS parameters), Destination Layer-2 ID(s) and communication mode to the NG-RAN and NG-RAN may provide AS layer configurations and configure the mapping of PC5 QoS flow to radio bearer as defined in TS 38.331 [15] and TS 36.331 [14].\n-\tThe UE provides PC5 QoS information (related to PC5 QoS parameters) and Destination information (related to Destination Layer-2 ID(s)) to the NG-RAN for resource request as defined in TS 38.331 [15] and TS 36.331 [14].\n-\tThe NG-RAN authorizes the UE-provided PC5 QoS information based on PCF-provisioned PC5 QoS parameters as defined in clause 6.5.7.\n-\tThe NG-RAN uses UE-PC5-AMBR for capping the UE PC5 transmission in the resources management.\n5.4.1.3\tQoS handling for groupcast mode V2X communication over PC5 reference point\nThe QoS handling described in clause 5.4.1.2 is applied.\n5.4.1.4\tQoS handling for unicast mode V2X communication over PC5 reference point\nThe QoS handling described in clause 5.4.1.2 is applied with the following additions:\n-\tThe PFI and PC5 QoS parameters are negotiated during the Layer-2 link establishment procedure, as described in clause 6.3.3.1, or during the Layer-2 link modification procedure, as described in clause 6.3.3.4.\nWhen the network scheduled operation mode for NR PC5 is used, following additional principle applies:\n-\tNG-RAN uses the PC5 LINK-AMBR for capping the UE PC5 unicast link transmission in the resources management.\n5.4.2\tPC5 QoS parameters\n5.4.2.1\tPQI\nA PQI is a special 5QI, as defined in clause 5.7.2.1 of TS 23.501 [6], and is used as a reference to PC5 QoS characteristics defined in clause 5.4.3, i.e. parameters that control QoS forwarding treatment for the packets over PC5 reference point.\nStandardized PQI values have one-to-one mapping to a standardized combination of PC5 QoS characteristics as specified in Table 5.4.4-1.\n5.4.2.2\tPC5 Flow Bit Rates\nFor GBR QoS Flows only, the following additional PC5 QoS parameters exist:\n-\tGuaranteed Flow Bit Rate (GFBR);\n-\tMaximum Flow Bit Rate (MFBR).\nThe GFBR and MFBR as defined in clause 5.7.2.5 of TS 23.501 [6] are used for bit rate control on PC5 reference point over the Averaging Time Window. For PC5 communication, the same GFBR and MFBR are used for both directions.\n5.4.2.3\tPC5 Link Aggregated Bit Rates\nA PC5 unicast link is associated with the following aggregate rate limit QoS parameter:\n-\tper link Aggregate Maximum Bit Rate (PC5 LINK-AMBR).\nThe PC5 LINK-AMBR limits the aggregate bit rate that can be expected to be provided across all Non-GBR QoS Flows with a peer UE over PC5 unicast link. The PC5 LINK-AMBR is measured over an AMBR averaging window which is a standardized value. The PC5 LINK-AMBR is not applicable to GBR QoS Flows. PC5 LINK-AMBR is applied to one PC5 unicast link, which means aggregate bit rate of one PC5 unicast link should not exceed PC5 LINK-AMBR.\nNOTE:\tThe AMBR averaging window is only applied to PC5 LINK-AMBR measurement.\n5.4.2.4\tRange\nThe Range value indicates the applicability of the PC5 QoS parameters in PC5 communication, i.e. when the receiving UEs are not within the Range specified distance from the transmitting UE, the communication is best effort. Lower layer (PHY/MAC layer) may use the Range to determine the corresponding packet handling, e.g. HARQ as defined in TS 38.300 [11], to achieve the QoS guarantee indicated by PC5 QoS parameters.\nRange is in the unit of meters. The UE is configured with the maximum Range value it can use for a particular V2X service. A V2X service may request a different range value, and the V2X layer ensures that it does not exceed the maximum Range value.\nRange is only used for groupcast mode communication over PC5 reference point.\n5.4.2.5\tDefault Values\nA UE may be configured with default values for PC5 QoS parameters for a particular service, e.g. identified by PSID/ITS-AID. The default value will be used if the corresponding PC5 QoS parameter is not provided by upper layer.\n5.4.3\tPC5 QoS characteristics\n5.4.3.1\tGeneral\nThis clause specifies the PC5 QoS characteristics associated with PQI. The following characteristics defined in TS 23.501 [6] applies, with differences explained in following clauses:\n1\tResource Type (GBR, Delay critical GBR or Non-GBR);\n2\tPriority Level;\n3\tPacket Delay Budget;\n4\tPacket Error Rate;\n5\tAveraging window (for GBR and Delay-critical GBR resource type only);\n6\tMaximum Data Burst Volume (for Delay-critical GBR resource type only).\nStandardized or pre-configured PC5 QoS characteristics, are indicated through the PQI value.\nV2X layer may derive non-standardized PC5 QoS characteristics by overriding the standardized or pre-configured value of PC5 QoS characteristics based on V2X Application Requirements from V2X application layer and provide the whole set of non-standardized PC5 QoS characteristics to AS layer.\nNOTE:\tNon-standardized PC5 QoS characteristics only applies to UE autonomous resources selection mode.\n5.4.3.2\tResource Type\nResource Type is defined in clause 5.7.3.2 of TS 23.501 [6].\n5.4.3.3\tPriority Level\nThe Priority Level for NR PC5 has the same format and meaning as the Priority value of the ProSe Per-Packet Priority (PPPP) for LTE PC5 defined in TS 23.285 [8]. For LTE PC5, the PPPP value also reflects the latency requirement and the PDB derivation is according to TS 23.285 [8], i.e. the low PDB is mapped to the high priority PPPP value. On the other hand, for NR PC5, the PDB is derived from the PQI table as defined in clause 5.4.4.\nNOTE:\tUsing the same format for Priority Level and PPPP provides better backward compatibility.\nThe Priority Level shall be used to different treatment of V2X service data across different modes of communication, i.e. broadcast, groupcast, and unicast. In the case when all QoS requirements cannot be fulfilled for all the PC5 service data associated with that PC5 reference point, the Priority Level shall be used to select for which PC5 service data the QoS requirements are prioritized such that a PC5 service data packet with Priority Level value N is prioritized over a PC5 service data packet with higher Priority Level values, i.e. N+1, N+2, etc. (lower number meaning higher priority).\n5.4.3.4\tPacket Delay Budget\nThe Packet Delay Budget (PDB) associated with the PQI is equivalent to the PDB defined in clause 5.7.3.4 of TS 23.501 [6]. However, when used for PC5 communication, the PDB associated with the PQI defines an upper bound for the time that a packet may be delayed between sending UE and receiving UE(s) over PC5 reference point.\n5.4.3.5\tPacket Error Rate\nThe Packet Error Rate (PER) is defined in clause 5.7.3.5 of TS 23.501 [6].\n5.4.3.6\tAveraging Window\nThe Averaging Window is defined in clause 5.7.3.6 of TS 23.501 [6].\n5.4.3.7\tMaximum Data Burst Volume\nMaximum Data Burst Volume (MDBV) is defined in clause 5.7.3.7 of TS 23.501 [6].\nMDBV denotes the largest amount of data that the PC5 reference point is required to serve within a period of PDB of the PQI.\nThe MDBV may also be indicated by upper layer, it shall be used instead of the default value.\n5.4.4\tStandardized PQI to QoS characteristics mapping\nThe one-to-one mapping of standardized PQI values to PC5 QoS characteristics is specified in table 5.4.4-1.\nTable 5.4.4-1: Standardized PQI to QoS characteristics mapping\n\nNOTE 1:\tFor Standardized PQI to QoS characteristics mapping, the table will be extended/updated to support service requirements for other identified V2X services.\nNOTE 2:\tThe PQIs may be used for other services than V2X.\nNOTE 3:\tA PQI may be used together with an application indicated priority, which overrides the Default Priority Level of the PQI.\n5.4.5\tQoS handling for V2X communication over Uu reference point\n5.4.5.1\tGeneral\nThe V2X service data can be delivered via Non-GBR QoS Flow as well as GBR QoS Flow (i.e. using the GBR resource type or the Delay-critical GBR resource type) as specified in TS 23.501 [6].\n5.4.5.2\tNotification on QoS Sustainability Analytics to the V2X Application Server\n5.4.5.2.1\tGeneral\nA V2X Application Server may request notifications on QoS Sustainability Analytics for an indicated geographic area and time interval in order to adjust the application behaviour in advance with potential QoS change. The V2X Application Server may also request past statistical information for the purposes of adjustment of the application, how V2X Application Server makes use of such data is outside of 3GPP scope. Clause 6.4.1 describes the procedure for such notification from 5GS.\n5.4.5.2.2\tFunctional description\nThe potential QoS change to assist application adjustment is based on the notification of QoS Sustainability Analytics defined in clause 6.9 of TS 23.288 [20]. The V2X Application Server acting as an Application Function communicates with the NEF which corresponds to the NF consumer in clause 6.9.4 of TS 23.288 [20].\nThe V2X Application Server can either subscribe to notifications from the NEF (i.e., a Subscribe-Notify model) or request a single notification from the NEF (i.e. a Request-Response model). The V2X Application Server request contains the following parameters:\n-\tAnalytics ID = \"QoS Sustainability\";\n-\tTarget of Analytics Reporting: \"any UE\";\n-\tAnalytics Filter Information:\n-\tOptional maximum number of objects;\n-\tQoS requirements:\n-\t5QI (standardized or pre-configured), and applicable additional QoS parameters and the corresponding values (conditional, i.e., it is needed for GBR 5QIs to know the GFBR); or\n-\tthe QoS Characteristics attributes including Resource Type, PDB and PER and their values;\nNOTE:\tThe V2X Application Server could provide the 5QIs as input based on SLA with the operator which authorizes the V2X Application Server to use certain 5QIs and to use the QoS Sustainability Analytics only for them.\n-\tLocation information (the details are specified in TS 23.288 [20] clause 6.9.1);\n-\tS-NSSAI (optional, if available in the V2X Application Server).\n-\tAnalytics target period (the details are specified in TS 23.288 [20] clause 6.9.1);\n-\tReporting Threshold(s) (the details are specified in TS 23.288 [20] clause 6.9.1);\n-\tIn a subscription, the Notification Correlation Id and the Notification Target Address.\n5.4.5.3\tQoS Change based on Extended NG-RAN Notification to support Alternative Service Requirements\nTo support V2X applications that can operate with different configurations (e.g. different bitrates or delay requirements), the V2X Application Server (V2X AS), acting as the Application Function, can provide, in addition to the requested level of service requirements, Alternative Service Requirements to the 5GS. This enables the 5GS to act on the Alternative Service Requirements and apply them for the extended NG-RAN notification, as described in TS 23.501 [6] and TS 23.503 [16].\nThe V2X AS can use the related procedures specified in clause 4.15.6.6 of TS 23.502 [7] to influence the QoS provided to the V2X service. If so, the V2X AS includes Alternative Service Requirements as specified in clause 6.1.3.22 of TS 23.503 [16] when providing service information to the PCF.\nThe QoS change based on extended NG-RAN notification operates within the 5GS QoS model as specified in TS 23.501 [6] and TS 23.503 [16].\n5.5\tSubscription to V2X services\nThe user's profile in the UDM contains the subscription information to give the user permission to use V2X services.\nAt any time, the operator can remove the UE subscription rights for V2X services from user's profile in the UDM, and revoke the user's permission to use V2X services.\nThe following subscription information is defined for V2X services:\na)\twhether the UE is authorized to perform V2X communication over PC5 reference point as Vehicle UE, Pedestrian UE, or both, including for LTE PC5 and for NR PC5.\nb)\tUE-PC5-AMBR per PC5 RAT, including UE-PC5-AMBR for LTE PC5 and UE-PC5-AMBR for NR PC5.\nc)\tthe list of the PLMNs where the UE is authorized to perform V2X communication over PC5 reference point. For each PLMN in the list, the RAT(s) over which the UE is authorized to perform V2X communications over PC5 reference point.\nd)\tPC5 QoS parameters as defined in clause 5.4.2 used by NG-RAN.\nThe UDM may retrieve a) and b) from the UDR. a) and b) are provided by the UDM to the AMF during UE Registration procedure as defined in clause 4.2.2.2 of TS 23.502 [7] using Nudm_SDM service for Subscription data type \"V2X Subscription data\" and the AMF provides a) and b) to NG-RAN as part of the UE context information.\nc) and d) are provided by the UDR to the PCF during the UE Policy Association Establishment procedure as defined in clause 4.16.11 of TS 23.502 [7] and UE Policy Association Modification procedure as defined in clause 4.16.12 of TS 23.502 [7] using Nudr service for Data Set \"Policy Data\" and Data Subset \"Policy Set Entry\". If the subscription information provided to the PCF from UDR is changed (e.g., PC5 QoS related parameters, the list of PLMNs where the UE is authorized to perform V2X communication over PC5 reference point), the PCF initiates the UE Configuration Update procedure as specified in clause 6.2.2.\n5.6\tIdentifiers\n5.6.1\tIdentifiers for V2X communication over PC5 reference point\n5.6.1.1\tGeneral\nEach UE has one or more Layer-2 IDs for V2X communication over PC5 reference point, consisting of:\n-\tSource Layer-2 ID(s); and\n-\tDestination Layer-2 ID(s).\nSource and destination Layer-2 IDs are included in layer-2 frames sent on the layer-2 link of the PC5 reference point identifying the layer-2 source and destination of these frames. Source Layer-2 IDs are always self-assigned by the UE originating the corresponding layer-2 frames.\nThe selection of the source and destination Layer-2 ID(s) by a UE depends on the communication mode of V2X communication over PC5 reference point for this layer-2 link, as described in clauses 5.6.1.2, 5.6.1.3, and 5.6.1.4. The source Layer-2 IDs may differ between different communication modes.\nWhen IP-based V2X communication is supported for broadcast and groupcast modes of V2X communication over PC5 reference point, the source IP address is allocated as described in clause 5.2.1.5.\nIf the UE has an active V2X application that requires privacy support in the current Geographical Area, as identified by configuration described in clause 5.1.2.1, in order to ensure that a source UE (e.g. vehicle) cannot be tracked or identified by any other UEs (e.g. vehicles) beyond a certain short time-period required by the application, the source Layer-2 ID shall be changed over time and shall be randomized. For IP-based V2X communication over PC5 reference point, the source IP address shall also be changed over time and shall be randomized. The change of the identifiers of a source UE must be synchronized across layers used for PC5, (e.g. when the Application Layer ID changes, the source Layer-2 ID and the source IP address need to be changed).\n5.6.1.2\tIdentifiers for broadcast mode V2X communication over PC5 reference point\nFor broadcast mode of V2X communication over PC5 reference point, the UE is configured with the destination Layer-2 ID(s) to be used for V2X services. The destination Layer-2 ID for a V2X communication is selected based on the configuration as described in clause 5.1.2.1.\nThe UE self-selects a source Layer-2 ID. The UE may use different source Layer-2 IDs for different types of PC5 reference points, i.e. LTE based PC5 and NR based PC5.\n5.6.1.3\tIdentifiers for groupcast mode V2X communication over PC5 reference point\nFor groupcast mode of V2X communication over PC5 reference point, the V2X application layer may provide group identifier information. When the group identifier information is provided by the V2X application layer, the UE converts the provided group identifier into a destination Layer-2 ID. When the group identifier information is not provided by the V2X application layer, the UE determines the destination Layer-2 ID based on configuration of the mapping between V2X service type and Layer-2 ID, as specified in clause 5.1.2.1.\nNOTE:\tThe mechanism for converting the V2X application layer provided group identifier to the destination Layer-2 ID is defined in Stage 3.\nThe UE self-selects a source Layer-2 ID.\n5.6.1.4\tIdentifiers for unicast mode V2X communication over PC5 reference point\nFor unicast mode of V2X communication over PC5 reference point, the destination Layer-2 ID used depends on the communication peer. The Layer-2 ID of the communication peer, identified by the Application Layer ID, may be discovered during the establishment of the PC5 unicast link, or known to the UE via prior V2X communications, e.g. existing or prior unicast link to the same Application Layer ID, or obtained from application layer service announcements. The initial signalling for the establishment of the PC5 unicast link may use the known Layer-2 ID of the communication peer, or a default destination Layer-2 ID associated with the V2X service type configured for PC5 unicast link establishment, as specified in clause 5.1.2.1. During the PC5 unicast link establishment procedure, Layer-2 IDs are exchanged, and should be used for future communication between the two UEs, as specified in clause 6.3.3.1.\nThe Application Layer ID is associated with one or more V2X applications within the UE. If UE has more than one Application Layer IDs, each Application Layer ID of the same UE may be seen as different UE's Application Layer ID from the peer UE's perspective.\nThe UE maintains a mapping between the Application Layer IDs and the source Layer-2 IDs used for the PC5 unicast links, as the V2X application layer does not use the Layer-2 IDs. This allows the change of source Layer-2 ID without interrupting the V2X applications.\nWhen Application Layer IDs change, the source Layer-2 ID(s) of the PC5 unicast link(s) shall be changed if the link(s) was used for V2X communication with the changed Application Layer IDs.\nBased on privacy configuration as specified in clause 5.1.2.1, the update of the new identifiers of a source UE to the peer UE for the established unicast link may cause the peer UE to change its Layer-2 ID and optionally IP address/prefix if IP communication is used as defined in clause 6.3.3.2.\nA UE may establish multiple PC5 unicast links with a peer UE and use the same or different source Layer-2 IDs for these PC5 unicast links.\n5.7\tSupport for V2X communication for UEs in limited service state\nFor UE in limited service state, as defined in TS 23.122 [13], V2X communication is only allowed over PC5 reference point.\nUEs that are authorized to use V2X communication over PC5 reference point shall be able to use V2X communication over PC5 reference point when in limited service state following the principles defined in clause 5.1.2.2 for V2X communication over PC5 reference point when the UE enters in limited service state in 5GS:\n-\tbecause UE cannot find a suitable cell of the selected PLMN as described in TS 23.122 [13]; or\n-\tas the result of receiving one of the following reject reasons defined in TS 23.122 [13]:\n-\ta \"PLMN not allowed\" response to a registration request or;\n-\ta \"5GS services not allowed\" response to a registration request or service request.\nA UE in limited service state shall only use the radio resources and procedure available in CM-IDLE mode for V2X communication over PC5 reference point, for details see TS 36.300 [9] and TS 38.300 [11].\nUEs shall not use V2X communication over PC5 reference point using the \"operator-managed\" radio resources, as specified in clause 5.1.2.1, if the UE has entered in limited service state due to all other situations (e.g. no SIM in the MS, an \"illegal MS\" or \"illegal ME\" response to a registration request, or an \"IMSI unknown in HLR\" response to a registration request) defined in TS 23.122 [13], where the UE is unable to obtain normal service from a PLMN. The UEs may use V2X communication over PC5 reference point using the \"non-operator-managed\" radio resources, as specified in clause 5.1.2.1, according to the principles defined in clause 5.1.2.2.\n5.8\tInterworking between EPS V2X and 5GS V2X\n5.8.1\tV2X Policy and parameter provisioning\nWhen the UE is in 5GS or EPS, the UE shall use the valid V2X policy and parameters provisioned by the PCF in 5GC or by the V2X Control Function in EPC for V2X communication. The V2X related parameters for EPS defined in TS 23.285 [8] can be either provided by the PCF or by the V2X Control Function, while the V2X policy and parameters involving 5GS are provided by the PCF only. If the UE does not have valid V2X policy and parameters, the UE shall request the network to provision the V2X policy and parameters.\n5.8.2\tPC5 Operation\nPC5 communication can be supported with proper UE configurations by taking into account e.g. regional regulations, deployments, and UE support for LTE PC5 and/or NR PC5 RATs.\nV2X communication over NR PC5 reference point in network scheduled operation mode is supported in EPS (i.e. EN-DC architecture defined in TS 37.340 [25]) as defined in TS 23.285 [8] and TS 36.331 [14].\n5.8.3\tMobility between EPS and 5GS over Uu\nInterworking specified in clause 5.17 of TS 23.501 [6] and clause 4.11 of TS 23.502 [7] is applied to mobility between EPS and 5GS over Uu reference point with the following additions:\n-\tFor N26 based handover, V2X related data including the \"V2X services authorized\" indication per PC5 RAT, UE-PC5-AMBR per PC5 RAT, and PC5 QoS parameters are transferred between AMF and MME, and are included in Handover Request message sent to the target RAN node.\nAny Unstructured type PDU Session established in 5GC based on the UE configuration as described in clause 5.1.3.1 is allowed to be transferred to EPC as non-IP PDN connection when non-IP PDN type is supported by UE and EPC as specified in clause 5.17.2.1 of TS 23.501 [6].\n6\tFunctional description and information flows\n6.1\tControl and user plane stacks\n6.1.1\tUser plane for NR PC5 reference point supporting V2X services\nFigure 6.1.1-1 depicts a user plane for NR PC5 reference point, i.e. PC5 User Plane Protocol stack.\n\nLegend:\n-\tPC5-U: The SDAP/PDCP/RLC/MAC/PHY functionality is specified in TS 38.300 [11].\n-\tFor PDCP SDU type \"Non-IP\", a \"Non-IP Type\" header included in the SDU by upper layer to indicate the type of non-IP messages carried will be specified in stage 3 specification.\n\nFigure 6.1.1-1: User Plane for NR PC5 reference point\nIP and Non-IP PDCP SDU types are supported for the V2X communication over PC5 reference point.\nFor IP PDCP SDU type, only IPv6 is supported. The IP address allocation and configuration are as defined in clause 5.6.1.1.\nThe Non-IP PDCP SDU contains a Non-IP Type header, which indicates the V2X message family used by the application layer, e.g. IEEE 1609 family's WSMP [18], ISO defined FNTP [19], CCSA defined DSMP [27].\nNOTE:\tThe Non-IP Type header and allowed values are defined in TS 24.587 [24].\nThe packets from V2X application layer are handled by the V2X layer before transmitting them to the AS layer, e.g. V2X layer maps the IP/Non IP packets to PC5 QoS Flow and marks the corresponding PFI.\n6.1.2\tControl plane for NR PC5 reference point supporting V2X services\nFigure 6.1.2-1 depicts a control plane for NR PC5 reference point, i.e. PC5 Signalling Protocol stack.\n\nLegend:\n-\tPC5-S Protocol: The protocol used for the control plane signalling over the PC5 reference point for the secure layer-2 link as specified in clause 6.3.3.\n-\tThe PDCP/RLC/MAC/PHY functionality is specified in TS 38.300 [11].\n\nFigure 6.1.2-1: Control Plane for NR PC5 reference point\n6.2\tProcedures for Service Authorization and Provisioning to UE\n6.2.1\tGeneral\nThe procedures for service authorization and provisioning to UE may be initiated by the PCF (as described in clause 6.2.2), by the UE (as described in clause 6.2.4), or by the AF (as described in clause 6.2.5).\n6.2.2\tPCF based Service Authorization and Provisioning to UE\nFor PCF based Service Authorization and Provisioning to UE, the Registration procedures as defined in clause 4.2.2.2 of TS 23.502 [7], UE Policy Association Establishment procedure as defined in clause 4.16.11 of TS 23.502 [7] and UE Policy Association Modification procedure as defined in clause 4.16.12 of TS 23.502 [7] apply with the following additions:\n-\tIf the UE indicates V2X capability in the Registration Request message and if the UE is authorized to use V2X service based on subscription data, the AMF selects the PCF which supports V2X Policy/Parameter provisioning as described in clause 6.2.3 and establishes a UE policy association with the PCF for V2X Policy/Parameter delivery.\n-\tIf the AMF receives the PC5 capability for V2X in the Registration Request message from UE, the AMF further reports the PC5 capability for V2X to the selected PCF. The PCF may determine the V2X Policy/Parameter for specific PC5 RAT based on the received UE's PC5 capability for V2X.\n-\tIf the UE supports V2X communication and it does not have valid V2X policy/parameters, the UE includes the UE Policy Container with indicating the V2X Policy Provisioning Request during registration procedure.\n-\tIf the UE indicates the V2X Policy Provisioning Request in the UE Policy Container, the PCF determines whether to provision V2X Policy/parameters for V2X communication over PC5 reference point and/or V2X communication over Uu reference point to the UE, as specified in clause 6.1.2.2.2 of TS 23.503 [16], and the PCF provides the V2X Policy/parameters to the UE by using the procedure as defined in clause 4.2.4.3 \"UE Configuration Update procedure for transparent UE Policy Delivery\" in TS 23.502 [7].\nThe PCF may update the V2X Policy/parameters to the UE in following conditions:\n-\tUE Mobility, e.g. UE moves from one PLMN to another PLMN. This is achieved by using the procedure of UE Policy Association Modification initiated by the AMF, as defined in clause 4.16.12.1 of TS 23.502 [7].\n-\tWhen there is a subscription change in the list of PLMNs where the UE is authorized to perform V2X communication over PC5 reference point. This is achieved by using UE Policy Association Modification initiated by the PCF procedure as defined in clause 4.16.12.2 of TS 23.502 [7].\n-\tWhen there is a change of service specific parameter as described in clause 4.15.6.7 of TS 23.502 [7].\nIf the serving PLMN is removed from the list of PLMNs in the service authorization parameters, the service authorization is revoked in the UE.\nWhen the UE is roaming, the change of subscription resulting in updates of the service authorization parameters are transferred to the UE by H-PCF via V-PCF.\nThe UE may perform UE triggered Policy Provisioning procedure to the PCF as specified in clause 6.2.4 when the UE determines the V2X Policy/Parameter is invalid (e.g. Policy/Parameter is outdated, missing or invalid).\n6.2.3\tPCF discovery\nPCF discovery and selection mechanism defined in clause 6.3.7.1 of TS 23.501 [6] applies with the following addition to enable a PCF instance is selected for V2X service and for UE:\n-\tBased on the indication from the UE and/or UE subscription data during the Registration procedure as specified in clause 6.2.2, the AMF may include the V2X capability indication in the Nnrf_NFDiscovery_Request message as the optional input parameter. If provided, the NRF takes the information into account for discovering the PCF instance.\n6.2.4\tProcedure for UE triggered V2X Policy provisioning\nThe UE triggered Policy Provisioning procedure is initiated by the UE to request V2X Policy/Parameter from the PCF when UE determines the V2X Policy/Parameter is invalid in the following cases:\n-\tif the validity timer indicated in the V2X Policy/Parameter expires;\n-\tif there are no valid parameters, e.g. for the V2X service type a UE wants to use, for current area, or due to abnormal situation.\n\nFigure 6.2.4-1: UE triggered V2X Policy provisioning procedure\n1.\tThe UE sends the UE Policy provisioning request including the UE Policy Container (V2X Policy Provisioning Request) to the AMF.\n2.\tThe AMF sends the Npcf_UEPolicyControl_Update request to the PCF including the UE Policy Container received from UE.\n3.\tThe UE Policy delivery procedure defined in clause 4.2.4.3 of TS 23.502 [7] is triggered.\n6.2.5\tAF-based service parameter provisioning for V2X communications over control plane\nThe V2X Application Server can provision the 5GC with V2X service parameters via NEF as depicted in clause 4.2.2. For V2X service parameter provisioning, the procedure defined in clause 4.15.6.7 of TS 23.502 [7] is performed with the following considerations:\n-\tThe AF in TS 23.502 [7] is considered as V2X Application Server in this specification.\n-\tService Description indicates V2X service domain information.\n-\tService Parameters include policy/provisioning parameters for V2X communications over Uu and PC5. The detailed information on the parameters is described in clause 5.1.\nNOTE:\tIt is assumed that the V2X service domain information is set based on the Service Level Agreement with the operator.\n6.3\tProcedures for V2X communication over PC5 reference point\n6.3.1\tBroadcast mode V2X communication over PC5 reference point\nTo perform V2X communication over PC5 reference point in broadcast mode operation, the UE is configured with the related information as described in clause 5.1.2.\nFigure 6.3.1-1 shows the procedure for broadcast mode of V2X communication over PC5 reference point.\n\nFigure 6.3.1-1: Procedure for Broadcast mode of V2X communication over PC5 reference point\n1.\tThe receiving UE(s) determine the destination Layer-2 ID for broadcast reception as specified in clause 5.6.1.2. The destination Layer-2 ID is passed down to the AS layer of receiving UE(s) for the reception.\n2.\tThe transmitting UE V2X application layer provides data unit and may provide V2X Application Requirements specified in clause 5.4.1.2 to V2X layer.\n3.\tThe transmitting UE determines the destination Layer-2 ID for broadcast as specified in clause 5.6.1.2. The transmitting UE self-assigns the source Layer-2 ID as specified in clause 5.6.1.1.\n\tThe transmitting UE determines the PC5 QoS parameters for this broadcast V2X service as specified in clauses 5.4.1.1 and 5.4.1.2.\n4.\tThe transmitting UE sends the V2X service data using the source Layer-2 ID and the destination Layer-2 ID.\nNOTE:\tIn step 4, there is only one broadcast message from the transmitting UE.\n6.3.2\tGroupcast mode V2X communication over PC5 reference point\nTo perform groupcast mode of V2X communication over PC5 reference point, the UE is configured with the related information as described in clause 5.1.2.1.\nFigure 6.3.2-1 shows the procedure for groupcast mode of V2X communication over PC5 reference point.\n\nFigure 6.3.2-1: Procedure for groupcast mode of V2X communication over PC5 reference point\n1.\tV2X group management is carried out by the V2X application layer and is out of scope of this specification.\n2.\tThe V2X application layer may provide group identifier information (i.e. an Application-layer V2X Group identifier) as specified in clause 5.6.1.3.\n\tThe V2X application layer may provide V2X Application Requirements for this communication.\n\tIf the V2X application layer does not provide V2X Application Requirements, the V2X layer determines the PC5 QoS parameters based on the mapping of V2X service type to PC5 QoS parameters as defined in clause 5.1.2.1.\n\tThe V2X application layer may provide a group size and a member ID as specified in clause 5.2.1.3.\n3.\tTransmitting UE determines a source Layer-2 ID and a destination Layer-2 ID and Receiving UE(s) determine destination Layer-2 ID, as specified in clauses 5.6.1.1 and 5.6.1.3.\n\tThe destination Layer-2 ID is passed down to the AS layer of Receiving UE(s) for the groupcast mode communication reception.\n\tTransmitting UE determines the PC5 QoS parameters for this groupcast mode communication as specified in clauses 5.4.1.1 and 5.4.1.3.\n\tIf the group size and the member ID for Application Layer managed group are provided by the V2X application layer, the V2X layer passes them to the AS layer as described in clause 5.2.1.3.\n4.\tTransmitting UE has a V2X service associated with this groupcast mode communication.\n\tTransmitting UE sends the V2X service data using the source Layer-2 ID and the destination Layer-2 ID.\nNOTE:\tIn step 4, there is only one groupcast message from the transmitting UE.\n6.3.3\tUnicast mode V2X communication over PC5 reference point\n6.3.3.1\tLayer-2 link establishment over PC5 reference point\nTo perform unicast mode of V2X communication over PC5 reference point, the UE is configured with the related information as described in clause 5.1.2.1.\nFigure 6.3.3.1-1 shows the layer-2 link establishment procedure for unicast mode of V2X communication over PC5 reference point.\n\nFigure 6.3.3.1-1: Layer-2 link establishment procedure\n1.\tThe UE(s) determine the destination Layer-2 ID for signalling reception for PC5 unicast link establishment as specified in clause 5.6.1.4. The destination Layer-2 ID is configured with the UE(s) as specified in clause 5.1.2.1.\n2.\tThe V2X application layer in UE-1 provides application information for PC5 unicast communication. The application information includes the V2X service type(s) and the initiating UE's Application Layer ID. The target UE's Application Layer ID may be included in the application information.\n\tThe V2X application layer in UE-1 may provide V2X Application Requirements for this unicast communication. UE-1 determines the PC5 QoS parameters and PFI as specified in clause 5.4.1.4.\n\tIf UE-1 decides to reuse the existing PC5 unicast link as specified in clause 5.2.1.4, the UE triggers Layer-2 link modification procedure as specified in clause 6.3.3.4.\n3.\tUE-1 sends a Direct Communication Request message to initiate the unicast layer-2 link establishment procedure. The Direct Communication Request message includes:\n-\tSource User Info: the initiating UE's Application Layer ID (i.e. UE-1's Application Layer ID).\n-\tIf the V2X application layer provided the target UE's Application Layer ID in step 2, the following information is included:\n-\tTarget User Info: the target UE's Application Layer ID (i.e. UE-2's Application Layer ID).\n-\tV2X Service Info: the information about V2X service type(s) requesting Layer-2 link establishment.\n-\tSecurity Information: the information for the establishment of security.\nNOTE 1:\tThe Security Information and the necessary protection of the Source User Info and Target User Info are defined in TS 33.536 [26].\n\tThe source Layer-2 ID and destination Layer-2 ID used to send the Direct Communication Request message are determined as specified in clauses 5.6.1.1 and 5.6.1.4. The destination Layer-2 ID may be broadcast or unicast Layer-2 ID. When unicast Layer-2 ID is used, the Target User Info shall be included in the Direct Communication Request message.\n\tUE-1 sends the Direct Communication Request message via PC5 broadcast or unicast using the source Layer-2 ID and the destination Layer-2 ID.\n4.\tSecurity with UE-1 is established as below:\n4a.\tIf the Target User Info is included in the Direct Communication Request message, the target UE, i.e. UE-2, responds by establishing the security with UE-1.\n4b.\tIf the Target User Info is not included in the Direct Communication Request message, the UEs that are interested in using the announced V2X service type(s) over a PC5 unicast link with UE-1 responds by establishing the security with UE-1.\nNOTE 2:\tThe signalling for the Security Procedure is defined in TS 33.536 [26].\n\tWhen the security protection is enabled, UE-1 sends the following information to the target UE:\n-\tIf IP communication is used:\n-\tIP Address Configuration: For IP communication, IP address configuration is required for this link and indicates one of the following values:\n-\t\"IPv6 Router\" if IPv6 address allocation mechanism is supported by the initiating UE, i.e., acting as an IPv6 Router; or\n-\t\"IPv6 address allocation not supported\" if IPv6 address allocation mechanism is not supported by the initiating UE.\n-\tLink Local IPv6 Address: a link-local IPv6 address formed locally based on RFC 4862 [21] if UE-1 does not support the IPv6 IP address allocation mechanism, i.e. the IP Address Configuration indicates \"IPv6 address allocation not supported\".\n-\tQoS Info: the information about PC5 QoS Flow(s) to be added. For each PC5 QoS Flow, the PFI, the corresponding PC5 QoS parameters (i.e. PQI and conditionally other parameters such as MFBR/GFBR, etc.) and the associated V2X service type(s).\n\tThe source Layer-2 ID used for the security establishment procedure is determined as specified in clauses 5.6.1.1 and 5.6.1.4. The destination Layer-2 ID is set to the source Layer-2 ID of the received Direct Communication Request message.\n\tUpon receiving the security establishment procedure messages, UE-1 obtains the peer UE's Layer-2 ID for future communication, for signalling and data traffic for this unicast link.\n5.\tA Direct Communication Accept message is sent to UE-1 by the target UE(s) that has successfully established security with UE-1:\n5a.\t(UE oriented Layer-2 link establishment) If the Target User Info is included in the Direct Communication Request message, the target UE, i.e. UE-2 responds with a Direct Communication Accept message if the Application Layer ID for UE-2 matches.\n5b.\t(V2X Service oriented Layer-2 link establishment) If the Target User Info is not included in the Direct Communication Request message, the UEs that are interested in using the announced V2X Service(s) respond to the request by sending a Direct Communication Accept message (UE-2 and UE-4 in Figure 6.3.3.1-1).\n\tThe Direct Communication Accept message includes:\n-\tSource User Info: Application Layer ID of the UE sending the Direct Communication Accept message.\n-\tQoS Info: the information about PC5 QoS Flow(s) requested by UE-1. For each PC5 QoS Flow, the PFI, the corresponding PC5 QoS parameters (i.e. PQI and conditionally other parameters such as MFBR/GFBR, etc.) and the associated V2X service type(s).\n-\tIf IP communication is used:\n-\tIP Address Configuration: For IP communication, IP address configuration is required for this link and indicates one of the following values:\n-\t\"IPv6 Router\" if IPv6 address allocation mechanism is supported by the target UE, i.e., acting as an IPv6 Router; or\n-\t\"IPv6 address allocation not supported\" if IPv6 address allocation mechanism is not supported by the target UE.\n-\tLink Local IPv6 Address: a link-local IPv6 address formed locally based on RFC 4862 [21] if the target UE does not support the IPv6 IP address allocation mechanism, i.e. the IP Address Configuration indicates \"IPv6 address allocation not supported\", and UE-1 included a link-local IPv6 address in the Direct Communication Request message. The target UE shall include a non-conflicting link-local IPv6 address.\n\tIf both UEs (i.e. the initiating UE and the target UE) selected to use link-local IPv6 address, they shall disable the duplicate address detection defined in RFC 4862 [21].\nNOTE 3:\tWhen either the initiating UE or the target UE indicates the support of IPv6 router, corresponding address configuration procedure would be carried out after the establishment of the layer 2 link, and the link-local IPv6 addresses are ignored.\n\tThe V2X layer of the UE that established PC5 unicast link passes the PC5 Link Identifier assigned for the unicast link and the PC5 unicast link related information down to the AS layer. The PC5 unicast link related information includes Layer-2 ID information (i.e. source Layer-2 ID and destination Layer-2 ID) and the corresponding PC5 QoS parameters. This enables the AS layer to maintain the PC5 Link Identifier together with the PC5 unicast link related information.\n6.\tV2X service data is transmitted over the established unicast link as below:\n\tThe PC5 Link Identifier, and PFI are provided to the AS layer, together with the V2X service data.\n\tOptionally in addition, the Layer-2 ID information (i.e. source Layer-2 ID and destination Layer-2 ID) is provided to the AS layer.\nNOTE 4:\tIt is up to UE implementation to provide the Layer-2 ID information to the AS layer.\n\tUE-1 sends the V2X service data using the source Layer-2 ID (i.e. UE-1's Layer-2 ID for this unicast link) and the destination Layer-2 ID (i.e. the peer UE's Layer-2 ID for this unicast link).\nNOTE 5:\tPC5 unicast link is bi-directional, therefore the peer UE of UE-1 can send the V2X service data to UE-1 over the unicast link with UE-1.\n6.3.3.2\tLink identifier update for a unicast link\nFigure 6.3.3.2-1 shows the link identifier update procedure for a unicast link. When privacy requirements is configured for a V2X service type associated with the unicast link, identifiers used for unicast mode of V2X communication over PC5 reference point (e.g. Application Layer ID, Source Layer-2 ID and IP address/prefix) shall be changed over time as specified in clauses 5.6.1.1 and 5.6.1.4. A UE may decide to change the identifiers for other reasons, e.g. application layer requirement. This procedure is used to update and exchange new identifiers between the source and the peer UEs for a unicast link before using the new identifiers, to prevent service interruptions. When there are privacy requirements as indicated above, this procedure is executed over a security protected unicast link.\nIf a UE has multiple unicast links using the same Application Layer IDs or Layer-2 IDs, the UE needs to perform the link identifier update procedure over each of the unicast link.\n\nFigure 6.3.3.2-1: Link identifier update procedure\n0.\tUE-1 and UE-2 have a unicast link established as described in clause 6.3.3.1.\n1.\tUE-1 decides to change its identifier(s), e.g. due to the Application Layer ID change or upon expiry of a timer. UE-1 generates its new Layer-2 ID and sends a Link Identifier Update Request message to UE-2 using the old identifiers.\n\tThe Link Identifier Update Request message includes the new identifier(s) to use (including the new Layer-2 ID, Security Information, optionally the new Application Layer ID and optionally new IP address/prefix if IP communication is used). The new identifier(s) shall be cyphered to protect privacy if security is configured for the unicast link. After sending the Link Identifier Update Request message, if the UE-1 has data to send, UE-1 keeps sending data traffic to UE-2 with the old identifiers until UE-1 sends the Link Identifier Update Ack message to UE-2.\nNOTE 1:\tThe timer is running on per Source Layer-2 ID.\nNOTE 2:\tWhen one of the two UEs acts as IPv6 router as described in clause 5.2.1.5 and IP address/prefix also needs to be changed, corresponding address configuration procedure would be carried out after the Link Identifier update procedure.\n2.\tUpon reception of the Link Identifier Update Request message, UE-2 changes its identifier(s). UE-2 responds with a Link Identifier Update Response message which includes the new identifier(s) to use (including the new Layer-2 ID, Security Information, optionally the new Application Layer ID, and optionally a new IP address/prefix if IP communication is used). The new identifier(s) shall be cyphered to protect privacy if security is configured for the unicast link. The Link Identifier Update Response message is sent using the old identifiers. UE-2 continues to receive traffic with the old Layer-2 ID from UE-1 until UE-2 receives traffic with the new Layer-2 ID from UE-1. After sending the Link Identifier Update Response message, UE-2 keeps sending data traffic to UE-1 with the old identifiers, if UE-2 has data to send, until UE-2 receives the Link Identifier Update Ack message from UE-1.\n3.\tUpon reception of the Link Identifier Update Response message, UE-1 responds with a Link Identifier Update Ack message. The Link Identifier Update Ack message includes the new identifier(s) from UE-2, as received on the Link Identifier Update Response message. The Link Identifier Update Ack message is sent using the old identifiers. UE-1 continues to receive traffic with the old Layer-2 ID from UE-2 until UE-1 receives traffic with the new Layer-2 ID from UE-2.\n4.\tThe V2X layer of UE-1 passes the PC5 Link Identifier for the unicast link and the updated Layer-2 IDs (i.e. new Layer-2 ID for UE-1 for the source and new Layer-2 ID of UE-2 for the destination) down to the AS layer. This enables the AS layer to update the provided Layer-2 IDs for the unicast link.\n\tUE-1 starts using its new identifiers and UE-2's new identifiers for this unicast link.\n5.\tUpon reception of the Link Identifier Update Ack message, the V2X layer of UE-2 passes the PC5 Link Identifier for the unicast link and the updated Layer-2 IDs (i.e. new Layer-2 ID of UE-2 for the source and new Layer-2 ID for UE-1 for the destination) down to the AS layer. This enables the AS layer to update the provided Layer-2 IDs for the unicast link.\n\tUE-2 starts using its new identifiers and UE-1's new identifiers for this unicast link.\nNOTE 3:\tThe Security Information in the above messages also needs to be updated at the same time as the Layer-2 IDs. This is defined in TS 33.536 [26].\n6.3.3.3\tLayer-2 link release over PC5 reference point\nFigure 6.3.3.3-1 shows the layer-2 link release procedure over PC5 reference point.\n\nFigure 6.3.3.3-1: Layer-2 link release procedure\n0.\tUE-1 and UE-2 have a unicast link established as described in clause 6.3.3.1.\n1.\tUE-1 sends a Disconnect Request message to UE-2 in order to release the layer-2 link and deletes all context data associated with the layer-2 link. The Disconnect Request message includes Security Information.\n2.\tUpon reception of the Disconnect Request message UE-2 may respond with a Disconnect Response message and deletes all context data associated with the layer-2 link. The Disconnect Response message includes Security Information.\n\tThe V2X layer of each UE informs the AS layer that the unicast link has been released. The V2X layer uses PC5 Link Identifier to indicate the released unicast link. This enables the AS layer to delete the context related to the released unicast link.\nNOTE:\tThe Security Information in the above messages is defined in TS 33.536 [26].\n6.3.3.4\tLayer-2 link modification for a unicast link\nFigure 6.3.3.4-1 shows the layer-2 link modification procedure for a unicast link. This procedure is used to:\n-\tadd new PC5 QoS Flow(s) in the existing PC5 unicast link.\n-\tThis covers the case for adding new PC5 QoS Flow(s) to the exisiting V2X service(s) as well as the case for adding new PC5 QoS Flow(s) to new V2X service(s).\n-\tmodify existing PC5 QoS Flow(s) in the existing PC5 unicast link.\n-\tThis covers the case for modifying the PC5 QoS parameters for existing PC5 QoS Flow(s).\n-\tThis also covers the case for removing the associated V2X service(s) from existing PC5 QoS Flow(s) as well as the case for associating new V2X service(s) with existing PC5 QoS Flow(s).\n-\tremove existing PC5 QoS Flow(s) in the existing PC5 unicast link.\n\nFigure 6.3.3.4-1: Layer-2 link modification procedure\n0.\tUE-1 and UE-2 have a unicast link established as described in clause 6.3.3.1.\n1.\tThe V2X application layer in UE-1 provides application information for PC5 unicast communication. The application information includes the V2X service type(s) and the initiating UE's Application Layer ID. The target UE's Application Layer ID may be included in the application information. If UE-1 decides to reuse the existing PC5 unicast link as specified in clause 5.2.1.4, so decides to modify the unicast link established with UE-2, UE-1 sends a Link Modification Request to UE-2.\n\tThe Link Modification Request message includes:\na)\tTo add new PC5 QoS Flow(s) in the existing PC5 unicast link:\n-\tQoS Info: the information about PC5 QoS Flow(s) to be added. For each PC5 QoS Flow, the PFI, the corresponding PC5 QoS parameters (i.e. PQI and conditionally other parameters such as MFBR/GFBR, etc.) and the associated V2X service type(s).\nb)\tTo modify PC5 QoS Flow(s) in the existing PC5 unicast link:\n-\tQoS Info: the information about PC5 QoS Flow(s) to be modified. For each PC5 QoS Flow, the PFI, the corresponding PC5 QoS parameters (i.e. PQI and conditionally other parameters such as MFBR/GFBR, etc.) and the associated V2X service type(s).\nc)\tTo remove PC5 QoS Flow(s) in the existing PC5 unicast link:\n-\tPFI(s).\n2.\tUE-2 responds with a Link Modification Accept message.\nThe Link Modification Accept message includes:\n-\tFor case a) and case b) described in step 1:\n-\tQoS Info: the information about PC5 QoS Flow(s) requested by UE-1. For each PC5 QoS Flow, the PFI, the corresponding PC5 QoS parameters (i.e. PQI and conditionally other parameters such as MFBR/GFBR, etc.) and the associated V2X service type(s).\nThe V2X layer of each UE provides information about the unicast link modification to the AS layer. This enables the AS layer to update the context related to the modified unicast link.\n6.3.3.5\tLayer-2 link maintenance over PC5 reference point\nThe PC5 Signalling Protocol shall support keep-alive functionality that is used to detect if a particular PC5 unicast link is still valid. Either side of the PC5 unicast link can initiate the layer-2 link maintenance procedure (i.e. keep-alive procedure), based on for example triggers from the AS layer or internal timers. The UEs shall minimize the keep-alive signalling, e.g. cancel the procedure if data are successfully received over the PC5 unicast link.\n\nFigure 6.3.3.5-1: Layer-2 link maintenance procedure\n0.\tUE-1 and UE-2 have a unicast link established as described in clause 6.3.3.1.\n1.\tBased on trigger conditions, UE-1 sends a Keep-alive message to UE-2 in order to determine the status of the PC5 unicast link.\nNOTE 1:\tIt is left to Stage 3 to determine the exact triggers for the keep-alive messages. For example, the trigger can be based on a timer associated with the Layer-2 link. The timer can be reset with a successful reception event defined by TS 38.300 [11].\n2.\tUpon reception of the Keep-alive message, UE-2 responds with a Keep-alive Ack message.\nThe UE initiating the keep-alive procedure shall determine the follow up actions based on the result of the signalling, e.g. proceed with implicit layer-2 link release.\nNOTE 2:\tIt is left to Stage 3 to determine the follow up actions. For example, a successful reception event can also cancel the layer-2 link release if received in time.\n6.4\tProcedures for V2X communication over Uu reference point\n6.4.1\tProcedure for notification on QoS Sustainability Analytics to the V2X Application Server\nFigure 6.4.1-1 depicts a procedure for notification on QoS Sustainability Analytics to the V2X Application Server.\n\nFigure 6.4.1-1: Notification on QoS Sustainability Analytics to the V2X Application Server\n1.\tThe V2X Application Sever derives information on V2X service, location information (an area or path of interest), QoS requirements and reporting threshold(s). The location information can be in the form of geographic coordinates to reflect a list of waypoints.\nNOTE 1:\tStep 1 is outside 3GPP scope. The V2X Application Server can derive this, for example, based on information provided by the UE(s) or the V2X Application Server uses locally configured information.\n2.\tThe V2X Application Server subscribes to or requests notification on QoS Sustainability Analytics provided by NWDAF via NEF by invoking Nnef_AnalyticsExposure_Subscribe service operation as defined in clause 6.1.1.2 of TS 23.288 [20] or Nnef_AnalyticsExposure_Fetch service operation as defined in clause 6.1.2.2 of TS 23.288 [20]. The parameters included in the request are described in clause 5.4.5.2.2.\n\tThe V2X Application Server may include multiple sets of parameters in order to provide different combinations of \"Location information\" and \"Analytics Target Period\" when requesting notification on QoS Sustainability Analytics.\nNOTE 2:\tThe V2X Application Server needs to set the \"Time when analytics information is needed\" parameter (see TS 23.288 [20]) appropriately, e.g. large enough, to perform the V2X application adjustment before the potential QoS change happens.\nNOTE 3:\tThe request made by the V2X Application Server does not have to be per UE. In order to make a request for multiple UEs, the V2X Application Server can perform mapping between individual UE path requests and subscription to notification per path/road segment. Whether a request is generated for a UE or multiple UEs, and how to set the parameters included in the request and triggers for such request are up to the V2X Application Server implementation and outside of the scope of 3GPP.\n3.\tWhen the NEF receives the request from the V2X Application Server, the NEF interacts with the NWDAF as described in the procedure in clause 6.9.4 of TS 23.288 [20]. The NEF shall map the QoS Characteristics attributes including Resource Type, PDB and PER received from the V2X Application Server to the most appropriate 5QI that is supported by the network if the V2X application server does not provide 5QI. If 5QI is provided by the V2X Application Server, NEF does not perform such mapping. The NEF may map other parameters included in the request from the V2X Application Server to information used by the 3GPP system.\n4.\tIf the NEF receives the response from the NWDAF, the NEF notifies the V2X Application Server with the analytics information on QoS Sustainability Analytics by invoking Nnef_AnalyticsExposure_Notify service operation for a Subscribe-Notify model as defined in clause 6.1.1.2 of TS 23.288 [20] or Nnef_AnalyticsExposure_Fetch service operation for a Request-Response model as defined in clause 6.1.2.2 of TS 23.288 [20].\n5.\tV2X application adjustment may take place.\nNOTE 4:\tStep 5 is outside 3GPP scope. V2X application adjustment can take place at UE and/or V2X Application Server, e.g. adjust inter-vehicle gap, change video codec parameters, etc. For the case that the V2X Application Server uses the request for multiple UEs in step 2, the V2X Application Server can perform the V2X application adjustment for every UE corresponding to the request.\nFor a Subscribe-Notify model, when the V2X Application Sever wants to cancel subscription to analytics information, it invokes the Nnef_AnalyticsExposure_Unsubscribe service operation as defined in clause 6.1.1.2 of TS 23.288 [20].\n6.5\tProcedures for Service Authorization to NG-RAN for V2X communications over PC5 reference point\n6.5.1\tGeneral\nIn order to enable PC5 radio resource control in NG-RAN, per PC5 RAT V2X service authorization information and PC5 QoS parameters need to be made available in NG-RAN, this clause describes the corresponding procedures and aspects.\n6.5.2\tRegistration procedure\nThe Registration procedure for UE is performed as defined in TS 23.502 [7] with the following additions:\n-\tThe UE includes the PC5 Capability for V2X (i.e. LTE PC5 only, NR PC5 only, both LTE and NR PC5) as part of the \"5GMM capability\" in the Registration Request message. The AMF stores this information for V2X operation. The PC5 Capability for V2X indicates whether the UE is capable of V2X communication over PC5 reference point and which specific PC5 RAT(s) it supports.\n-\tThe AMF obtains the V2X Subscription data as part of the user subscription data from UDM during UE Registration procedure using Nudm_SDM service as defined in clause 4.2.2.2.2 of TS 23.502 [7].\n-\tThe AMF determines whether the UE is authorized to use V2X communication over PC5 reference point based on UE's PC5 Capability for V2X and the subscription data related to V2X service authorization information (i.e. \"V2X services authorized\" indication, UE-PC5-AMBR per PC5 RAT and cross-RAT PC5 control authorization if applicable) received from UDM, and stores the V2X service authorization information as part of the UE context.\n-\tThe PCF provides the PC5 QoS parameters to AMF, and the AMF stores them in the UE context.\n-\tIf the UE is PC5 capable for V2X, and the UE is authorized to use V2X communication over PC5 reference point based on the subscription data, then the AMF shall include the following information in the NGAP message sent to NG-RAN:\n-\ta \"V2X services authorized\" indication, indicating the UE is authorized to use V2X communication over PC5 reference point as Vehicle UE, Pedestrian UE or both.\n-\tUE-PC5-AMBR per PC5 RAT and cross-RAT PC5 control authorization (if applicable), used by NG-RAN for the resource management of UE's PC5 transmission for V2X services in network scheduled mode.\n-\tthe PC5 QoS parameters used by the NG-RAN for the resource management of UE's PC5 transmission for V2X services in network scheduled mode.\n-\tIf the UE is authorized to use V2X communication over PC5 reference point, then the AMF should not initiate the release of the signalling connection after the completion of the Registration procedure. The release of the NAS signalling relies on the decision of NG-RAN, as specified in TS 23.502 [7].\n6.5.3\tService Request procedure\nThe Service Request procedure for UE in CM-IDLE state is performed as defined in TS 23.502 [7] with the following additions:\n-\tIf the UE is PC5 capable for V2X, and the UE is authorized to use V2X communication over PC5 reference point, then the AMF shall include a \"V2X services authorized\" indication in the NGAP message, indicating the UE is authorized to use V2X communication over PC5 reference point as Vehicle UE, Pedestrian UE or both.\n-\tThe AMF includes the UE-PC5-AMBR, and cross-RAT PC5 control authorization in the NGAP message to the NG-RAN as part of the UE context and NG-RAN may use in resource management of UE's PC5 transmission for V2X services in network scheduled mode.\n-\tThe AMF sends the PC5 QoS parameters to NG-RAN via N2 signalling. The PC5 QoS parameters may be stored in the UE context after the registration procedure. If the UE is authorized to use V2X communication over PC5 reference point but AMF does not have PC5 QoS parameters available, the AMF fetches the PC5 QoS parameters from the PCF.\n6.5.4\tN2 Handover procedure\nThe N2 based handover or the Inter-RAT to NG-RAN handover procedures for UE are performed as defined in TS 23.502 [7] with the following additions:\n-\tIf the UE is PC5 capable for V2X, and the UE is authorized to use V2X communication over PC5 reference point, then the target AMF shall send the \"V2X services authorized\" indication, UE-PC5-AMBR, cross-RAT PC5 control authorization, and PC5 QoS parameters to the target NG-RAN as follows:\n-\tFor the intra AMF handover, the \"V2X services authorized\" indication, UE-PC5-AMBR, cross-RAT PC5 control authorization, and PC5 QoS parameters are included in the NGAP Handover Request message.\n-\tFor the inter AMF handover or Inter-RAT handover to NG-RAN, the \"V2X services authorized\" indication, UE-PC5-AMBR, cross-RAT PC5 control authorization, and PC5 QoS parameters are included in the NGAP Handover Request message sent to the target NG-RAN.\n6.5.5\tXn Handover procedure\nThe Xn based handover procedures for UE are performed as defined in TS 23.502 [7] with the following additions:\n-\tIf the \"V2X services authorized\" indication is included in the UE context (as described in TS 38.423 [23]), then the source NG-RAN shall include a \"V2X services authorized\" indication, UE-PC5-AMBR, cross-RAT PC5 control authorization and PC5 QoS parameters in the XnAP Handover Request message to the target NG-RAN.\n-\tIf the UE is PC5 capable for V2X, and the UE is authorized to use V2X communication over PC5 reference point, then the AMF shall send the \"V2X services authorized\" indication, the UE-PC5-AMBR, cross-RAT PC5 control authorization, and PC5 QoS parameters to the target NG-RAN in the Path Switch Request Acknowledge message\n6.5.6\tSubscriber Data Update Notification to AMF\nThe procedure of Subscriber Data Update Notification to AMF is performed as defined in TS 23.502 [7] with the following additions:\n-\tThe Nudm_SDM_Notification service operation may contain the \"V2X services authorized\" indication or the UE-PC5-AMBR, or cross-RAT PC5 control authorization or any combination;\n-\tThe AMF updates the UE Context with the above new V2X subscription data.\n-\tWhen the AMF updates UE context stored at NG-RAN, the UE context contains the V2X subscription data.\n6.5.7\tDelivery of PC5 QoS parameters to NG-RAN\nThe UE Policy Association Establishment procedure and UE Policy Association Modification procedure, as defined in TS 23.502 [7], is used to provide to the AMF PC5 QoS parameters used by NG-RAN. When receiving Npcf_UEPolicyControl_Create Request from the AMF which includes the PC5 capability for V2X or when receiving the updated subscription data from UDR, the PCF generates the PC5 QoS parameters used by NG-RAN corresponding to a UE as defined in clause 5.4.2.\nThe (V-)PCF provides the information to the AMF as follows:\n-\tIn the roaming case, the H-PCF includes the PC5 QoS parameters used by NG-RAN in the Npcf_UEPolicyControl_Create Response message or Npcf_UEPolicyControl UpdateNotify Request message sent to V-PCF in an N2 PC5 policy container, and V-PCF relays this N2 PC5 policy container as the N2 container in the Namf_Communication_N1N2MessageTransfer message sent to AMF.\n-\tIn the non-roaming case, the PCF includes the PC5 QoS parameters used by NG-RAN in an N2 container in Namf_Communication_N1N2MessageTransfer message sent to AMF.\nWhen the AMF determines that the N2 PC5 policy container comes from (V-)PCF, the AMF stores such information as part of the UE context.\nIn the UE Configuration Update procedure triggered by UE Policy Association Establishment or UE Policy Association Modification, t:\n-\tThe AMF forwards the PC5 QoS parameters in the NGAP message to the NG-RAN if a N2 PC5 policy container is received in the Namf_Communication_N1N2MessageTransfer message.\n-\tThe AMF forwards the PC5 QoS parameters in the NAS message to UE by using the UE Configuration Update procedure for transparent UE Policy delivery procedure defined in clause 4.2.4.3 of TS 23.502 [7] if a UE Policy Container is received in the Namf_Communication_N1N2MessageTransfer message.\nNOTE 1:\tIf the PC5 QoS parameters are provided to both NG-RAN and UE, both the N2 PC5 Policy Container and the UE Policy Container are included in the Namf_Communication_N1N2MessageTransfer message.\nNOTE 2:\tNon-UE specific PC5 QoS parameters, e.g. default PC5 QoS parameters, can also be locally configured in NG-RAN. How such configuration is performed is out of scope of this specification.\n6.5.8\tPC5 Capability for V2X indication and V2X related information per PC5 RAT\nA UE may support multiple PC5 RATs (i.e. LTE PC5 and NR PC5). For such UE, the PC5 Capability for V2X indication and V2X related information can be per PC5 RAT as described in clause 6.5.2.\nThe cross-RAT PC5 control authorization indicates whether LTE Uu controls LTE PC5 and/or NR PC5 from the cellular network, and whether NR Uu controls LTE PC5 and/or NR PC5 from the cellular network.\nNOTE:\tStage 3 does not define an explicit cross-RAT PC5 control authorization IE and it is indicated in an implicit manner as specified in TS 38.413 [22] and TS 38.423 [23].\nAnnex A (informative):\nApplication Function influence based edge computing for V2X services\nTo route V2X messages or any traffic for V2X purposes to/from V2X Application Server(s) in a local Data Network (DN) close to NG-RAN, V2X Application Server operated by e.g. operators, OEMs, road authorities, can use the Application Function (AF) influence on traffic routing feature defined in clause 5.6.7 of TS 23.501 [6].\nThe V2X Application Server that sends the AF request for AF influence based edge computing for V2X services can be the same V2X Application Server to/from which the traffic is routed.\nWhen Application Function influence on traffic routing is applied, a local UPF can be selected to route the traffic to the local V2X Application Server.\nUsage of Application Function (AF) influence on traffic routing feature and its application for SMF to control UPF data forwarding are defined in clause 5.6.7 and clause 5.8.2 of TS 23.501 [6].\nAnnex B (informative):\nRoad Side Unit (RSU) implementation options\nThis Annex presents examples how RSU can be implemented in 5GS, as shown in TS 23.285 [8]. Figure B-1 shows a UE-type RSU, which combines a UE with the V2X application logic.\n\nFigure B-1: RSU includes a UE and the V2X application logic\nFigure B-2 shows one example of gNB-type RSUs. In this example, the RSU comprises a gNB, a collocated UPF, and a V2X Application Server.\n\nFigure B-2: RSU includes a gNB, collocated UPF and a V2X Application Server\nAnnex C (informative):\nChange history\n",
  "normalized_text": "contents foreword 6 1 scope 7 2 references 7 3 definitions and abbreviations 8 3.1 definitions 8 3.2 abbreviations 9 4 architecture model and concepts 10 4.1 general concept 10 4.2 architectural reference model 10 4.2.1 pc5 and uu based v2x architecture reference model 10 4.2.1.1 non-roaming 5g system architecture for v2x communication over pc5 and uu reference points 10 4.2.1.2 roaming 5g system architecture for v2x communication over pc5 and uu reference points 11 4.2.1.3 inter-plmn 5g system architecture for v2x communication over pc5 reference point 12 4.2.2 af-based service parameter provisioning for v2x communications 12 4.2.3 reference points 12 4.2.4 service-based interfaces 13 4.3 architecture reference model for interworking with eps v2x 13 4.4 functional entities 14 4.4.1 ue 14 4.4.2 pcf 15 4.4.3 v2x application server 15 4.4.4 amf 15 4.4.5 udm 15 4.4.6 udr 16 4.4.7 nrf 16 5 high level functionality and features 16 5.1 authorization and provisioning for v2x communications 16 5.1.1 general 16 5.1.2 authorization and provisioning for v2x communications over pc5 reference point 17 5.1.2.1 policy/parameter provisioning 17 5.1.2.2 principles for applying parameters for v2x communications over pc5 reference point 18 5.1.3 authorization and provisioning for v2x communications over uu reference point 19 5.1.3.1 policy/parameter provisioning 19 5.2 v2x communication 20 5.2.1 v2x communication over pc5 reference point 20 5.2.1.1 general 20 5.2.1.2 broadcast mode communication over pc5 reference point 21 5.2.1.3 groupcast mode communication over pc5 reference point 21 5.2.1.4 unicast mode communication over pc5 reference point 21 5.2.1.5 ip address allocation 23 5.2.2 v2x communication over uu reference point 23 5.2.2.1 v2x communication via unicast 23 5.2.3 v2x communication over pc5 or uu reference point 24 5.2.3.1 general 24 5.3 v2x application server discovery 24 5.3.1 general 24 5.3.2 multiple v2x application server and localized v2x application server discovery and routing 25 5.4 qos handling for v2x communication 25 5.4.1 qos handling for v2x communication over pc5 reference point 25 5.4.1.1 qos model 25 5.4.1.1.1 general overview 25 5.4.1.1.2 deriving pc5 qos parameters and assigning pfi for pc5 qos flow 27 5.4.1.1.3 handling of pc5 qos flows based on pc5 qos rules 27 5.4.1.1.4 pc5 packet filter set 29 5.4.1.2 qos handling for broadcast mode v2x communication over pc5 reference point 29 5.4.1.3 qos handling for groupcast mode v2x communication over pc5 reference point 30 5.4.1.4 qos handling for unicast mode v2x communication over pc5 reference point 30 5.4.2 pc5 qos parameters 30 5.4.2.1 pqi 30 5.4.2.2 pc5 flow bit rates 30 5.4.2.3 pc5 link aggregated bit rates 31 5.4.2.4 range 31 5.4.2.5 default values 31 5.4.3 pc5 qos characteristics 31 5.4.3.1 general 31 5.4.3.2 resource type 31 5.4.3.3 priority level 32 5.4.3.4 packet delay budget 32 5.4.3.5 packet error rate 32 5.4.3.6 averaging window 32 5.4.3.7 maximum data burst volume 32 5.4.4 standardized pqi to qos characteristics mapping 32 5.4.5 qos handling for v2x communication over uu reference point 33 5.4.5.1 general 33 5.4.5.2 notification on qos sustainability analytics to the v2x application server 34 5.4.5.2.1 general 34 5.4.5.2.2 functional description 34 5.4.5.3 qos change based on extended ng-ran notification to support alternative service requirements 34 5.5 subscription to v2x services 35 5.6 identifiers 35 5.6.1 identifiers for v2x communication over pc5 reference point 35 5.6.1.1 general 35 5.6.1.2 identifiers for broadcast mode v2x communication over pc5 reference point 36 5.6.1.3 identifiers for groupcast mode v2x communication over pc5 reference point 36 5.6.1.4 identifiers for unicast mode v2x communication over pc5 reference point 36 5.7 support for v2x communication for ues in limited service state 36 5.8 interworking between eps v2x and 5gs v2x 37 5.8.1 v2x policy and parameter provisioning 37 5.8.2 pc5 operation 37 5.8.3 mobility between eps and 5gs over uu 37 6 functional description and information flows 37 6.1 control and user plane stacks 37 6.1.1 user plane for nr pc5 reference point supporting v2x services 37 6.1.2 control plane for nr pc5 reference point supporting v2x services 38 6.2 procedures for service authorization and provisioning to ue 39 6.2.1 general 39 6.2.2 pcf based service authorization and provisioning to ue 39 6.2.3 pcf discovery 39 6.2.4 procedure for ue triggered v2x policy provisioning 40 6.2.5 af-based service parameter provisioning for v2x communications over control plane 40 6.3 procedures for v2x communication over pc5 reference point 40 6.3.1 broadcast mode v2x communication over pc5 reference point 40 6.3.2 groupcast mode v2x communication over pc5 reference point 41 6.3.3 unicast mode v2x communication over pc5 reference point 42 6.3.3.1 layer-2 link establishment over pc5 reference point 42 6.3.3.2 link identifier update for a unicast link 46 6.3.3.3 layer-2 link release over pc5 reference point 47 6.3.3.4 layer-2 link modification for a unicast link 47 6.3.3.5 layer-2 link maintenance over pc5 reference point 48 6.4 procedures for v2x communication over uu reference point 49 6.4.1 procedure for notification on qos sustainability analytics to the v2x application server 49 6.5 procedures for service authorization to ng-ran for v2x communications over pc5 reference point 51 6.5.1 general 51 6.5.2 registration procedure 51 6.5.3 service request procedure 51 6.5.4 n2 handover procedure 52 6.5.5 xn handover procedure 52 6.5.6 subscriber data update notification to amf 52 6.5.7 delivery of pc5 qos parameters to ng-ran 52 6.5.8 pc5 capability for v2x indication and v2x related information per pc5 rat 53 annex a (informative): application function influence based edge computing for v2x services 54 annex b (informative): road side unit (rsu) implementation options 55 annex c (informative): change history 56 foreword this technical specification has been produced by the 3rd generation partnership project (3gpp). the contents of the present document are subject to continuing work within the tsg and may change following formal tsg approval. should the tsg modify the contents of the present document, it will be re-released by the tsg with an identifying change of release date and an increase in version number as follows: version x.y.z where: x the first digit: 1 presented to tsg for information; 2 presented to tsg for approval; 3 or greater indicates tsg approved document under change control. y the second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc. z the third digit is incremented when editorial only changes have been incorporated in the document. 1 scope the present document specifies architecture enhancements to the 5g system to facilitate vehicular communications for vehicle-to-everything (v2x) services, over the following reference points, based on service requirements defined in ts 22.185 [2] and ts 22.186 [3]: - pc5 reference point: nr pc5 rat, lte pc5 rat. - uu reference point: nr, e-utra. this specification also covers interworking with eps. 2 references the following documents contain provisions which, through reference in this text, constitute provisions of the present document. - references are either specific (identified by date of publication, edition number, version number, etc.) or non-specific. - for a specific reference, subsequent revisions do not apply. - for a non-specific reference, the latest version applies. in the case of a reference to a 3gpp document (including a gsm document), a non-specific reference implicitly refers to the latest version of that document in the same release as the present document. [1] 3gpp tr 21.905: \"vocabulary for 3gpp specifications\". [2] 3gpp ts 22.185: \"service requirements for v2x services; stage 1\". [3] 3gpp ts 22.186: \"enhancement of 3gpp support for v2x scenarios; stage 1\". [4] iso 17419:2018: \"intelligent transport systems - cooperative systems - globally unique identification\". [5] ieee std 1609.12-2016: \"ieee standard for wireless access in vehicular environments (wave) - identifier allocations\". [6] 3gpp ts 23.501: \"system architecture for the 5g system; stage 2\". [7] 3gpp ts 23.502: \"procedures for the 5g system; stage 2\". [8] 3gpp ts 23.285: \"architecture enhancements for v2x services\". [9] 3gpp ts 36.300: \"evolved universal terrestrial radio access (e-utra) and evolved universal terrestrial radio access network (e-utran); overall description; stage 2\". [10] 3gpp ts 36.304: \"evolved universal terrestrial radio access (e-utra); user equipment (ue) procedures in idle mode\". [11] 3gpp ts 38.300: \"nr; nr and ng-ran overall description; stage 2\". [12] 3gpp ts 38.304: \"nr; user equipment (ue) procedures in idle mode and rrc inactive state\". [13] 3gpp ts 23.122: \"non-access-stratum (nas) functions related to mobile station (ms) in idle mode\". [14] 3gpp ts 36.331: \"evolved universal terrestrial radio access (e-utra); radio resource control (rrc); protocol specification\". [15] 3gpp ts 38.331: \"nr; radio resource control (rrc); protocol specification\". [16] 3gpp ts 23.503: \"policy and charging control framework for the 5g system; stage 2\". [17] 3gpp ts 23.303: \"proximity-based services (prose); stage 2\". [18] ieee std 1609.3-2010: \"ieee standard for wireless access in vehicular environments (wave) - networking services\". [19] iso 29281-1:2013: \"intelligent transport systems - communications access for land mobiles (calm) - non-ip networking - part 1: fast networking & transport layer protocol (fntp)\". [20] 3gpp ts 23.288: \"architecture enhancements for 5g system (5gs) to support network data analytics services\". [21] ietf rfc 4862: \"ipv6 stateless address autoconfiguration\". [22] 3gpp ts 38.413: \"ng-ran; ng application protocol (ngap)\". [23] 3gpp ts 38.423: \"ng-ran; xn application protocol (xnap)\". [24] 3gpp ts 24.587: \"vehicle-to-everything (v2x) services in 5g system (5gs); stage 3\". [25] 3gpp ts 37.340: \"evolved universal terrestrial radio access (e-utra) and nr; multi-connectivity; stage 2\". [26] 3gpp ts 33.536: \"security aspects of 3gpp support for advanced vehicle-to-everything (v2x) services\". [27] ccsa yd/t 3707-2020: \"technical requirements of network layer of lte-based vehicular communication\". 3 definitions and abbreviations 3.1 definitions for the purposes of the present document, the terms and definitions given in tr 21.905 [1] and the following apply. a term defined in the present document takes precedence over the definition of the same term, if any, in tr 21.905 [1]. application layer connection-less group: an application layer group without group formation in the v2x application layer, e.g., sensor sharing. application layer id: an identifier identifying an entity, e.g. a vehicle, a pedestrian, an rsu within the context of a specific v2x application. the format of this identifier is outside the scope of 3gpp. note 1: the application layer id could be e.g. station id or vehicle id defined by other sdos e.g. etsi, society of automotive engineers (sae), etc. note 2: the usage of application layer id, e.g. one application layer id is associated with one v2x application, one application layer id is associated with more than one v2x applications, or one application layer id is used for all v2x applications in the ue, is up to application layer implementation. application layer managed group: an application layer group with group formation and management in the v2x application layer, e.g., platooning, cooperative adaptive cruise control. groupcast mode communication: it refers to v2x communication over pc5 reference point within a group of ues where any ue in the group can act as transmitting ue and the rest act as receiving ues. see also ts 38.300 [11] for more information. the \"group\" here refers to application layer managed group or application layer connection-less group. member id: an identifier uniquely identifying a member in the application layer managed group and that is managed by the v2x application layer. mode of communication: mode of communication to be used by the ue over pc5 reference point i.e. broadcast mode (lte pc5 and nr pc5), groupcast mode (nr pc5) or unicast mode (nr pc5). tx profile: the transmission format (i.e. which 3gpp release) to be used by the ue over a given pc5 rat, see ts 36.300 [9] and ts 38.300 [11]. v2x application: an application using one or more v2x services e.g. an active safety application in a vehicle, using v2x services such as emergency warning and vehicle to vehicle safety and awareness. a v2x application may operate towards a v2x application server. v2x communication: a communication to support vehicle-to-everything (v2x) services leveraging uu and / or pc5 reference points. v2x services are realized by various types of v2x applications, i.e. vehicle-to-vehicle (v2v), vehicle-to-pedestrian (v2p), vehicle-to-infrastructure (v2i) and vehicle-to-network (v2n). v2x message: a dedicated messaging type of v2x service, for example its messages. v2x service: a data service, offered to v2x applications and optionally v2x application servers. a v2x service belongs to one v2x service type. it may include message or other data delivery, as defined in ts 22.185 [2] and ts 22.186 [3]. a v2x service can be associated with one or more v2x applications, and a v2x application can be associated with one or more v2x services. v2x service type: a type of v2x service, which is identified by e.g. its-aid (its application identifier), psid (provider service identifier) or aid (application identifier). for the purposes of the present document, the following terms and definitions given in iso 17419:2018 [4] apply: intelligent transport systems its application identifier for the purposes of the present document, the following term and definition given in ieee std 1609.12-2016 [5] apply: provider service identifier for the purposes of the present document, the following term and definition given in ccsa yd/t 3707-2020 [27] applies: application identifier 3.2 abbreviations for the purposes of the present document, the abbreviations given in tr 21.905 [1] and the following apply. an abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in tr 21.905 [1]. af application function aid application identifier as layer access stratum layer its intelligent transport systems its-aid its application identifier pfi pc5 qos flow identifier pqi pc5 5qi psid provider service identifier rsu road side unit v2i vehicle-to-infrastructure v2n vehicle-to-network v2p vehicle-to-pedestrian v2v vehicle-to-vehicle v2x vehicle-to-everything 4 architecture model and concepts 4.1 general concept there are two modes of operation for v2x communication, namely v2x communication over pc5 reference point and v2x communication over uu reference point. these two operation modes may be used by a ue independently for transmission and reception. v2x communications over pc5 reference point are supported by lte and/or nr. v2x communications over uu reference point are supported by e-utra connected to 5gc and/or nr connected to 5gc. in this release, v2x communication over uu reference point is only unicast. an rsu is not an architectural entity, but an implementation option. this is achieved by collocating a v2x application logic/server with some entities of the 3gpp system, as shown in examples in annex b. 4.2 architectural reference model 4.2.1 pc5 and uu based v2x architecture reference model 4.2.1.1 non-roaming 5g system architecture for v2x communication over pc5 and uu reference points figure 4.2.1.1-1 shows the high level view of the non-roaming 5g system architecture for v2x communication over pc5 and uu reference points. figure 4.2.1.1-1: non-roaming 5g system architecture for v2x communication over pc5 and uu reference points 4.2.1.2 roaming 5g system architecture for v2x communication over pc5 and uu reference points figure 4.2.1.2-1 and figure 4.2.1.2-2 show the high level view of the roaming 5g system architectures for v2x communication over pc5 and uu reference points. in these figures, ue a uses a subscription of hplmn. figure 4.2.1.2-1: roaming 5g system architecture for v2x communication over pc5 and uu reference points - local breakout scenario figure 4.2.1.2-2: roaming 5g system architecture for v2x communication over pc5 and uu reference points - home routed scenario 4.2.1.3 inter-plmn 5g system architecture for v2x communication over pc5 reference point in the case of inter-plmn v2x communication over pc5 reference point, the pc5 parameters need to be configured in a consistent way among the ues within a certain region. the architecture for the inter-plmn pc5 case is similar to the one defined in clause 4.2.1.1. 4.2.2 af-based service parameter provisioning for v2x communications the 5g system provides nef services to enable communication between nfs in the plmn and v2x application server. figure 4.2.2-1 shows the high level view of af-based service parameter provisioning for v2x communications. the v2x application server may provide v2x service parameters to the plmn via nef. the nef stores the v2x service parameters in the udr. figure 4.2.2-1: 5g system architecture for af-based service parameter provisioning for v2x communications 4.2.3 reference points v1: the reference point between the v2x applications in the ue and in the v2x application server. this reference point is out of scope of this specification. v5: the reference point between the v2x applications in the ues. this reference point is not specified in this release of the specification. pc5: the reference point between the ues, and it includes the lte based pc5 and/or nr based pc5. n1: in addition to the relevant functions defined in ts 23.501 [6] for n1, in the case of v2x service it is also used to convey the v2x policy and parameters (including service authorization) from amf to ue and to convey the ue's v2x capability and pc5 capability for v2x information from ue to amf. n2: in addition to the relevant functions defined in ts 23.501 [6] for n2, in the case of v2x service it is also used to convey the v2x policy and parameters (including service authorization) from amf to ng-ran. uu: the reference point between the ue and the ng-ran. 4.2.4 service-based interfaces nudm: in addition to the relevant services defined in ts 23.501 [6] for nudm, in the case of v2x service, services provided by udm are used to get v2x service related subscription information to amf during initial registration procedure or ue configuration update (ucu) procedure to inform amf subscription information has changed. npcf: in addition to the relevant services defined in ts 23.501 [6] for npcf, in the case of v2x service, services provided by h-pcf are used to provide v2x service related parameters to v-pcf for ue and ng-ran in the roaming case. nudr: in addition to the relevant services defined in ts 23.501 [6] for nudr, in the case of v2x service, services provided by udr are used to notify the pcf and the udm of the update of the v2x service related information. nnef: in addition to the relevant services defined in ts 23.501 [6] for nnef, in the case of v2x service, services provided by nef are used by the v2x application server to update v2x service related information of 5gc. namf: in addition to the relevant services defined in ts 23.501 [6] for namf, in the case of v2x service, services provided by amf are consumed by pcf to provide the v2x service related parameters for the ue and the ng-ran to amf, and to enable the amf create or update ue context related to v2x service. nnrf: in addition to the relevant services defined in ts 23.501 [6] for nnrf, in the case of v2x service, services provided by nrf are used to discover the pcf that supports v2x. 4.3 architecture reference model for interworking with eps v2x the interworking between 5gs v2x and eps v2x does not require any new interface between 5gs v2x and eps v2x architectures and does not impact existing network function entities in epc and 5gc. figure 4.3-1 shows one of the architecture reference models. legend: - the functions and reference points for eps v2x are defined in ts 23.285 [8]. figure 4.3-1: architecture for interworking with eps v2x, local breakout roaming 4.4 functional entities 4.4.1 ue in addition to the functions defined in ts 23.501 [6], the ue may support the following functions: - report the v2x capability and pc5 capability for v2x to 5gc over n1 reference point. - indicate v2x policy provisioning request in ue policy container for ue triggered v2x policy provisioning. - receive the v2x parameters from 5gc over n1 reference point. - procedures for v2x communication over pc5 reference point. - configuration of parameters for v2x communication (e.g., destination layer-2 ids, radio resource parameters, v2x application server address information, mapping between v2x service types and v2x frequencies, see clause 5.1). these parameters can be pre-configured in the ue, or, if in coverage, provisioned or updated by signalling over the n1 reference point from the pcf in the hplmn or over v1 reference point from the v2x application server. 4.4.2 pcf in addition to the functions defined in ts 23.501 [6], the pcf includes the function to provision the ue and amf with necessary parameters in order to use v2x communication: - may determine the v2x policy/parameter for specific pc5 rat to provision to the ue based on the received ue's pc5 capability for v2x. - determines whether to provision v2x policy/parameters for v2x communication over pc5 reference point and/or v2x communication over uu reference point to the ue. - provision the ues with authorization and policy parameters for v2x communication over pc5 reference point. - provision the ues with policy parameters for v2x communication over uu reference point. - provision the amf with pc5 qos parameters as defined in clause 5.4.2 used by ng-ran. - retrieve v2x parameters from udr. 4.4.3 v2x application server the v2x application server (v2x as) includes af functionality, and may support at least the following capabilities: for v2x services handling, - receive uplink data from the ue over unicast. - send downlink data to the ue over unicast. - request qos sustainability analytics for potential qos changes in a geographic area from nwdaf via nef. for v2x service parameters provisioning, - provision the 5gc with parameters for v2x communications over pc5 and uu reference points. - provision the ue with parameters for v2x communications over pc5 reference point and/or uu reference point. note: the v2x application servers for v2x services handling and v2x service parameter provisioning can be the same or different. 4.4.4 amf in addition to the functions defined in ts 23.501 [6], the amf performs the following functions: - obtain from udm the subscription information related to v2x and store them as part of the ue context data. - select a pcf supporting v2x policy/parameter provisioning and report the pc5 capability for v2x to the selected pcf. - obtain from pcf the pc5 qos information related to v2x and store it as part of the ue context data. - provision the ng-ran with indication about the ue authorization status about v2x communication over pc5 reference point. - provision the ng-ran with pc5 qos parameters related to v2x communication. 4.4.5 udm in addition to the functions defined in ts 23.501 [6], the udm performs the following functions: - subscription management for v2x communication over pc5 reference point. 4.4.6 udr in addition to the functions defined in ts 23.501 [6], the udr performs the following functions: - stores v2x service parameters. 4.4.7 nrf in addition to the functions defined in ts 23.501 [6], the nrf performs the following functions: - pcf discovery by considering v2x capability. 5 high level functionality and features 5.1 authorization and provisioning for v2x communications 5.1.1 general in 5gs, the parameters for v2x communications over pc5 and uu reference points may be made available to the ue in following ways: - pre-configured in the me; or - configured in the uicc; or - preconfigured in the me and configured in the uicc; or - provided/updated by the v2x application server via pcf and/or v1 reference point; or - provided/updated by the pcf to the ue. if the same parameters described in clauses 5.1.2.1 and 5.1.3.1 are provided by different sources, the ue shall consider them in the following priority order: - provided/updated by the pcf; - provided/updated by the v2x application server via v1 reference point; - configured in the uicc; - pre-configured in the me. the parameters provided/updated by the v2x application server via v1 reference point may need to be complemented with configuration data from other sources listed above. the basic principles of service authorization and provisioning for v2x communication over pc5 reference point and provisioning for v2x communication over uu reference point are: - the ue may be authorized to use v2x communication over pc5 reference point on a per plmn basis by the pcf in the hplmn. - the pcf in the hplmn merges authorization information from home and other plmns and provides the ue with the final authorization information. - the pcf in the vplmn or hplmn may revoke the authorization (via h-pcf when roaming) at any time by using the ue configuration update procedure for transparent ue policy delivery procedure defined in clause 4.2.4.3 of ts 23.502 [7]. - the provisioning to ue for v2x communication over pc5 and uu reference points is controlled by the pcf and may be triggered by ue. the pcf includes the v2x policy/parameters for v2x communications over pc5 reference point as specified in clause 5.1.2.1 and/or the v2x policy/parameters for v2x communications over uu reference point as specified in clause 5.1.3.1 into a policy section identified by a policy section identifier (psi) as specified in clause 6.1.2.2.2 of ts 23.503 [16]. 5.1.2 authorization and provisioning for v2x communications over pc5 reference point 5.1.2.1 policy/parameter provisioning the following sets of information for v2x communications over pc5 reference point is provisioned to the ue: 1) authorization policy: - when the ue is \"served by e-utra\" or \"served by nr\": - plmns in which the ue is authorized to perform v2x communications over pc5 reference point when \"served by e-utra\" or \"served by nr\". for each above plmn: - rat(s) over which the ue is authorized to perform v2x communications over pc5 reference point. - when the ue is \"not served by e-utra\" and \"not served by nr\": - indicates whether the ue is authorized to perform v2x communications over pc5 reference point when \"not served by e-utra\" and \"not served by nr\". - rat(s) over which the ue is authorized to perform v2x communications over pc5 reference point. note 1: in this specification, {when the ue is \"served by e-utra\" or \"served by nr\"} and {when the ue is \"not served by e-utra\" and \"not served by nr\"} are relevant to v2x communications over pc5 reference point. 2) radio parameters when the ue is \"not served by e-utra\" and \"not served by nr\": - includes the radio parameters per pc5 rat (i.e. lte pc5, nr pc5) with geographical area(s) and an indication of whether they are \"operator managed\" or \"non-operator managed\". these radio parameters (e.g., frequency bands) are defined in ts 36.331 [14] and ts 38.331 [15]. the ue uses the radio parameters to perform v2x communications over pc5 reference point when \"not served by e-utra\" and \"not served by nr\" only if the ue can reliably locate itself in the corresponding geographical area. otherwise, the ue is not authorized to transmit. note 2: whether a frequency band is \"operator managed\" or \"non-operator managed\" in a given geographical area is defined by local regulations. 3) policy/parameters for pc5 rat selection and for pc5 tx profile selection: - the mapping of v2x service types to pc5 rat(s) (e.g. lte pc5, nr pc5 or both), and to the corresponding tx profiles (see ts 36.300 [9] and ts 38.300 [11] for further information). 4) policy/parameters related to privacy: - the list of v2x service types, with geographical area(s) that require privacy support. - a privacy timer value indicating the duration after which the ue shall change each source layer-2 id self-assigned by the ue when privacy is required. 5) policy/parameters when lte pc5 is selected: same as specified in ts 23.285 [8] clause 4.4.1.1.2 item 3) policy/parameters except for the mapping of v2x service types to tx profiles and the list of v2x services with geographical area(s) that require privacy support. 6) policy/parameters when nr pc5 is selected: - the mapping of v2x service types to v2x frequencies with geographical area(s). - the mapping of v2x service types to the default mode of communication (i.e. broadcast mode, groupcast mode or unicast mode). - the mapping of v2x service types to destination layer-2 id(s) for broadcast. - the mapping of v2x service types to destination layer-2 id(s) for groupcast mode communication. - the mapping of v2x service types to default destination layer-2 id(s) for initial signalling to establish unicast connection. note 3: the same default destination layer-2 id for unicast initial signalling can be mapped to more than one v2x service types. in the case where different v2x services are mapped to distinct default destination layer-2 ids, when the ue intends to establish a single unicast link that can be used for more than one v2x service types, the ue can select any of the default destination layer-2 ids to use for the initial signalling. - the mapping of v2x service types to pc5 qos parameters defined in clause 5.4.2 (i.e. pqi and conditionally other parameters such as mfbr/gfbr, etc.). - as layer configurations (see ts 38.331 [15]), e.g. the mapping of pc5 qos profile(s) to radio bearer(s), when the ue is \"not served by e-utra\" and \"not served by nr\". - the pc5 qos profile contains pc5 qos parameters described in clause 5.4.2, and value for the qos characteristics regarding priority level, averaging window, maximum data burst volume if default value is not used as defined in table 5.4.4-1. 7) validity timer indicating the expiration time of the v2x policy/parameter. the above parameter sets from bullet 2) to 6) may be configured in the ue through the v1 reference point by the v2x application server. 5.1.2.2 principles for applying parameters for v2x communications over pc5 reference point for v2x communication over pc5 reference point, the operator may pre-configure the ues with the required provisioning parameters for v2x communication, without the need for the ues to connect to the 5gc to get this initial configuration. the following apply: - the provisioning parameters for v2x communications over pc5 reference point may be configured in the uicc, in the me, or in both the uicc and the me. - the me provisioning parameters shall not be erased when a usim is deselected or replaced. - if both the uicc and the me contain the same set of overlapping provisioning parameters, the set of parameters from the uicc shall take precedence. - the provisioning parameters from the pcf or v2x application server via v1 reference point shall take precedence over the pre-configured parameters in the me and uicc as defined in clause 5.1.1. - the ue shall use radio resources for v2x communications over pc5 reference point as follows: - while a ue has a serving cell and is camped on a cell and the ue intends to use for v2x service the radio resources (i.e. carrier frequency) operated by this cell, then the ue shall use the radio resource description indicated by this cell the ue is camped on and ignore any radio resource description of the same radio resource provisioned in the me or the uicc. if the cell does not provide radio resources for v2x service, the ue shall not perform v2x message transmission and reception on radio resources operated by this cell. - if the ue intends to use \"operator-managed\" radio resources (i.e. carrier frequency) for v2x service that are not operated by the ue's serving cell, as specified in clause 5.1.2.1, or if the ue is out of coverage, the ue shall search for a cell in any plmn that is operating the provisioned radio resources (i.e. carrier frequency) as defined in ts 36.300 [9] and ts 36.304 [10] (if lte based pc5 is selected for the v2x communication) or as defined in ts 38.300 [11] and ts 38.304 [12] (if nr based pc5 is selected for the v2x communication), and: - if the ue finds such a cell in the registered plmn or a plmn equivalent to the registered plmn, and authorization for v2x communications over pc5 reference point to this plmn is confirmed, the ue shall use the radio resource description indicated by that cell. if that cell does not provide radio resources for v2x service, the ue shall not perform v2x message transmission and reception on those radio resources. - if the ue finds such a cell but not in the registered plmn or a plmn equivalent to the registered plmn, and that cell belongs to a plmn authorized for v2x communications over pc5 reference point and provides radio resources for v2x service then the ue shall perform plmn selection triggered by v2x communications over pc5 reference point as defined in ts 23.122 [13]. if the ue has an ongoing emergency session via ims, it shall not trigger any plmn selection due to v2x communication over pc5 reference point. - if the ue finds such cell but not in a plmn authorized for v2x communications over pc5 reference point the ue shall not use v2x communications over pc5 reference point. - if the ue does not find any such cell in any plmn, then the ue shall consider itself \"not served by nr or e-utra\" and use radio resources provisioned in the me or the uicc. if no such provision exists in the me or the uicc or the provision does not authorize v2x communications over pc5 reference point, then the ue is not authorized to transmit. - if the ue intends to use \"non-operator-managed\" radio resources (i.e. carrier frequency) for v2x service, according to ts 36.331 [14] or ts 38.331 [15] and as specified in clause 5.1.2.1, then the ue shall perform v2x communication over pc5 using resource provisioned in the me or the uicc. if no such provision exists in the me or the uicc or the provision does not authorize v2x communications over pc5 reference point, then the ue is not authorized to transmit. - the ue provisioning shall support setting geographical areas. note 1: it is possible for a ue to use other radio resources for v2x service based on the geographical area instead of those operated by the serving ng-ran cell, when provisioned in the ue, even if the ue's serving cell offers normal service and the sibs for nr sidelink communication or v2x sidelink communication defined in ts 38.331 [15] indicates that the service (v2x communication) is available. this is to cover the scenario when e.g. the radio resources used for v2x communications over pc5 reference point are not owned by the serving network of the ue. note 2: when cross-carrier operation is supported, according to ts 36.331 [14] or ts 38.331 [15], a ue can be instructed by its serving cell to perform v2x communication over a different carrier frequency. the ue is still considered as \"served by nr or e-utra\" in this case. note 3: the scenario that a cell is detected and the cell does not provide support for v2x communications over pc5 reference point when the ue attempts to use a carrier frequency configured for v2x communications over pc5 reference point, is considered a configuration error. therefore, the ue does not transmit on that frequency to avoid interference to the network. - the v2x communications over pc5 reference point is only specified for e-utra and nr. note 4: it is out of scope of the present specification to define how the ue can locate itself in a specific geographical area. when the ue is in coverage of a 3gpp rat, it can for example, use information derived from the serving plmn. when the ue is not in coverage of a 3gpp rat, it can use other techniques, e.g. global navigation satellite system (gnss). user provided location is not a valid input. 5.1.3 authorization and provisioning for v2x communications over uu reference point 5.1.3.1 policy/parameter provisioning the following set of information may be provisioned to the ue for v2x communications over uu reference point: 1) mapping of the v2x service types to: - pdu session type (i.e. ip type or unstructured type); - transport layer protocol (i.e. udp or tcp, only applicable for ip pdu session type); - ssc mode; - s-nssai(s); - dnn(s). note: above listed information elements are optional and used by ue as ue local configuration specified in ts 23.503 [16]. 2) validity timer indicating the expiration time of the v2x policy/parameter. the following sets of information may be provisioned to the ue and is applicable for v2x communications over both lte-uu and uu reference points: 1) mapping of the v2x service types to v2x application server address information (consisting of ip address/fqdn and transport layer port#) for unicast. 2) list of fqdns or ip addresses of the v2x application servers, associated with served geographical area information and list of plmns that the configuration applies to. 5.2 v2x communication 5.2.1 v2x communication over pc5 reference point 5.2.1.1 general for v2x communication, two types of pc5 reference points exist: the lte based pc5 reference point as defined in ts 23.285 [8], and the nr based pc5 reference point as defined in clause 4.2.3. a ue may use either type of pc5 or both for v2x communication depending on the services the ue supports. the v2x communication over pc5 reference point supports roaming and inter-plmn operations. v2x communication over pc5 reference point is supported when ue is \"served by nr or e-utra\" or when the ue is \"not served by nr or e-utra\". a ue is authorized to transmit and receive v2x messages when it has valid authorization and configuration as specified in clause 5.1.2. the v2x communication over pc5 reference point has the following characteristics: - v2x communication over lte based pc5 reference point is connectionless, i.e. broadcast mode at access stratum (as) layer, and there is no signalling over pc5 for connection establishment. - v2x communication over nr based pc5 reference point supports broadcast mode, groupcast mode, and unicast mode at as layer. if v2x application layer of the ue indicates the mode of communication to v2x layer, the v2x layer shall set the mode of communication based on the request of the v2x application layer; otherwise, the v2x layer sets the mode of communication based on the mapping information for a v2x service type defined in clause 5.1.2.1. the v2x layer indicates the mode of communication for the v2x service type to the as layer. signalling over control plane over pc5 reference point for unicast mode communication management is supported. - v2x services communication support between ues over pc5 user plane. - both ip based and non-ip based v2x services communication are supported over pc5 reference point. - for ip based v2x services communication, only ipv6 is used. ipv4 is not supported. - v2x messages are exchanged between ues over pc5 user plane. - both ip based and non-ip based v2x messages are supported over pc5 reference point. - for ip based v2x messages, only ipv6 is used. ipv4 is not supported. the identifiers used in the v2x communication over pc5 reference point are described in clause 5.6.1. ue decides on the type of pc5 reference point and tx profile to use for the transmission of a particular packet based on the configuration described in clause 5.1.2. when the lte based pc5 reference point is selected, the qos handling corresponding procedures are defined in ts 23.285 [8]. when nr based pc5 reference point is selected, the qos handling and procedures are defined in clauses 5.4.1 and 6.3. if the ue has an ongoing emergency session via ims, the ongoing emergency session via ims shall be prioritized over v2x communication over pc5 reference point. note: the emergency session via ims setup is based on appropriate regional/national regulatory requirements and operator policies as defined in ts 23.501 [6]. the security for v2x communication over pc5 reference point is provided with mechanisms defined in ts 33.536 [26]. for broadcast and groupcast mode communication, security is supported in the v2x application layer schemes developed in other sdos. 5.2.1.2 broadcast mode communication over pc5 reference point broadcast mode of communication is supported over both lte based pc5 reference point and nr based pc5 reference point. therefore, when broadcast mode is selected for transmission over pc5 reference point, pc5 rat selection needs to be performed based on configuration described in clause 5.1.2. based on configuration described in clause 5.1.2 and the availability of the corresponding pc5 rat(s) for the specific v2x service type, the v2x layer in the ue determines pc5 rat(s) and passes the packet to the applicable pc5 as (access stratum) layer(s) with the appropriate pc5 qos parameters as defined in clause 5.4.1.1.1 for lte based pc5 reference point, broadcast mode is the only supported communication mode, and the operation details are defined in ts 23.285 [8]. for nr based pc5 reference point, the broadcast mode also supports enhanced qos handling as defined in clause 5.4.1. 5.2.1.3 groupcast mode communication over pc5 reference point groupcast mode communication is only supported over nr based pc5 reference point and applies to all types of groups, i.e. application layer connection-less group and application layer managed group. for application layer managed group, the following applies: - if the v2x application layer provides a group size and a member id, the v2x layer passes them to the as layer for groupcast control, as defined in ts 38.300 [11]. note: it is assumed that the v2x application layer provides accurate and up-to-date information on the group size and the member id. qos handling for groupcast mode communication is defined in clause 5.4.1. 5.2.1.4 unicast mode communication over pc5 reference point unicast mode of communication is only supported over nr based pc5 reference point. figure 5.2.1.4-1 illustrates an example of pc5 unicast links. figure 5.2.1.4-1: example of pc5 unicast links the following principles apply when the v2x communication is carried over pc5 unicast link: - a pc5 unicast link between two ues allows v2x communication between one or more pairs of peer v2x services in these ues. all v2x services in the ue using the same pc5 unicast link use the same application layer id. note 1: an application layer id can change in time as described in clauses 5.6.1.1 and 6.3.3.2, due to privacy. this does not cause a re-establishment of a pc5 unicast link. the ue triggers a link identifier update procedure as specified in clause 6.3.3.2. - one pc5 unicast link supports one or more v2x service types) if these v2x service types are at least associated with the pair of peer application layer ids for this pc5 unicast link. for example, as illustrated in figure 5.2.1.4-1, ue a and ue b have two pc5 unicast links, one between peer application layer id 1/ue a and application layer id 2/ue b and one between peer application layer id 3/ue a and application layer id 4/ue b. note 2: a source ue is not required to know whether different target application layer ids over different pc5 unicast links belong to the same target ue. - a pc5 unicast link supports v2x communication using a single network layer protocol e.g. ip or non-ip. - a pc5 unicast link supports per-flow qos model as specified in clause 5.4.1. - if multiple v2x service types use a pc5 unicast link, one pc5 qos flow identified by pfi may be associated with more than one v2x service types. when the application layer in the ue initiates data transfer for a v2x service type which requires unicast mode of communication over pc5 reference point: - the ue shall reuse an existing pc5 unicast link if the pair of peer application layer ids and the network layer protocol of this pc5 unicast link are identical to those required by the application layer in the ue for this v2x service, and modify the existing pc5 unicast link to add this v2x service type as specified in clause 6.3.3.4; otherwise - the ue shall trigger the establishment of a new pc5 unicast link as specified in clause 6.3.3.1. after successful pc5 unicast link establishment, ue a and ue b use the same pair of layer-2 ids for subsequent pc5-s signalling message exchange and v2x service data transmission as specified in clause 5.6.1.4. the v2x layer of the transmitting ue indicates to the as layer whether a transmission is for a pc5-s signalling message (i.e. direct communication request/accept, link identifier update request/response/ack, disconnect request/response, link modification request/accept, keep-alive/ack) or v2x service data. for every pc5 unicast link, a ue self-assigns a distinct pc5 link identifier that uniquely identifies the pc5 unicast link in the ue for the lifetime of the pc5 unicast link. each pc5 unicast link is associated with a unicast link profile which includes: - application layer id and layer-2 id of ue a; and - application layer id and layer-2 id of ue b; and - network layer protocol used on the pc5 unicast link; and - the information about pc5 qos flow(s). for each pc5 qos flow, the pc5 qos context and the pc5 qos rule(s) as defined in clause 5.4.1.1.3. for privacy reason, the application layer ids and layer-2 ids may change as described in clauses 5.6.1.1 and 6.3.3.2 during the lifetime of the pc5 unicast link and, if so, shall be updated in the unicast link profile accordingly. the ue uses pc5 link identifier to indicate the pc5 unicast link to v2x application layer, therefore v2x application layer identifies the corresponding pc5 unicast link even if there are more than one unicast link associated with one v2x service type (e.g. the ue establishes multiple unicast links with multiple ues for a same v2x service type). the unicast link profile shall be updated accordingly after a layer-2 link modification for an established pc5 unicast link as specified in clause 6.3.3.4 or layer-2 link identifier update as specified in clause 6.3.3.2. upon receiving an indication from the as layer that the pc5-rrc connection was released due to rlf, the v2x layer in the ue locally releases the pc5 unicast link associated with this pc5-rrc connection. the as layer uses pc5 link identifier to indicate to the v2x layer the pc5 unicast link whose pc5-rrc connection was released. when the pc5 unicast link has been released as specified in clause 6.3.3.3, the v2x layer of each ue for the pc5 unicast link informs the as layer that the pc5 unicast link has been released. the v2x layer uses pc5 link identifier to indicate the released unicast link. 5.2.1.5 ip address allocation for unicast mode of v2x communication over pc5 reference point, the following mechanism for ip address/prefix allocation may be used: a) ipv6 stateless address auto configuration specified in rfc 4862 [21] for assignment of ipv6 prefix, with one of the two ues acting as ipv6 default router. note 1: which ue acts as an ipv6 default router is negotiated during secure layer-2 link establishment by exchanging the ip address configuration as described in clause 6.3.3.1. b) ipv6 link-local addresses as defined in rfc 4862 [21] are formed by ues locally. the ipv6 link-local addresses are exchanged during the establishment of a secure layer-2 link over pc5 reference point as described in clause 6.3.3.1. the ues shall disable duplicate address detection after the layer-2 link is established. for broadcast and groupcast modes of v2x communication over pc5 reference point, the following source ip address management applies: - the ue configures a link local ipv6 address to be used as the source ip address, as defined in clause 4.5.3 of ts 23.303 [17]. the ue may use this ip address for v2x communication over pc5 reference point without sending neighbour solicitation and neighbour advertisement message for duplicate address detection. note 2: the destination ip address management for broadcast and groupcast modes of v2x communication over pc5 reference point is left to ue implementation. 5.2.2 v2x communication over uu reference point 5.2.2.1 v2x communication via unicast the v2x communication via unicast over the uu reference point supports non-roaming and roaming operations. for transport of v2x messages over uu reference point: - the mechanisms defined in ts 23.501 [6] and ts 23.502 [7] can be used to establish the suitable pdu sessions, and v2x messages are routed towards v2x application server or towards ues with existing unicast routing. 5.2.3 v2x communication over pc5 or uu reference point 5.2.3.1 general v2x communication over pc5 reference point may use different protocols and formats than v2x communication over uu reference point. for a v2x service type that can use pc5 reference points or uu reference point for the transmission of the same v2x messages, the following additional consideration apply for transport of v2x messages over uu reference point: - for transport of non-ip based v2x messages from the application: - ip encapsulation (i.e. ip pdu session type) or unstructured pdu session type is used. - the ue determines which method between ip encapsulation and unstructured pdu session type is used for non-ip based v2x messages based on the ue configuration as described in clause 5.1.3.1. if no such configuration is available, ue can use the method based on the ue implementation. - when ip pdu session type is used for transport of ip based or non-ip based v2x messages: - v2x messages are transported over udp or tcp: - for non-ip based v2x messages from the application, ue may learn from v2x application server or ue may be configured explicitly about a transport layer protocol needs to be used or no restriction imposed by configuration. - for ip based v2x messages from the application, ue uses the transport layer protocol set by the upper layer. - the ue sends a v2x message to a v2x application server address. the destined v2x application server address is derived from the psid or the its-aid and the ue configuration as described in clause 5.1.3.1, and the v2x application server receives the v2x message in a udp/ip packet or a tcp/ip packet on a v2x application server address. - when unstructured pdu session type is used for transport of non-ip based v2x messages: - v2x messages are transported to the v2x application server as defined in clause 5.6.10.3 of ts 23.501 [6]. latency reduction for v2x message transfer via unicast may be achieved by using various mechanisms, including via e.g., edge computing defined in ts 23.501 [6], in clause 5.6.7 \"application function influence on traffic routing\" and clause 5.13 \"support for edge computing\", where the v2x application server acts as an application function. 5.3 v2x application server discovery 5.3.1 general a ue needs to discover the v2x application server(s), when v2x communication over uu operation mode is used. the v2x application server address information may be configured on the ue or provisioned over n1 reference point, as specified in clause 5.1.3.1. when the configuration contains the fqdn(s), the ue shall perform dns to resolve the address(es) of the v2x application server. the ue may use the configured v2x application server information only in the designated geographical area. when the ue changes serving plmn or crosses configured geographic areas, it should perform address resolution again. note: when the v2x application server is notified by smf indicating the dnai change, as specified in clause 5.6.7 of ts 23.501 [6], the application layer can trigger the ue to perform dns to resolve the address(es) of the v2x application server. 5.3.2 multiple v2x application server and localized v2x application server discovery and routing multiple v2x application servers may be involved in the v2x communication, each providing particular v2x services and/or serving a particular geographical region. therefore, the v2x application server address information as specified in clause 5.1.3.1 can contain multiple servers' information. when multiple v2x application servers are configured, the application layer will choose the proper v2x application server to use. when localized v2x application servers are deployed, anycast may be used to conceal the server change from the ue. in this case, a fqdn is configured for a large region, e.g. the entire plmn, and the ue only needs to resolve it once to an anycast address. the upf is responsible for routing the traffic to the appropriate local v2x application servers based on anycast address. 5.4 qos handling for v2x communication 5.4.1 qos handling for v2x communication over pc5 reference point 5.4.1.1 qos model 5.4.1.1.1 general overview for lte based pc5, the qos handling is defined in ts 23.285 [8], based on prose per-packet priority (pppp) and prose per-packet reliability (pppr). for nr based pc5, a qos model similar to that defined in ts 23.501 [6] for uu reference point is used, i.e. based on 5qis, with additional parameter of range as described in clauses 5.4.2, 5.4.3 and 5.4.4. for the v2x communication over nr based pc5 reference point, a pc5 qos flow is associated with a pc5 qos rule and the pc5 qos parameters as defined in clause 5.4.2. a set of standardized pc5 5qis (pqi) are defined in clause 5.4.4. the ue may be configured with a set of default pc5 qos parameters to use for the v2x service types, as defined in clause 5.1.2.1. for nr based unicast, groupcast and broadcast mode communication over pc5, per-flow qos model for pc5 qos management shall be applied. figure 5.4.1.1.1-1 illustrates an example mapping of per-flow qos model for nr pc5. details of pc5 qos rules and pfi related operations are described in clauses 5.4.1.1.2 and 5.4.1.1.3. figure 5.4.1.1.1-1: per-flow pc5 qos model for nr pc5 the following principles apply when the v2x communication is carried over pc5 reference point: - application layer may set the v2x application requirements for the v2x communication, using either ts 23.285 [8] defined pppp and pppr model or the pqi and range model as described in clause 5.4.4. depending on the type of pc5 reference point, i.e. lte based or nr based, selected for the transmission, the ue may map the application layer provided v2x application requirements to the suitable qos parameters to be passed to the lower layer. the mapping between the two qos models is defined in clause 5.4.2. for v2x communication over nr based pc5, different v2x packets may require different qos treatments. in that case, the v2x packets shall be sent from the v2x layer to the access stratum layer within pc5 qos flows identified by different pfis. - when groupcast mode of v2x communication over nr based pc5 is used, a range parameter is associated with the qos parameters for the v2x communication. the range may be provided by v2x application layer or use a default value mapped from the v2x service type based on configuration as defined in clause 5.1.2.1. the range indicates the minimum distance that the qos parameters need to be fulfilled. the range parameter is passed to as layer together with the qos parameters for dynamic control. - nr based pc5 supports three communication modes, i.e. broadcast, groupcast, and unicast. the qos handling of these different modes are described in clauses 5.4.1.2 to 5.4.1.4. - the ue may handle traffic using broadcast, groupcast, and unicast mode communication by taking all their priorities, e.g. indicated by pqis, into account as described in clause 5.4.3.3. - for broadcast and groupcast modes of v2x communication over nr based pc5, standardized pqi values are applied by the ue, as there is no signalling over pc5 reference point for these cases. - when network scheduled operation mode is used, the ue-pc5-ambr for nr based pc5 applies to all types of communication modes, and is used by ng-ran for capping the ue's nr based pc5 transmission in the resources management. the ue-pc5-ambr shall be set to the sum of the aggregate maximum bit rate of all types of communication (i.e. unicast, groupcast and broadcast modes) over pc5 reference point. 5.4.1.1.2 deriving pc5 qos parameters and assigning pfi for pc5 qos flow the following description applies to for both network scheduled operation mode and ue autonomous resources selection mode. when a service data packet or request from the v2x application layer is received, the ue determines if there is any existing pc5 qos flow matching the service data packet or request, i.e. based on the pc5 qos rules for the existing pc5 qos flow(s). if there is no pc5 qos flow matching the service data packet or request, the ue derives pc5 qos parameters defined in clause 5.4.2 as below: - if the application layer provides the v2x application requirements for the v2x service type (e.g. priority requirement, reliability requirement, delay requirement, range requirement), the v2x layer determines the pc5 qos parameters based on the v2x application requirements; - otherwise, the v2x layer determines the pc5 qos parameters based on the mapping of the v2x service type to pc5 qos parameters defined in clause 5.1.2.1. note 1: details of v2x application requirements for the v2x service type is up to implementation and out of scope of this specification. after deriving the pc5 qos parameters, the ue performs the following: - if there is no existing pc5 qos flow that fulfils the derived pc5 qos parameters: - the ue creates a new pc5 qos flow for the derived pc5 qos parameters; and - the ue then assigns a pfi and derives pc5 qos rule for this pc5 qos flow. - otherwise, the ue updates the pc5 packet filter set in the pc5 qos rule for such pc5 qos flow. note 2: it is expected that the application layer is capable of differentiating traffic from different v2x services that is transported within the same pc5 qos flow. for v2x communication over nr pc5 reference point, the pc5 qos flow is the finest granularity of qos differentiation in the same destination identified by destination layer-2 id. user plane traffic with the same pfi receives the same traffic forwarding treatment (e.g. scheduling, admission threshold). the pfi is unique within a same destination. 5.4.1.1.3 handling of pc5 qos flows based on pc5 qos rules for each communication mode (e.g. broadcast, groupcast, unicast), the ue maintains the pc5 qos context and pc5 qos rule(s) for each pc5 qos flow identified by a pc5 qos flow identifier (pfi) per destination identified by destination layer-2 id. the following information is maintained in the v2x layer of the ue: - a pc5 qos context includes the following information: - pfi; - pc5 qos parameters (i.e. pqi and conditionally other parameters such as mfbr/gfbr, range, etc.) as defined in clause 5.4.2; and - the v2x service type(s). - one or more pc5 qos rule(s). each pc5 qos rule contains the following information: - pfi; - a pc5 packet filter set as defined in clause 5.4.1.1.4; and - a precedence value. the precedence value determines the order in which the pc5 qos rules are evaluated. the pc5 qos rule with lower precedence value is evaluated before those with the higher precedence values. note: how to set the precedence value is up to ue implementation. when the ue assigns a new pfi for v2x service type, the ue stores it with the corresponding pc5 qos context and pc5 qos rule(s) for the destination. when the ue releases the pfi, the ue removes the corresponding pc5 qos context and pc5 qos rule(s) for the destination. for unicast, the unicast link profile defined in clause 5.2.1.4 contains additional information mapped from pfi for unicast operation. the v2x layer provides information for pc5 qos operations per destination (e.g. identified by destination layer-2 id) to as layer for per-flow qos model operations as below: 1) to add a new pc5 qos flow or to modify any existing pc5 qos flow, the v2x layer provides the following information for the pc5 qos flow to as layer. - the pfi; - the corresponding pc5 qos parameters; and - source/destination layer-2 ids for broadcast and groupcast mode communication, or the pc5 link identifier for unicast. 2) to remove any existing pc5 qos flow, the v2x layer provides the following information for the pc5 qos flow to as layer. - the pfi; and - source/destination layer-2 ids for broadcast and groupcast mode communication, or the pc5 link identifier for unicast. in addition, the v2x layer also provides the communication mode (e.g. broadcast, groupcast, unicast), radio frequencies, tx profile to the as layer for the pc5 operation. the radio frequencies and tx profile are determined based on the v2x service type. the v2x layer ensures that v2x service types associated with different radio frequencies are classified into distinct pc5 qos flows. figure 5.4.1.1.3-1 illustrated an example of the classification and marking of user plane traffic using the pc5 qos rules, and the mapping of pc5 qos flows to radio resources at access stratum layer. figure 5.4.1.1.3-1: handling of pc5 qos flows based on pc5 qos rules as illustrated in figure 5.4.1.1.3-1, for a given pair of source and destination layer-2 ids, there can be multiple radio bearers, each corresponding to a different pc5 qos level. the as layer can determine the mapping of multiple pc5 qos flows to the same radio bearer based on the information provided. for broadcast and groupcast mode communication, the l2 link goes to all ues in proximity identified by the destination layer-2 id. 5.4.1.1.4 pc5 packet filter set pc5 packet filter set supports two types of packet filters, i.e. the v2x ip packet filter set and the v2x packet filter set. a pc5 qos rule contains either the v2x ip packet filter set or the v2x packet filter set. the v2x ip packet filter set has the same format as the ip packet filter set defined in ts 23.501 [6] clause 5.7.6.2. the v2x packet filter set shall support packet filters based on at least any combination of: - v2x service type; - source/destination layer-2 id; - application layer id (e.g. station id). 5.4.1.2 qos handling for broadcast mode v2x communication over pc5 reference point when pc5 broadcast is used for the transmission of v2x service data, the following principles are followed for both network scheduled operation mode and ue autonomous resources selection mode: - pc5 qos parameters defined in clause 5.4.2 are applied. - the v2x layer determines the pc5 qos parameters based on the v2x application requirements (if available) or the mapping of the v2x service type to pc5 qos parameters, as defined in clause 5.4.1.1.2. - the v2x layer assigns a pc5 qos flow identifier (pfi) and derives the pc5 qos rule for the pc5 qos flow, and associates the pc5 qos parameters to the pfi. - the v2x layer provides the pfi and the associated pc5 qos parameters to as layer for per-flow qos model operations. - the v2x layer determines the pfi based on the pc5 qos rule for the v2x service data from the v2x application layer, and passes the v2x service data along with pfi to the as layer for transmission. when the autonomous resources selection mode is used, following additional principle applies: - the ue can use the pc5 qos parameters for pc5 qos handling. when the network scheduled operation mode for nr pc5 is used, the following additional principles apply: - the ue provides pc5 qos information (related to pc5 qos parameters), destination layer-2 id(s) and communication mode to the ng-ran and ng-ran may provide as layer configurations and configure the mapping of pc5 qos flow to radio bearer as defined in ts 38.331 [15] and ts 36.331 [14]. - the ue provides pc5 qos information (related to pc5 qos parameters) and destination information (related to destination layer-2 id(s)) to the ng-ran for resource request as defined in ts 38.331 [15] and ts 36.331 [14]. - the ng-ran authorizes the ue-provided pc5 qos information based on pcf-provisioned pc5 qos parameters as defined in clause 6.5.7. - the ng-ran uses ue-pc5-ambr for capping the ue pc5 transmission in the resources management. 5.4.1.3 qos handling for groupcast mode v2x communication over pc5 reference point the qos handling described in clause 5.4.1.2 is applied. 5.4.1.4 qos handling for unicast mode v2x communication over pc5 reference point the qos handling described in clause 5.4.1.2 is applied with the following additions: - the pfi and pc5 qos parameters are negotiated during the layer-2 link establishment procedure, as described in clause 6.3.3.1, or during the layer-2 link modification procedure, as described in clause 6.3.3.4. when the network scheduled operation mode for nr pc5 is used, following additional principle applies: - ng-ran uses the pc5 link-ambr for capping the ue pc5 unicast link transmission in the resources management. 5.4.2 pc5 qos parameters 5.4.2.1 pqi a pqi is a special 5qi, as defined in clause 5.7.2.1 of ts 23.501 [6], and is used as a reference to pc5 qos characteristics defined in clause 5.4.3, i.e. parameters that control qos forwarding treatment for the packets over pc5 reference point. standardized pqi values have one-to-one mapping to a standardized combination of pc5 qos characteristics as specified in table 5.4.4-1. 5.4.2.2 pc5 flow bit rates for gbr qos flows only, the following additional pc5 qos parameters exist: - guaranteed flow bit rate (gfbr); - maximum flow bit rate (mfbr). the gfbr and mfbr as defined in clause 5.7.2.5 of ts 23.501 [6] are used for bit rate control on pc5 reference point over the averaging time window. for pc5 communication, the same gfbr and mfbr are used for both directions. 5.4.2.3 pc5 link aggregated bit rates a pc5 unicast link is associated with the following aggregate rate limit qos parameter: - per link aggregate maximum bit rate (pc5 link-ambr). the pc5 link-ambr limits the aggregate bit rate that can be expected to be provided across all non-gbr qos flows with a peer ue over pc5 unicast link. the pc5 link-ambr is measured over an ambr averaging window which is a standardized value. the pc5 link-ambr is not applicable to gbr qos flows. pc5 link-ambr is applied to one pc5 unicast link, which means aggregate bit rate of one pc5 unicast link should not exceed pc5 link-ambr. note: the ambr averaging window is only applied to pc5 link-ambr measurement. 5.4.2.4 range the range value indicates the applicability of the pc5 qos parameters in pc5 communication, i.e. when the receiving ues are not within the range specified distance from the transmitting ue, the communication is best effort. lower layer (phy/mac layer) may use the range to determine the corresponding packet handling, e.g. harq as defined in ts 38.300 [11], to achieve the qos guarantee indicated by pc5 qos parameters. range is in the unit of meters. the ue is configured with the maximum range value it can use for a particular v2x service. a v2x service may request a different range value, and the v2x layer ensures that it does not exceed the maximum range value. range is only used for groupcast mode communication over pc5 reference point. 5.4.2.5 default values a ue may be configured with default values for pc5 qos parameters for a particular service, e.g. identified by psid/its-aid. the default value will be used if the corresponding pc5 qos parameter is not provided by upper layer. 5.4.3 pc5 qos characteristics 5.4.3.1 general this clause specifies the pc5 qos characteristics associated with pqi. the following characteristics defined in ts 23.501 [6] applies, with differences explained in following clauses: 1 resource type (gbr, delay critical gbr or non-gbr); 2 priority level; 3 packet delay budget; 4 packet error rate; 5 averaging window (for gbr and delay-critical gbr resource type only); 6 maximum data burst volume (for delay-critical gbr resource type only). standardized or pre-configured pc5 qos characteristics, are indicated through the pqi value. v2x layer may derive non-standardized pc5 qos characteristics by overriding the standardized or pre-configured value of pc5 qos characteristics based on v2x application requirements from v2x application layer and provide the whole set of non-standardized pc5 qos characteristics to as layer. note: non-standardized pc5 qos characteristics only applies to ue autonomous resources selection mode. 5.4.3.2 resource type resource type is defined in clause 5.7.3.2 of ts 23.501 [6]. 5.4.3.3 priority level the priority level for nr pc5 has the same format and meaning as the priority value of the prose per-packet priority (pppp) for lte pc5 defined in ts 23.285 [8]. for lte pc5, the pppp value also reflects the latency requirement and the pdb derivation is according to ts 23.285 [8], i.e. the low pdb is mapped to the high priority pppp value. on the other hand, for nr pc5, the pdb is derived from the pqi table as defined in clause 5.4.4. note: using the same format for priority level and pppp provides better backward compatibility. the priority level shall be used to different treatment of v2x service data across different modes of communication, i.e. broadcast, groupcast, and unicast. in the case when all qos requirements cannot be fulfilled for all the pc5 service data associated with that pc5 reference point, the priority level shall be used to select for which pc5 service data the qos requirements are prioritized such that a pc5 service data packet with priority level value n is prioritized over a pc5 service data packet with higher priority level values, i.e. n+1, n+2, etc. (lower number meaning higher priority). 5.4.3.4 packet delay budget the packet delay budget (pdb) associated with the pqi is equivalent to the pdb defined in clause 5.7.3.4 of ts 23.501 [6]. however, when used for pc5 communication, the pdb associated with the pqi defines an upper bound for the time that a packet may be delayed between sending ue and receiving ue(s) over pc5 reference point. 5.4.3.5 packet error rate the packet error rate (per) is defined in clause 5.7.3.5 of ts 23.501 [6]. 5.4.3.6 averaging window the averaging window is defined in clause 5.7.3.6 of ts 23.501 [6]. 5.4.3.7 maximum data burst volume maximum data burst volume (mdbv) is defined in clause 5.7.3.7 of ts 23.501 [6]. mdbv denotes the largest amount of data that the pc5 reference point is required to serve within a period of pdb of the pqi. the mdbv may also be indicated by upper layer, it shall be used instead of the default value. 5.4.4 standardized pqi to qos characteristics mapping the one-to-one mapping of standardized pqi values to pc5 qos characteristics is specified in table 5.4.4-1. table 5.4.4-1: standardized pqi to qos characteristics mapping note 1: for standardized pqi to qos characteristics mapping, the table will be extended/updated to support service requirements for other identified v2x services. note 2: the pqis may be used for other services than v2x. note 3: a pqi may be used together with an application indicated priority, which overrides the default priority level of the pqi. 5.4.5 qos handling for v2x communication over uu reference point 5.4.5.1 general the v2x service data can be delivered via non-gbr qos flow as well as gbr qos flow (i.e. using the gbr resource type or the delay-critical gbr resource type) as specified in ts 23.501 [6]. 5.4.5.2 notification on qos sustainability analytics to the v2x application server 5.4.5.2.1 general a v2x application server may request notifications on qos sustainability analytics for an indicated geographic area and time interval in order to adjust the application behaviour in advance with potential qos change. the v2x application server may also request past statistical information for the purposes of adjustment of the application, how v2x application server makes use of such data is outside of 3gpp scope. clause 6.4.1 describes the procedure for such notification from 5gs. 5.4.5.2.2 functional description the potential qos change to assist application adjustment is based on the notification of qos sustainability analytics defined in clause 6.9 of ts 23.288 [20]. the v2x application server acting as an application function communicates with the nef which corresponds to the nf consumer in clause 6.9.4 of ts 23.288 [20]. the v2x application server can either subscribe to notifications from the nef (i.e., a subscribe-notify model) or request a single notification from the nef (i.e. a request-response model). the v2x application server request contains the following parameters: - analytics id = \"qos sustainability\"; - target of analytics reporting: \"any ue\"; - analytics filter information: - optional maximum number of objects; - qos requirements: - 5qi (standardized or pre-configured), and applicable additional qos parameters and the corresponding values (conditional, i.e., it is needed for gbr 5qis to know the gfbr); or - the qos characteristics attributes including resource type, pdb and per and their values; note: the v2x application server could provide the 5qis as input based on sla with the operator which authorizes the v2x application server to use certain 5qis and to use the qos sustainability analytics only for them. - location information (the details are specified in ts 23.288 [20] clause 6.9.1); - s-nssai (optional, if available in the v2x application server). - analytics target period (the details are specified in ts 23.288 [20] clause 6.9.1); - reporting threshold(s) (the details are specified in ts 23.288 [20] clause 6.9.1); - in a subscription, the notification correlation id and the notification target address. 5.4.5.3 qos change based on extended ng-ran notification to support alternative service requirements to support v2x applications that can operate with different configurations (e.g. different bitrates or delay requirements), the v2x application server (v2x as), acting as the application function, can provide, in addition to the requested level of service requirements, alternative service requirements to the 5gs. this enables the 5gs to act on the alternative service requirements and apply them for the extended ng-ran notification, as described in ts 23.501 [6] and ts 23.503 [16]. the v2x as can use the related procedures specified in clause 4.15.6.6 of ts 23.502 [7] to influence the qos provided to the v2x service. if so, the v2x as includes alternative service requirements as specified in clause 6.1.3.22 of ts 23.503 [16] when providing service information to the pcf. the qos change based on extended ng-ran notification operates within the 5gs qos model as specified in ts 23.501 [6] and ts 23.503 [16]. 5.5 subscription to v2x services the user's profile in the udm contains the subscription information to give the user permission to use v2x services. at any time, the operator can remove the ue subscription rights for v2x services from user's profile in the udm, and revoke the user's permission to use v2x services. the following subscription information is defined for v2x services: a) whether the ue is authorized to perform v2x communication over pc5 reference point as vehicle ue, pedestrian ue, or both, including for lte pc5 and for nr pc5. b) ue-pc5-ambr per pc5 rat, including ue-pc5-ambr for lte pc5 and ue-pc5-ambr for nr pc5. c) the list of the plmns where the ue is authorized to perform v2x communication over pc5 reference point. for each plmn in the list, the rat(s) over which the ue is authorized to perform v2x communications over pc5 reference point. d) pc5 qos parameters as defined in clause 5.4.2 used by ng-ran. the udm may retrieve a) and b) from the udr. a) and b) are provided by the udm to the amf during ue registration procedure as defined in clause 4.2.2.2 of ts 23.502 [7] using nudm_sdm service for subscription data type \"v2x subscription data\" and the amf provides a) and b) to ng-ran as part of the ue context information. c) and d) are provided by the udr to the pcf during the ue policy association establishment procedure as defined in clause 4.16.11 of ts 23.502 [7] and ue policy association modification procedure as defined in clause 4.16.12 of ts 23.502 [7] using nudr service for data set \"policy data\" and data subset \"policy set entry\". if the subscription information provided to the pcf from udr is changed (e.g., pc5 qos related parameters, the list of plmns where the ue is authorized to perform v2x communication over pc5 reference point), the pcf initiates the ue configuration update procedure as specified in clause 6.2.2. 5.6 identifiers 5.6.1 identifiers for v2x communication over pc5 reference point 5.6.1.1 general each ue has one or more layer-2 ids for v2x communication over pc5 reference point, consisting of: - source layer-2 id(s); and - destination layer-2 id(s). source and destination layer-2 ids are included in layer-2 frames sent on the layer-2 link of the pc5 reference point identifying the layer-2 source and destination of these frames. source layer-2 ids are always self-assigned by the ue originating the corresponding layer-2 frames. the selection of the source and destination layer-2 id(s) by a ue depends on the communication mode of v2x communication over pc5 reference point for this layer-2 link, as described in clauses 5.6.1.2, 5.6.1.3, and 5.6.1.4. the source layer-2 ids may differ between different communication modes. when ip-based v2x communication is supported for broadcast and groupcast modes of v2x communication over pc5 reference point, the source ip address is allocated as described in clause 5.2.1.5. if the ue has an active v2x application that requires privacy support in the current geographical area, as identified by configuration described in clause 5.1.2.1, in order to ensure that a source ue (e.g. vehicle) cannot be tracked or identified by any other ues (e.g. vehicles) beyond a certain short time-period required by the application, the source layer-2 id shall be changed over time and shall be randomized. for ip-based v2x communication over pc5 reference point, the source ip address shall also be changed over time and shall be randomized. the change of the identifiers of a source ue must be synchronized across layers used for pc5, (e.g. when the application layer id changes, the source layer-2 id and the source ip address need to be changed). 5.6.1.2 identifiers for broadcast mode v2x communication over pc5 reference point for broadcast mode of v2x communication over pc5 reference point, the ue is configured with the destination layer-2 id(s) to be used for v2x services. the destination layer-2 id for a v2x communication is selected based on the configuration as described in clause 5.1.2.1. the ue self-selects a source layer-2 id. the ue may use different source layer-2 ids for different types of pc5 reference points, i.e. lte based pc5 and nr based pc5. 5.6.1.3 identifiers for groupcast mode v2x communication over pc5 reference point for groupcast mode of v2x communication over pc5 reference point, the v2x application layer may provide group identifier information. when the group identifier information is provided by the v2x application layer, the ue converts the provided group identifier into a destination layer-2 id. when the group identifier information is not provided by the v2x application layer, the ue determines the destination layer-2 id based on configuration of the mapping between v2x service type and layer-2 id, as specified in clause 5.1.2.1. note: the mechanism for converting the v2x application layer provided group identifier to the destination layer-2 id is defined in stage 3. the ue self-selects a source layer-2 id. 5.6.1.4 identifiers for unicast mode v2x communication over pc5 reference point for unicast mode of v2x communication over pc5 reference point, the destination layer-2 id used depends on the communication peer. the layer-2 id of the communication peer, identified by the application layer id, may be discovered during the establishment of the pc5 unicast link, or known to the ue via prior v2x communications, e.g. existing or prior unicast link to the same application layer id, or obtained from application layer service announcements. the initial signalling for the establishment of the pc5 unicast link may use the known layer-2 id of the communication peer, or a default destination layer-2 id associated with the v2x service type configured for pc5 unicast link establishment, as specified in clause 5.1.2.1. during the pc5 unicast link establishment procedure, layer-2 ids are exchanged, and should be used for future communication between the two ues, as specified in clause 6.3.3.1. the application layer id is associated with one or more v2x applications within the ue. if ue has more than one application layer ids, each application layer id of the same ue may be seen as different ue's application layer id from the peer ue's perspective. the ue maintains a mapping between the application layer ids and the source layer-2 ids used for the pc5 unicast links, as the v2x application layer does not use the layer-2 ids. this allows the change of source layer-2 id without interrupting the v2x applications. when application layer ids change, the source layer-2 id(s) of the pc5 unicast link(s) shall be changed if the link(s) was used for v2x communication with the changed application layer ids. based on privacy configuration as specified in clause 5.1.2.1, the update of the new identifiers of a source ue to the peer ue for the established unicast link may cause the peer ue to change its layer-2 id and optionally ip address/prefix if ip communication is used as defined in clause 6.3.3.2. a ue may establish multiple pc5 unicast links with a peer ue and use the same or different source layer-2 ids for these pc5 unicast links. 5.7 support for v2x communication for ues in limited service state for ue in limited service state, as defined in ts 23.122 [13], v2x communication is only allowed over pc5 reference point. ues that are authorized to use v2x communication over pc5 reference point shall be able to use v2x communication over pc5 reference point when in limited service state following the principles defined in clause 5.1.2.2 for v2x communication over pc5 reference point when the ue enters in limited service state in 5gs: - because ue cannot find a suitable cell of the selected plmn as described in ts 23.122 [13]; or - as the result of receiving one of the following reject reasons defined in ts 23.122 [13]: - a \"plmn not allowed\" response to a registration request or; - a \"5gs services not allowed\" response to a registration request or service request. a ue in limited service state shall only use the radio resources and procedure available in cm-idle mode for v2x communication over pc5 reference point, for details see ts 36.300 [9] and ts 38.300 [11]. ues shall not use v2x communication over pc5 reference point using the \"operator-managed\" radio resources, as specified in clause 5.1.2.1, if the ue has entered in limited service state due to all other situations (e.g. no sim in the ms, an \"illegal ms\" or \"illegal me\" response to a registration request, or an \"imsi unknown in hlr\" response to a registration request) defined in ts 23.122 [13], where the ue is unable to obtain normal service from a plmn. the ues may use v2x communication over pc5 reference point using the \"non-operator-managed\" radio resources, as specified in clause 5.1.2.1, according to the principles defined in clause 5.1.2.2. 5.8 interworking between eps v2x and 5gs v2x 5.8.1 v2x policy and parameter provisioning when the ue is in 5gs or eps, the ue shall use the valid v2x policy and parameters provisioned by the pcf in 5gc or by the v2x control function in epc for v2x communication. the v2x related parameters for eps defined in ts 23.285 [8] can be either provided by the pcf or by the v2x control function, while the v2x policy and parameters involving 5gs are provided by the pcf only. if the ue does not have valid v2x policy and parameters, the ue shall request the network to provision the v2x policy and parameters. 5.8.2 pc5 operation pc5 communication can be supported with proper ue configurations by taking into account e.g. regional regulations, deployments, and ue support for lte pc5 and/or nr pc5 rats. v2x communication over nr pc5 reference point in network scheduled operation mode is supported in eps (i.e. en-dc architecture defined in ts 37.340 [25]) as defined in ts 23.285 [8] and ts 36.331 [14]. 5.8.3 mobility between eps and 5gs over uu interworking specified in clause 5.17 of ts 23.501 [6] and clause 4.11 of ts 23.502 [7] is applied to mobility between eps and 5gs over uu reference point with the following additions: - for n26 based handover, v2x related data including the \"v2x services authorized\" indication per pc5 rat, ue-pc5-ambr per pc5 rat, and pc5 qos parameters are transferred between amf and mme, and are included in handover request message sent to the target ran node. any unstructured type pdu session established in 5gc based on the ue configuration as described in clause 5.1.3.1 is allowed to be transferred to epc as non-ip pdn connection when non-ip pdn type is supported by ue and epc as specified in clause 5.17.2.1 of ts 23.501 [6]. 6 functional description and information flows 6.1 control and user plane stacks 6.1.1 user plane for nr pc5 reference point supporting v2x services figure 6.1.1-1 depicts a user plane for nr pc5 reference point, i.e. pc5 user plane protocol stack. legend: - pc5-u: the sdap/pdcp/rlc/mac/phy functionality is specified in ts 38.300 [11]. - for pdcp sdu type \"non-ip\", a \"non-ip type\" header included in the sdu by upper layer to indicate the type of non-ip messages carried will be specified in stage 3 specification. figure 6.1.1-1: user plane for nr pc5 reference point ip and non-ip pdcp sdu types are supported for the v2x communication over pc5 reference point. for ip pdcp sdu type, only ipv6 is supported. the ip address allocation and configuration are as defined in clause 5.6.1.1. the non-ip pdcp sdu contains a non-ip type header, which indicates the v2x message family used by the application layer, e.g. ieee 1609 family's wsmp [18], iso defined fntp [19], ccsa defined dsmp [27]. note: the non-ip type header and allowed values are defined in ts 24.587 [24]. the packets from v2x application layer are handled by the v2x layer before transmitting them to the as layer, e.g. v2x layer maps the ip/non ip packets to pc5 qos flow and marks the corresponding pfi. 6.1.2 control plane for nr pc5 reference point supporting v2x services figure 6.1.2-1 depicts a control plane for nr pc5 reference point, i.e. pc5 signalling protocol stack. legend: - pc5-s protocol: the protocol used for the control plane signalling over the pc5 reference point for the secure layer-2 link as specified in clause 6.3.3. - the pdcp/rlc/mac/phy functionality is specified in ts 38.300 [11]. figure 6.1.2-1: control plane for nr pc5 reference point 6.2 procedures for service authorization and provisioning to ue 6.2.1 general the procedures for service authorization and provisioning to ue may be initiated by the pcf (as described in clause 6.2.2), by the ue (as described in clause 6.2.4), or by the af (as described in clause 6.2.5). 6.2.2 pcf based service authorization and provisioning to ue for pcf based service authorization and provisioning to ue, the registration procedures as defined in clause 4.2.2.2 of ts 23.502 [7], ue policy association establishment procedure as defined in clause 4.16.11 of ts 23.502 [7] and ue policy association modification procedure as defined in clause 4.16.12 of ts 23.502 [7] apply with the following additions: - if the ue indicates v2x capability in the registration request message and if the ue is authorized to use v2x service based on subscription data, the amf selects the pcf which supports v2x policy/parameter provisioning as described in clause 6.2.3 and establishes a ue policy association with the pcf for v2x policy/parameter delivery. - if the amf receives the pc5 capability for v2x in the registration request message from ue, the amf further reports the pc5 capability for v2x to the selected pcf. the pcf may determine the v2x policy/parameter for specific pc5 rat based on the received ue's pc5 capability for v2x. - if the ue supports v2x communication and it does not have valid v2x policy/parameters, the ue includes the ue policy container with indicating the v2x policy provisioning request during registration procedure. - if the ue indicates the v2x policy provisioning request in the ue policy container, the pcf determines whether to provision v2x policy/parameters for v2x communication over pc5 reference point and/or v2x communication over uu reference point to the ue, as specified in clause 6.1.2.2.2 of ts 23.503 [16], and the pcf provides the v2x policy/parameters to the ue by using the procedure as defined in clause 4.2.4.3 \"ue configuration update procedure for transparent ue policy delivery\" in ts 23.502 [7]. the pcf may update the v2x policy/parameters to the ue in following conditions: - ue mobility, e.g. ue moves from one plmn to another plmn. this is achieved by using the procedure of ue policy association modification initiated by the amf, as defined in clause 4.16.12.1 of ts 23.502 [7]. - when there is a subscription change in the list of plmns where the ue is authorized to perform v2x communication over pc5 reference point. this is achieved by using ue policy association modification initiated by the pcf procedure as defined in clause 4.16.12.2 of ts 23.502 [7]. - when there is a change of service specific parameter as described in clause 4.15.6.7 of ts 23.502 [7]. if the serving plmn is removed from the list of plmns in the service authorization parameters, the service authorization is revoked in the ue. when the ue is roaming, the change of subscription resulting in updates of the service authorization parameters are transferred to the ue by h-pcf via v-pcf. the ue may perform ue triggered policy provisioning procedure to the pcf as specified in clause 6.2.4 when the ue determines the v2x policy/parameter is invalid (e.g. policy/parameter is outdated, missing or invalid). 6.2.3 pcf discovery pcf discovery and selection mechanism defined in clause 6.3.7.1 of ts 23.501 [6] applies with the following addition to enable a pcf instance is selected for v2x service and for ue: - based on the indication from the ue and/or ue subscription data during the registration procedure as specified in clause 6.2.2, the amf may include the v2x capability indication in the nnrf_nfdiscovery_request message as the optional input parameter. if provided, the nrf takes the information into account for discovering the pcf instance. 6.2.4 procedure for ue triggered v2x policy provisioning the ue triggered policy provisioning procedure is initiated by the ue to request v2x policy/parameter from the pcf when ue determines the v2x policy/parameter is invalid in the following cases: - if the validity timer indicated in the v2x policy/parameter expires; - if there are no valid parameters, e.g. for the v2x service type a ue wants to use, for current area, or due to abnormal situation. figure 6.2.4-1: ue triggered v2x policy provisioning procedure 1. the ue sends the ue policy provisioning request including the ue policy container (v2x policy provisioning request) to the amf. 2. the amf sends the npcf_uepolicycontrol_update request to the pcf including the ue policy container received from ue. 3. the ue policy delivery procedure defined in clause 4.2.4.3 of ts 23.502 [7] is triggered. 6.2.5 af-based service parameter provisioning for v2x communications over control plane the v2x application server can provision the 5gc with v2x service parameters via nef as depicted in clause 4.2.2. for v2x service parameter provisioning, the procedure defined in clause 4.15.6.7 of ts 23.502 [7] is performed with the following considerations: - the af in ts 23.502 [7] is considered as v2x application server in this specification. - service description indicates v2x service domain information. - service parameters include policy/provisioning parameters for v2x communications over uu and pc5. the detailed information on the parameters is described in clause 5.1. note: it is assumed that the v2x service domain information is set based on the service level agreement with the operator. 6.3 procedures for v2x communication over pc5 reference point 6.3.1 broadcast mode v2x communication over pc5 reference point to perform v2x communication over pc5 reference point in broadcast mode operation, the ue is configured with the related information as described in clause 5.1.2. figure 6.3.1-1 shows the procedure for broadcast mode of v2x communication over pc5 reference point. figure 6.3.1-1: procedure for broadcast mode of v2x communication over pc5 reference point 1. the receiving ue(s) determine the destination layer-2 id for broadcast reception as specified in clause 5.6.1.2. the destination layer-2 id is passed down to the as layer of receiving ue(s) for the reception. 2. the transmitting ue v2x application layer provides data unit and may provide v2x application requirements specified in clause 5.4.1.2 to v2x layer. 3. the transmitting ue determines the destination layer-2 id for broadcast as specified in clause 5.6.1.2. the transmitting ue self-assigns the source layer-2 id as specified in clause 5.6.1.1. the transmitting ue determines the pc5 qos parameters for this broadcast v2x service as specified in clauses 5.4.1.1 and 5.4.1.2. 4. the transmitting ue sends the v2x service data using the source layer-2 id and the destination layer-2 id. note: in step 4, there is only one broadcast message from the transmitting ue. 6.3.2 groupcast mode v2x communication over pc5 reference point to perform groupcast mode of v2x communication over pc5 reference point, the ue is configured with the related information as described in clause 5.1.2.1. figure 6.3.2-1 shows the procedure for groupcast mode of v2x communication over pc5 reference point. figure 6.3.2-1: procedure for groupcast mode of v2x communication over pc5 reference point 1. v2x group management is carried out by the v2x application layer and is out of scope of this specification. 2. the v2x application layer may provide group identifier information (i.e. an application-layer v2x group identifier) as specified in clause 5.6.1.3. the v2x application layer may provide v2x application requirements for this communication. if the v2x application layer does not provide v2x application requirements, the v2x layer determines the pc5 qos parameters based on the mapping of v2x service type to pc5 qos parameters as defined in clause 5.1.2.1. the v2x application layer may provide a group size and a member id as specified in clause 5.2.1.3. 3. transmitting ue determines a source layer-2 id and a destination layer-2 id and receiving ue(s) determine destination layer-2 id, as specified in clauses 5.6.1.1 and 5.6.1.3. the destination layer-2 id is passed down to the as layer of receiving ue(s) for the groupcast mode communication reception. transmitting ue determines the pc5 qos parameters for this groupcast mode communication as specified in clauses 5.4.1.1 and 5.4.1.3. if the group size and the member id for application layer managed group are provided by the v2x application layer, the v2x layer passes them to the as layer as described in clause 5.2.1.3. 4. transmitting ue has a v2x service associated with this groupcast mode communication. transmitting ue sends the v2x service data using the source layer-2 id and the destination layer-2 id. note: in step 4, there is only one groupcast message from the transmitting ue. 6.3.3 unicast mode v2x communication over pc5 reference point 6.3.3.1 layer-2 link establishment over pc5 reference point to perform unicast mode of v2x communication over pc5 reference point, the ue is configured with the related information as described in clause 5.1.2.1. figure 6.3.3.1-1 shows the layer-2 link establishment procedure for unicast mode of v2x communication over pc5 reference point. figure 6.3.3.1-1: layer-2 link establishment procedure 1. the ue(s) determine the destination layer-2 id for signalling reception for pc5 unicast link establishment as specified in clause 5.6.1.4. the destination layer-2 id is configured with the ue(s) as specified in clause 5.1.2.1. 2. the v2x application layer in ue-1 provides application information for pc5 unicast communication. the application information includes the v2x service type(s) and the initiating ue's application layer id. the target ue's application layer id may be included in the application information. the v2x application layer in ue-1 may provide v2x application requirements for this unicast communication. ue-1 determines the pc5 qos parameters and pfi as specified in clause 5.4.1.4. if ue-1 decides to reuse the existing pc5 unicast link as specified in clause 5.2.1.4, the ue triggers layer-2 link modification procedure as specified in clause 6.3.3.4. 3. ue-1 sends a direct communication request message to initiate the unicast layer-2 link establishment procedure. the direct communication request message includes: - source user info: the initiating ue's application layer id (i.e. ue-1's application layer id). - if the v2x application layer provided the target ue's application layer id in step 2, the following information is included: - target user info: the target ue's application layer id (i.e. ue-2's application layer id). - v2x service info: the information about v2x service type(s) requesting layer-2 link establishment. - security information: the information for the establishment of security. note 1: the security information and the necessary protection of the source user info and target user info are defined in ts 33.536 [26]. the source layer-2 id and destination layer-2 id used to send the direct communication request message are determined as specified in clauses 5.6.1.1 and 5.6.1.4. the destination layer-2 id may be broadcast or unicast layer-2 id. when unicast layer-2 id is used, the target user info shall be included in the direct communication request message. ue-1 sends the direct communication request message via pc5 broadcast or unicast using the source layer-2 id and the destination layer-2 id. 4. security with ue-1 is established as below: 4a. if the target user info is included in the direct communication request message, the target ue, i.e. ue-2, responds by establishing the security with ue-1. 4b. if the target user info is not included in the direct communication request message, the ues that are interested in using the announced v2x service type(s) over a pc5 unicast link with ue-1 responds by establishing the security with ue-1. note 2: the signalling for the security procedure is defined in ts 33.536 [26]. when the security protection is enabled, ue-1 sends the following information to the target ue: - if ip communication is used: - ip address configuration: for ip communication, ip address configuration is required for this link and indicates one of the following values: - \"ipv6 router\" if ipv6 address allocation mechanism is supported by the initiating ue, i.e., acting as an ipv6 router; or - \"ipv6 address allocation not supported\" if ipv6 address allocation mechanism is not supported by the initiating ue. - link local ipv6 address: a link-local ipv6 address formed locally based on rfc 4862 [21] if ue-1 does not support the ipv6 ip address allocation mechanism, i.e. the ip address configuration indicates \"ipv6 address allocation not supported\". - qos info: the information about pc5 qos flow(s) to be added. for each pc5 qos flow, the pfi, the corresponding pc5 qos parameters (i.e. pqi and conditionally other parameters such as mfbr/gfbr, etc.) and the associated v2x service type(s). the source layer-2 id used for the security establishment procedure is determined as specified in clauses 5.6.1.1 and 5.6.1.4. the destination layer-2 id is set to the source layer-2 id of the received direct communication request message. upon receiving the security establishment procedure messages, ue-1 obtains the peer ue's layer-2 id for future communication, for signalling and data traffic for this unicast link. 5. a direct communication accept message is sent to ue-1 by the target ue(s) that has successfully established security with ue-1: 5a. (ue oriented layer-2 link establishment) if the target user info is included in the direct communication request message, the target ue, i.e. ue-2 responds with a direct communication accept message if the application layer id for ue-2 matches. 5b. (v2x service oriented layer-2 link establishment) if the target user info is not included in the direct communication request message, the ues that are interested in using the announced v2x service(s) respond to the request by sending a direct communication accept message (ue-2 and ue-4 in figure 6.3.3.1-1). the direct communication accept message includes: - source user info: application layer id of the ue sending the direct communication accept message. - qos info: the information about pc5 qos flow(s) requested by ue-1. for each pc5 qos flow, the pfi, the corresponding pc5 qos parameters (i.e. pqi and conditionally other parameters such as mfbr/gfbr, etc.) and the associated v2x service type(s). - if ip communication is used: - ip address configuration: for ip communication, ip address configuration is required for this link and indicates one of the following values: - \"ipv6 router\" if ipv6 address allocation mechanism is supported by the target ue, i.e., acting as an ipv6 router; or - \"ipv6 address allocation not supported\" if ipv6 address allocation mechanism is not supported by the target ue. - link local ipv6 address: a link-local ipv6 address formed locally based on rfc 4862 [21] if the target ue does not support the ipv6 ip address allocation mechanism, i.e. the ip address configuration indicates \"ipv6 address allocation not supported\", and ue-1 included a link-local ipv6 address in the direct communication request message. the target ue shall include a non-conflicting link-local ipv6 address. if both ues (i.e. the initiating ue and the target ue) selected to use link-local ipv6 address, they shall disable the duplicate address detection defined in rfc 4862 [21]. note 3: when either the initiating ue or the target ue indicates the support of ipv6 router, corresponding address configuration procedure would be carried out after the establishment of the layer 2 link, and the link-local ipv6 addresses are ignored. the v2x layer of the ue that established pc5 unicast link passes the pc5 link identifier assigned for the unicast link and the pc5 unicast link related information down to the as layer. the pc5 unicast link related information includes layer-2 id information (i.e. source layer-2 id and destination layer-2 id) and the corresponding pc5 qos parameters. this enables the as layer to maintain the pc5 link identifier together with the pc5 unicast link related information. 6. v2x service data is transmitted over the established unicast link as below: the pc5 link identifier, and pfi are provided to the as layer, together with the v2x service data. optionally in addition, the layer-2 id information (i.e. source layer-2 id and destination layer-2 id) is provided to the as layer. note 4: it is up to ue implementation to provide the layer-2 id information to the as layer. ue-1 sends the v2x service data using the source layer-2 id (i.e. ue-1's layer-2 id for this unicast link) and the destination layer-2 id (i.e. the peer ue's layer-2 id for this unicast link). note 5: pc5 unicast link is bi-directional, therefore the peer ue of ue-1 can send the v2x service data to ue-1 over the unicast link with ue-1. 6.3.3.2 link identifier update for a unicast link figure 6.3.3.2-1 shows the link identifier update procedure for a unicast link. when privacy requirements is configured for a v2x service type associated with the unicast link, identifiers used for unicast mode of v2x communication over pc5 reference point (e.g. application layer id, source layer-2 id and ip address/prefix) shall be changed over time as specified in clauses 5.6.1.1 and 5.6.1.4. a ue may decide to change the identifiers for other reasons, e.g. application layer requirement. this procedure is used to update and exchange new identifiers between the source and the peer ues for a unicast link before using the new identifiers, to prevent service interruptions. when there are privacy requirements as indicated above, this procedure is executed over a security protected unicast link. if a ue has multiple unicast links using the same application layer ids or layer-2 ids, the ue needs to perform the link identifier update procedure over each of the unicast link. figure 6.3.3.2-1: link identifier update procedure 0. ue-1 and ue-2 have a unicast link established as described in clause 6.3.3.1. 1. ue-1 decides to change its identifier(s), e.g. due to the application layer id change or upon expiry of a timer. ue-1 generates its new layer-2 id and sends a link identifier update request message to ue-2 using the old identifiers. the link identifier update request message includes the new identifier(s) to use (including the new layer-2 id, security information, optionally the new application layer id and optionally new ip address/prefix if ip communication is used). the new identifier(s) shall be cyphered to protect privacy if security is configured for the unicast link. after sending the link identifier update request message, if the ue-1 has data to send, ue-1 keeps sending data traffic to ue-2 with the old identifiers until ue-1 sends the link identifier update ack message to ue-2. note 1: the timer is running on per source layer-2 id. note 2: when one of the two ues acts as ipv6 router as described in clause 5.2.1.5 and ip address/prefix also needs to be changed, corresponding address configuration procedure would be carried out after the link identifier update procedure. 2. upon reception of the link identifier update request message, ue-2 changes its identifier(s). ue-2 responds with a link identifier update response message which includes the new identifier(s) to use (including the new layer-2 id, security information, optionally the new application layer id, and optionally a new ip address/prefix if ip communication is used). the new identifier(s) shall be cyphered to protect privacy if security is configured for the unicast link. the link identifier update response message is sent using the old identifiers. ue-2 continues to receive traffic with the old layer-2 id from ue-1 until ue-2 receives traffic with the new layer-2 id from ue-1. after sending the link identifier update response message, ue-2 keeps sending data traffic to ue-1 with the old identifiers, if ue-2 has data to send, until ue-2 receives the link identifier update ack message from ue-1. 3. upon reception of the link identifier update response message, ue-1 responds with a link identifier update ack message. the link identifier update ack message includes the new identifier(s) from ue-2, as received on the link identifier update response message. the link identifier update ack message is sent using the old identifiers. ue-1 continues to receive traffic with the old layer-2 id from ue-2 until ue-1 receives traffic with the new layer-2 id from ue-2. 4. the v2x layer of ue-1 passes the pc5 link identifier for the unicast link and the updated layer-2 ids (i.e. new layer-2 id for ue-1 for the source and new layer-2 id of ue-2 for the destination) down to the as layer. this enables the as layer to update the provided layer-2 ids for the unicast link. ue-1 starts using its new identifiers and ue-2's new identifiers for this unicast link. 5. upon reception of the link identifier update ack message, the v2x layer of ue-2 passes the pc5 link identifier for the unicast link and the updated layer-2 ids (i.e. new layer-2 id of ue-2 for the source and new layer-2 id for ue-1 for the destination) down to the as layer. this enables the as layer to update the provided layer-2 ids for the unicast link. ue-2 starts using its new identifiers and ue-1's new identifiers for this unicast link. note 3: the security information in the above messages also needs to be updated at the same time as the layer-2 ids. this is defined in ts 33.536 [26]. 6.3.3.3 layer-2 link release over pc5 reference point figure 6.3.3.3-1 shows the layer-2 link release procedure over pc5 reference point. figure 6.3.3.3-1: layer-2 link release procedure 0. ue-1 and ue-2 have a unicast link established as described in clause 6.3.3.1. 1. ue-1 sends a disconnect request message to ue-2 in order to release the layer-2 link and deletes all context data associated with the layer-2 link. the disconnect request message includes security information. 2. upon reception of the disconnect request message ue-2 may respond with a disconnect response message and deletes all context data associated with the layer-2 link. the disconnect response message includes security information. the v2x layer of each ue informs the as layer that the unicast link has been released. the v2x layer uses pc5 link identifier to indicate the released unicast link. this enables the as layer to delete the context related to the released unicast link. note: the security information in the above messages is defined in ts 33.536 [26]. 6.3.3.4 layer-2 link modification for a unicast link figure 6.3.3.4-1 shows the layer-2 link modification procedure for a unicast link. this procedure is used to: - add new pc5 qos flow(s) in the existing pc5 unicast link. - this covers the case for adding new pc5 qos flow(s) to the exisiting v2x service(s) as well as the case for adding new pc5 qos flow(s) to new v2x service(s). - modify existing pc5 qos flow(s) in the existing pc5 unicast link. - this covers the case for modifying the pc5 qos parameters for existing pc5 qos flow(s). - this also covers the case for removing the associated v2x service(s) from existing pc5 qos flow(s) as well as the case for associating new v2x service(s) with existing pc5 qos flow(s). - remove existing pc5 qos flow(s) in the existing pc5 unicast link. figure 6.3.3.4-1: layer-2 link modification procedure 0. ue-1 and ue-2 have a unicast link established as described in clause 6.3.3.1. 1. the v2x application layer in ue-1 provides application information for pc5 unicast communication. the application information includes the v2x service type(s) and the initiating ue's application layer id. the target ue's application layer id may be included in the application information. if ue-1 decides to reuse the existing pc5 unicast link as specified in clause 5.2.1.4, so decides to modify the unicast link established with ue-2, ue-1 sends a link modification request to ue-2. the link modification request message includes: a) to add new pc5 qos flow(s) in the existing pc5 unicast link: - qos info: the information about pc5 qos flow(s) to be added. for each pc5 qos flow, the pfi, the corresponding pc5 qos parameters (i.e. pqi and conditionally other parameters such as mfbr/gfbr, etc.) and the associated v2x service type(s). b) to modify pc5 qos flow(s) in the existing pc5 unicast link: - qos info: the information about pc5 qos flow(s) to be modified. for each pc5 qos flow, the pfi, the corresponding pc5 qos parameters (i.e. pqi and conditionally other parameters such as mfbr/gfbr, etc.) and the associated v2x service type(s). c) to remove pc5 qos flow(s) in the existing pc5 unicast link: - pfi(s). 2. ue-2 responds with a link modification accept message. the link modification accept message includes: - for case a) and case b) described in step 1: - qos info: the information about pc5 qos flow(s) requested by ue-1. for each pc5 qos flow, the pfi, the corresponding pc5 qos parameters (i.e. pqi and conditionally other parameters such as mfbr/gfbr, etc.) and the associated v2x service type(s). the v2x layer of each ue provides information about the unicast link modification to the as layer. this enables the as layer to update the context related to the modified unicast link. 6.3.3.5 layer-2 link maintenance over pc5 reference point the pc5 signalling protocol shall support keep-alive functionality that is used to detect if a particular pc5 unicast link is still valid. either side of the pc5 unicast link can initiate the layer-2 link maintenance procedure (i.e. keep-alive procedure), based on for example triggers from the as layer or internal timers. the ues shall minimize the keep-alive signalling, e.g. cancel the procedure if data are successfully received over the pc5 unicast link. figure 6.3.3.5-1: layer-2 link maintenance procedure 0. ue-1 and ue-2 have a unicast link established as described in clause 6.3.3.1. 1. based on trigger conditions, ue-1 sends a keep-alive message to ue-2 in order to determine the status of the pc5 unicast link. note 1: it is left to stage 3 to determine the exact triggers for the keep-alive messages. for example, the trigger can be based on a timer associated with the layer-2 link. the timer can be reset with a successful reception event defined by ts 38.300 [11]. 2. upon reception of the keep-alive message, ue-2 responds with a keep-alive ack message. the ue initiating the keep-alive procedure shall determine the follow up actions based on the result of the signalling, e.g. proceed with implicit layer-2 link release. note 2: it is left to stage 3 to determine the follow up actions. for example, a successful reception event can also cancel the layer-2 link release if received in time. 6.4 procedures for v2x communication over uu reference point 6.4.1 procedure for notification on qos sustainability analytics to the v2x application server figure 6.4.1-1 depicts a procedure for notification on qos sustainability analytics to the v2x application server. figure 6.4.1-1: notification on qos sustainability analytics to the v2x application server 1. the v2x application sever derives information on v2x service, location information (an area or path of interest), qos requirements and reporting threshold(s). the location information can be in the form of geographic coordinates to reflect a list of waypoints. note 1: step 1 is outside 3gpp scope. the v2x application server can derive this, for example, based on information provided by the ue(s) or the v2x application server uses locally configured information. 2. the v2x application server subscribes to or requests notification on qos sustainability analytics provided by nwdaf via nef by invoking nnef_analyticsexposure_subscribe service operation as defined in clause 6.1.1.2 of ts 23.288 [20] or nnef_analyticsexposure_fetch service operation as defined in clause 6.1.2.2 of ts 23.288 [20]. the parameters included in the request are described in clause 5.4.5.2.2. the v2x application server may include multiple sets of parameters in order to provide different combinations of \"location information\" and \"analytics target period\" when requesting notification on qos sustainability analytics. note 2: the v2x application server needs to set the \"time when analytics information is needed\" parameter (see ts 23.288 [20]) appropriately, e.g. large enough, to perform the v2x application adjustment before the potential qos change happens. note 3: the request made by the v2x application server does not have to be per ue. in order to make a request for multiple ues, the v2x application server can perform mapping between individual ue path requests and subscription to notification per path/road segment. whether a request is generated for a ue or multiple ues, and how to set the parameters included in the request and triggers for such request are up to the v2x application server implementation and outside of the scope of 3gpp. 3. when the nef receives the request from the v2x application server, the nef interacts with the nwdaf as described in the procedure in clause 6.9.4 of ts 23.288 [20]. the nef shall map the qos characteristics attributes including resource type, pdb and per received from the v2x application server to the most appropriate 5qi that is supported by the network if the v2x application server does not provide 5qi. if 5qi is provided by the v2x application server, nef does not perform such mapping. the nef may map other parameters included in the request from the v2x application server to information used by the 3gpp system. 4. if the nef receives the response from the nwdaf, the nef notifies the v2x application server with the analytics information on qos sustainability analytics by invoking nnef_analyticsexposure_notify service operation for a subscribe-notify model as defined in clause 6.1.1.2 of ts 23.288 [20] or nnef_analyticsexposure_fetch service operation for a request-response model as defined in clause 6.1.2.2 of ts 23.288 [20]. 5. v2x application adjustment may take place. note 4: step 5 is outside 3gpp scope. v2x application adjustment can take place at ue and/or v2x application server, e.g. adjust inter-vehicle gap, change video codec parameters, etc. for the case that the v2x application server uses the request for multiple ues in step 2, the v2x application server can perform the v2x application adjustment for every ue corresponding to the request. for a subscribe-notify model, when the v2x application sever wants to cancel subscription to analytics information, it invokes the nnef_analyticsexposure_unsubscribe service operation as defined in clause 6.1.1.2 of ts 23.288 [20]. 6.5 procedures for service authorization to ng-ran for v2x communications over pc5 reference point 6.5.1 general in order to enable pc5 radio resource control in ng-ran, per pc5 rat v2x service authorization information and pc5 qos parameters need to be made available in ng-ran, this clause describes the corresponding procedures and aspects. 6.5.2 registration procedure the registration procedure for ue is performed as defined in ts 23.502 [7] with the following additions: - the ue includes the pc5 capability for v2x (i.e. lte pc5 only, nr pc5 only, both lte and nr pc5) as part of the \"5gmm capability\" in the registration request message. the amf stores this information for v2x operation. the pc5 capability for v2x indicates whether the ue is capable of v2x communication over pc5 reference point and which specific pc5 rat(s) it supports. - the amf obtains the v2x subscription data as part of the user subscription data from udm during ue registration procedure using nudm_sdm service as defined in clause 4.2.2.2.2 of ts 23.502 [7]. - the amf determines whether the ue is authorized to use v2x communication over pc5 reference point based on ue's pc5 capability for v2x and the subscription data related to v2x service authorization information (i.e. \"v2x services authorized\" indication, ue-pc5-ambr per pc5 rat and cross-rat pc5 control authorization if applicable) received from udm, and stores the v2x service authorization information as part of the ue context. - the pcf provides the pc5 qos parameters to amf, and the amf stores them in the ue context. - if the ue is pc5 capable for v2x, and the ue is authorized to use v2x communication over pc5 reference point based on the subscription data, then the amf shall include the following information in the ngap message sent to ng-ran: - a \"v2x services authorized\" indication, indicating the ue is authorized to use v2x communication over pc5 reference point as vehicle ue, pedestrian ue or both. - ue-pc5-ambr per pc5 rat and cross-rat pc5 control authorization (if applicable), used by ng-ran for the resource management of ue's pc5 transmission for v2x services in network scheduled mode. - the pc5 qos parameters used by the ng-ran for the resource management of ue's pc5 transmission for v2x services in network scheduled mode. - if the ue is authorized to use v2x communication over pc5 reference point, then the amf should not initiate the release of the signalling connection after the completion of the registration procedure. the release of the nas signalling relies on the decision of ng-ran, as specified in ts 23.502 [7]. 6.5.3 service request procedure the service request procedure for ue in cm-idle state is performed as defined in ts 23.502 [7] with the following additions: - if the ue is pc5 capable for v2x, and the ue is authorized to use v2x communication over pc5 reference point, then the amf shall include a \"v2x services authorized\" indication in the ngap message, indicating the ue is authorized to use v2x communication over pc5 reference point as vehicle ue, pedestrian ue or both. - the amf includes the ue-pc5-ambr, and cross-rat pc5 control authorization in the ngap message to the ng-ran as part of the ue context and ng-ran may use in resource management of ue's pc5 transmission for v2x services in network scheduled mode. - the amf sends the pc5 qos parameters to ng-ran via n2 signalling. the pc5 qos parameters may be stored in the ue context after the registration procedure. if the ue is authorized to use v2x communication over pc5 reference point but amf does not have pc5 qos parameters available, the amf fetches the pc5 qos parameters from the pcf. 6.5.4 n2 handover procedure the n2 based handover or the inter-rat to ng-ran handover procedures for ue are performed as defined in ts 23.502 [7] with the following additions: - if the ue is pc5 capable for v2x, and the ue is authorized to use v2x communication over pc5 reference point, then the target amf shall send the \"v2x services authorized\" indication, ue-pc5-ambr, cross-rat pc5 control authorization, and pc5 qos parameters to the target ng-ran as follows: - for the intra amf handover, the \"v2x services authorized\" indication, ue-pc5-ambr, cross-rat pc5 control authorization, and pc5 qos parameters are included in the ngap handover request message. - for the inter amf handover or inter-rat handover to ng-ran, the \"v2x services authorized\" indication, ue-pc5-ambr, cross-rat pc5 control authorization, and pc5 qos parameters are included in the ngap handover request message sent to the target ng-ran. 6.5.5 xn handover procedure the xn based handover procedures for ue are performed as defined in ts 23.502 [7] with the following additions: - if the \"v2x services authorized\" indication is included in the ue context (as described in ts 38.423 [23]), then the source ng-ran shall include a \"v2x services authorized\" indication, ue-pc5-ambr, cross-rat pc5 control authorization and pc5 qos parameters in the xnap handover request message to the target ng-ran. - if the ue is pc5 capable for v2x, and the ue is authorized to use v2x communication over pc5 reference point, then the amf shall send the \"v2x services authorized\" indication, the ue-pc5-ambr, cross-rat pc5 control authorization, and pc5 qos parameters to the target ng-ran in the path switch request acknowledge message 6.5.6 subscriber data update notification to amf the procedure of subscriber data update notification to amf is performed as defined in ts 23.502 [7] with the following additions: - the nudm_sdm_notification service operation may contain the \"v2x services authorized\" indication or the ue-pc5-ambr, or cross-rat pc5 control authorization or any combination; - the amf updates the ue context with the above new v2x subscription data. - when the amf updates ue context stored at ng-ran, the ue context contains the v2x subscription data. 6.5.7 delivery of pc5 qos parameters to ng-ran the ue policy association establishment procedure and ue policy association modification procedure, as defined in ts 23.502 [7], is used to provide to the amf pc5 qos parameters used by ng-ran. when receiving npcf_uepolicycontrol_create request from the amf which includes the pc5 capability for v2x or when receiving the updated subscription data from udr, the pcf generates the pc5 qos parameters used by ng-ran corresponding to a ue as defined in clause 5.4.2. the (v-)pcf provides the information to the amf as follows: - in the roaming case, the h-pcf includes the pc5 qos parameters used by ng-ran in the npcf_uepolicycontrol_create response message or npcf_uepolicycontrol updatenotify request message sent to v-pcf in an n2 pc5 policy container, and v-pcf relays this n2 pc5 policy container as the n2 container in the namf_communication_n1n2messagetransfer message sent to amf. - in the non-roaming case, the pcf includes the pc5 qos parameters used by ng-ran in an n2 container in namf_communication_n1n2messagetransfer message sent to amf. when the amf determines that the n2 pc5 policy container comes from (v-)pcf, the amf stores such information as part of the ue context. in the ue configuration update procedure triggered by ue policy association establishment or ue policy association modification, t: - the amf forwards the pc5 qos parameters in the ngap message to the ng-ran if a n2 pc5 policy container is received in the namf_communication_n1n2messagetransfer message. - the amf forwards the pc5 qos parameters in the nas message to ue by using the ue configuration update procedure for transparent ue policy delivery procedure defined in clause 4.2.4.3 of ts 23.502 [7] if a ue policy container is received in the namf_communication_n1n2messagetransfer message. note 1: if the pc5 qos parameters are provided to both ng-ran and ue, both the n2 pc5 policy container and the ue policy container are included in the namf_communication_n1n2messagetransfer message. note 2: non-ue specific pc5 qos parameters, e.g. default pc5 qos parameters, can also be locally configured in ng-ran. how such configuration is performed is out of scope of this specification. 6.5.8 pc5 capability for v2x indication and v2x related information per pc5 rat a ue may support multiple pc5 rats (i.e. lte pc5 and nr pc5). for such ue, the pc5 capability for v2x indication and v2x related information can be per pc5 rat as described in clause 6.5.2. the cross-rat pc5 control authorization indicates whether lte uu controls lte pc5 and/or nr pc5 from the cellular network, and whether nr uu controls lte pc5 and/or nr pc5 from the cellular network. note: stage 3 does not define an explicit cross-rat pc5 control authorization ie and it is indicated in an implicit manner as specified in ts 38.413 [22] and ts 38.423 [23]. annex a (informative): application function influence based edge computing for v2x services to route v2x messages or any traffic for v2x purposes to/from v2x application server(s) in a local data network (dn) close to ng-ran, v2x application server operated by e.g. operators, oems, road authorities, can use the application function (af) influence on traffic routing feature defined in clause 5.6.7 of ts 23.501 [6]. the v2x application server that sends the af request for af influence based edge computing for v2x services can be the same v2x application server to/from which the traffic is routed. when application function influence on traffic routing is applied, a local upf can be selected to route the traffic to the local v2x application server. usage of application function (af) influence on traffic routing feature and its application for smf to control upf data forwarding are defined in clause 5.6.7 and clause 5.8.2 of ts 23.501 [6]. annex b (informative): road side unit (rsu) implementation options this annex presents examples how rsu can be implemented in 5gs, as shown in ts 23.285 [8]. figure b-1 shows a ue-type rsu, which combines a ue with the v2x application logic. figure b-1: rsu includes a ue and the v2x application logic figure b-2 shows one example of gnb-type rsus. in this example, the rsu comprises a gnb, a collocated upf, and a v2x application server. figure b-2: rsu includes a gnb, collocated upf and a v2x application server annex c (informative): change history",
  "metadata": {
    "filename": "23287-g40.docx",
    "filepath": "C:\\Users\\Albert\\aa-660-ai-doc-classification-deduplication\\data\\raw\\23287-g40.docx",
    "hash": "d78767273a215a754505a4994eb607c360564fd7fc95c57708ba420f13c36ddb",
    "filesize": 893308,
    "language": "en"
  }
}